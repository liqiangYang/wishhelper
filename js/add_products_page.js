
(function(){var root=this;var previousUnderscore=root._;var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var push=ArrayProto.push,slice=ArrayProto.slice,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,nativeCreate=Object.create;var Ctor=function(){};var _=function(obj){if(obj instanceof _)return obj;if(!(this instanceof _))return new _(obj);this._wrapped=obj};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=_}exports._=_}else{root._=_}_.VERSION="1.8.3";var optimizeCb=function(func,context,argCount){if(context===void 0)return func;switch(argCount==null?3:argCount){case 1:return function(value){return func.call(context,value)};case 2:return function(value,other){return func.call(context,value,other)};case 3:return function(value,index,collection){return func.call(context,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(context,accumulator,value,index,collection)}}return function(){return func.apply(context,arguments)}};var cb=function(value,context,argCount){if(value==null)return _.identity;if(_.isFunction(value))return optimizeCb(value,context,argCount);if(_.isObject(value))return _.matcher(value);return _.property(value)};_.iteratee=function(value,context){return cb(value,context,Infinity)};var createAssigner=function(keysFunc,undefinedOnly){return function(obj){var length=arguments.length;if(length<2||obj==null)return obj;for(var index=1;index<length;index++){var source=arguments[index],keys=keysFunc(source),l=keys.length;for(var i=0;i<l;i++){var key=keys[i];if(!undefinedOnly||obj[key]===void 0)obj[key]=source[key]}}return obj}};var baseCreate=function(prototype){if(!_.isObject(prototype))return{};if(nativeCreate)return nativeCreate(prototype);Ctor.prototype=prototype;var result=new Ctor;Ctor.prototype=null;return result};var property=function(key){return function(obj){return obj==null?void 0:obj[key]}};var MAX_ARRAY_INDEX=Math.pow(2,53)-1;var getLength=property("length");var isArrayLike=function(collection){var length=getLength(collection);return typeof length=="number"&&length>=0&&length<=MAX_ARRAY_INDEX};_.each=_.forEach=function(obj,iteratee,context){iteratee=optimizeCb(iteratee,context);var i,length;if(isArrayLike(obj)){for(i=0,length=obj.length;i<length;i++){iteratee(obj[i],i,obj)}}else{var keys=_.keys(obj);for(i=0,length=keys.length;i<length;i++){iteratee(obj[keys[i]],keys[i],obj)}}return obj};_.map=_.collect=function(obj,iteratee,context){iteratee=cb(iteratee,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,results=Array(length);for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;results[index]=iteratee(obj[currentKey],currentKey,obj)}return results};function createReduce(dir){function iterator(obj,iteratee,memo,keys,index,length){for(;index>=0&&index<length;index+=dir){var currentKey=keys?keys[index]:index;memo=iteratee(memo,obj[currentKey],currentKey,obj)}return memo}return function(obj,iteratee,memo,context){iteratee=optimizeCb(iteratee,context,4);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=dir>0?0:length-1;if(arguments.length<3){memo=obj[keys?keys[index]:index];index+=dir}return iterator(obj,iteratee,memo,keys,index,length)}}_.reduce=_.foldl=_.inject=createReduce(1);_.reduceRight=_.foldr=createReduce(-1);_.find=_.detect=function(obj,predicate,context){var key;if(isArrayLike(obj)){key=_.findIndex(obj,predicate,context)}else{key=_.findKey(obj,predicate,context)}if(key!==void 0&&key!==-1)return obj[key]};_.filter=_.select=function(obj,predicate,context){var results=[];predicate=cb(predicate,context);_.each(obj,function(value,index,list){if(predicate(value,index,list))results.push(value)});return results};_.reject=function(obj,predicate,context){return _.filter(obj,_.negate(cb(predicate)),context)};_.every=_.all=function(obj,predicate,context){predicate=cb(predicate,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length;for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(!predicate(obj[currentKey],currentKey,obj))return false}return true};_.some=_.any=function(obj,predicate,context){predicate=cb(predicate,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length;for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(predicate(obj[currentKey],currentKey,obj))return true}return false};_.contains=_.includes=_.include=function(obj,item,fromIndex,guard){if(!isArrayLike(obj))obj=_.values(obj);if(typeof fromIndex!="number"||guard)fromIndex=0;return _.indexOf(obj,item,fromIndex)>=0};_.invoke=function(obj,method){var args=slice.call(arguments,2);var isFunc=_.isFunction(method);return _.map(obj,function(value){var func=isFunc?method:value[method];return func==null?func:func.apply(value,args)})};_.pluck=function(obj,key){return _.map(obj,_.property(key))};_.where=function(obj,attrs){return _.filter(obj,_.matcher(attrs))};_.findWhere=function(obj,attrs){return _.find(obj,_.matcher(attrs))};_.max=function(obj,iteratee,context){var result=-Infinity,lastComputed=-Infinity,value,computed;if(iteratee==null&&obj!=null){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value>result){result=value}}}else{iteratee=cb(iteratee,context);_.each(obj,function(value,index,list){computed=iteratee(value,index,list);if(computed>lastComputed||computed===-Infinity&&result===-Infinity){result=value;lastComputed=computed}})}return result};_.min=function(obj,iteratee,context){var result=Infinity,lastComputed=Infinity,value,computed;if(iteratee==null&&obj!=null){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value<result){result=value}}}else{iteratee=cb(iteratee,context);_.each(obj,function(value,index,list){computed=iteratee(value,index,list);if(computed<lastComputed||computed===Infinity&&result===Infinity){result=value;lastComputed=computed}})}return result};_.shuffle=function(obj){var set=isArrayLike(obj)?obj:_.values(obj);var length=set.length;var shuffled=Array(length);for(var index=0,rand;index<length;index++){rand=_.random(0,index);if(rand!==index)shuffled[index]=shuffled[rand];shuffled[rand]=set[index]}return shuffled};_.sample=function(obj,n,guard){if(n==null||guard){if(!isArrayLike(obj))obj=_.values(obj);return obj[_.random(obj.length-1)]}return _.shuffle(obj).slice(0,Math.max(0,n))};_.sortBy=function(obj,iteratee,context){iteratee=cb(iteratee,context);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iteratee(value,index,list)}}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return-1}return left.index-right.index}),"value")};var group=function(behavior){return function(obj,iteratee,context){var result={};iteratee=cb(iteratee,context);_.each(obj,function(value,index){var key=iteratee(value,index,obj);behavior(result,value,key)});return result}};_.groupBy=group(function(result,value,key){if(_.has(result,key))result[key].push(value);else result[key]=[value]});_.indexBy=group(function(result,value,key){result[key]=value});_.countBy=group(function(result,value,key){if(_.has(result,key))result[key]++;else result[key]=1});_.toArray=function(obj){if(!obj)return[];if(_.isArray(obj))return slice.call(obj);if(isArrayLike(obj))return _.map(obj,_.identity);return _.values(obj)};_.size=function(obj){if(obj==null)return 0;return isArrayLike(obj)?obj.length:_.keys(obj).length};_.partition=function(obj,predicate,context){predicate=cb(predicate,context);var pass=[],fail=[];_.each(obj,function(value,key,obj){(predicate(value,key,obj)?pass:fail).push(value)});return[pass,fail]};_.first=_.head=_.take=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[0];return _.initial(array,array.length-n)};_.initial=function(array,n,guard){return slice.call(array,0,Math.max(0,array.length-(n==null||guard?1:n)))};_.last=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[array.length-1];return _.rest(array,Math.max(0,array.length-n))};_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,n==null||guard?1:n)};_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,strict,startIndex){var output=[],idx=0;for(var i=startIndex||0,length=getLength(input);i<length;i++){var value=input[i];if(isArrayLike(value)&&(_.isArray(value)||_.isArguments(value))){if(!shallow)value=flatten(value,shallow,strict);var j=0,len=value.length;output.length+=len;while(j<len){output[idx++]=value[j++]}}else if(!strict){output[idx++]=value}}return output};_.flatten=function(array,shallow){return flatten(array,shallow,false)};_.without=function(array){return _.difference(array,slice.call(arguments,1))};_.uniq=_.unique=function(array,isSorted,iteratee,context){if(!_.isBoolean(isSorted)){context=iteratee;iteratee=isSorted;isSorted=false}if(iteratee!=null)iteratee=cb(iteratee,context);var result=[];var seen=[];for(var i=0,length=getLength(array);i<length;i++){var value=array[i],computed=iteratee?iteratee(value,i,array):value;if(isSorted){if(!i||seen!==computed)result.push(value);seen=computed}else if(iteratee){if(!_.contains(seen,computed)){seen.push(computed);result.push(value)}}else if(!_.contains(result,value)){result.push(value)}}return result};_.union=function(){return _.uniq(flatten(arguments,true,true))};_.intersection=function(array){var result=[];var argsLength=arguments.length;for(var i=0,length=getLength(array);i<length;i++){var item=array[i];if(_.contains(result,item))continue;for(var j=1;j<argsLength;j++){if(!_.contains(arguments[j],item))break}if(j===argsLength)result.push(item)}return result};_.difference=function(array){var rest=flatten(arguments,true,true,1);return _.filter(array,function(value){return!_.contains(rest,value)})};_.zip=function(){return _.unzip(arguments)};_.unzip=function(array){var length=array&&_.max(array,getLength).length||0;var result=Array(length);for(var index=0;index<length;index++){result[index]=_.pluck(array,index)}return result};_.object=function(list,values){var result={};for(var i=0,length=getLength(list);i<length;i++){if(values){result[list[i]]=values[i]}else{result[list[i][0]]=list[i][1]}}return result};function createPredicateIndexFinder(dir){return function(array,predicate,context){predicate=cb(predicate,context);var length=getLength(array);var index=dir>0?0:length-1;for(;index>=0&&index<length;index+=dir){if(predicate(array[index],index,array))return index}return-1}}_.findIndex=createPredicateIndexFinder(1);_.findLastIndex=createPredicateIndexFinder(-1);_.sortedIndex=function(array,obj,iteratee,context){iteratee=cb(iteratee,context,1);var value=iteratee(obj);var low=0,high=getLength(array);while(low<high){var mid=Math.floor((low+high)/2);if(iteratee(array[mid])<value)low=mid+1;else high=mid}return low};function createIndexFinder(dir,predicateFind,sortedIndex){return function(array,item,idx){var i=0,length=getLength(array);if(typeof idx=="number"){if(dir>0){i=idx>=0?idx:Math.max(idx+length,i)}else{length=idx>=0?Math.min(idx+1,length):idx+length+1}}else if(sortedIndex&&idx&&length){idx=sortedIndex(array,item);return array[idx]===item?idx:-1}if(item!==item){idx=predicateFind(slice.call(array,i,length),_.isNaN);return idx>=0?idx+i:-1}for(idx=dir>0?i:length-1;idx>=0&&idx<length;idx+=dir){if(array[idx]===item)return idx}return-1}}_.indexOf=createIndexFinder(1,_.findIndex,_.sortedIndex);_.lastIndexOf=createIndexFinder(-1,_.findLastIndex);_.range=function(start,stop,step){if(stop==null){stop=start||0;start=0}step=step||1;var length=Math.max(Math.ceil((stop-start)/step),0);var range=Array(length);for(var idx=0;idx<length;idx++,start+=step){range[idx]=start}return range};var executeBound=function(sourceFunc,boundFunc,context,callingContext,args){if(!(callingContext instanceof boundFunc))return sourceFunc.apply(context,args);var self=baseCreate(sourceFunc.prototype);var result=sourceFunc.apply(self,args);if(_.isObject(result))return result;return self};_.bind=function(func,context){if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError("Bind must be called on a function");var args=slice.call(arguments,2);var bound=function(){return executeBound(func,bound,context,this,args.concat(slice.call(arguments)))};return bound};_.partial=function(func){var boundArgs=slice.call(arguments,1);var bound=function(){var position=0,length=boundArgs.length;var args=Array(length);for(var i=0;i<length;i++){args[i]=boundArgs[i]===_?arguments[position++]:boundArgs[i]}while(position<arguments.length)args.push(arguments[position++]);return executeBound(func,bound,this,this,args)};return bound};_.bindAll=function(obj){var i,length=arguments.length,key;if(length<=1)throw new Error("bindAll must be passed function names");for(i=1;i<length;i++){key=arguments[i];obj[key]=_.bind(obj[key],obj)}return obj};_.memoize=function(func,hasher){var memoize=function(key){var cache=memoize.cache;var address=""+(hasher?hasher.apply(this,arguments):key);if(!_.has(cache,address))cache[address]=func.apply(this,arguments);return cache[address]};memoize.cache={};return memoize};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)};_.defer=_.partial(_.delay,_,1);_.throttle=function(func,wait,options){var context,args,result;var timeout=null;var previous=0;if(!options)options={};var later=function(){previous=options.leading===false?0:_.now();timeout=null;result=func.apply(context,args);if(!timeout)context=args=null};return function(){var now=_.now();if(!previous&&options.leading===false)previous=now;var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0||remaining>wait){if(timeout){clearTimeout(timeout);timeout=null}previous=now;result=func.apply(context,args);if(!timeout)context=args=null}else if(!timeout&&options.trailing!==false){timeout=setTimeout(later,remaining)}return result}};_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result;var later=function(){var last=_.now()-timestamp;if(last<wait&&last>=0){timeout=setTimeout(later,wait-last)}else{timeout=null;if(!immediate){result=func.apply(context,args);if(!timeout)context=args=null}}};return function(){context=this;args=arguments;timestamp=_.now();var callNow=immediate&&!timeout;if(!timeout)timeout=setTimeout(later,wait);if(callNow){result=func.apply(context,args);context=args=null}return result}};_.wrap=function(func,wrapper){return _.partial(wrapper,func)};_.negate=function(predicate){return function(){return!predicate.apply(this,arguments)}};_.compose=function(){var args=arguments;var start=args.length-1;return function(){var i=start;var result=args[start].apply(this,arguments);while(i--)result=args[i].call(this,result);return result}};_.after=function(times,func){return function(){if(--times<1){return func.apply(this,arguments)}}};_.before=function(times,func){var memo;return function(){if(--times>0){memo=func.apply(this,arguments)}if(times<=1)func=null;return memo}};_.once=_.partial(_.before,2);var hasEnumBug=!{toString:null}.propertyIsEnumerable("toString");var nonEnumerableProps=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function collectNonEnumProps(obj,keys){var nonEnumIdx=nonEnumerableProps.length;var constructor=obj.constructor;var proto=_.isFunction(constructor)&&constructor.prototype||ObjProto;var prop="constructor";if(_.has(obj,prop)&&!_.contains(keys,prop))keys.push(prop);while(nonEnumIdx--){prop=nonEnumerableProps[nonEnumIdx];if(prop in obj&&obj[prop]!==proto[prop]&&!_.contains(keys,prop)){keys.push(prop)}}}_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)if(_.has(obj,key))keys.push(key);if(hasEnumBug)collectNonEnumProps(obj,keys);return keys};_.allKeys=function(obj){if(!_.isObject(obj))return[];var keys=[];for(var key in obj)keys.push(key);if(hasEnumBug)collectNonEnumProps(obj,keys);return keys};_.values=function(obj){var keys=_.keys(obj);var length=keys.length;var values=Array(length);for(var i=0;i<length;i++){values[i]=obj[keys[i]]}return values};_.mapObject=function(obj,iteratee,context){iteratee=cb(iteratee,context);var keys=_.keys(obj),length=keys.length,results={},currentKey;for(var index=0;index<length;index++){currentKey=keys[index];results[currentKey]=iteratee(obj[currentKey],currentKey,obj)}return results};_.pairs=function(obj){var keys=_.keys(obj);var length=keys.length;var pairs=Array(length);for(var i=0;i<length;i++){pairs[i]=[keys[i],obj[keys[i]]]}return pairs};_.invert=function(obj){var result={};var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){result[obj[keys[i]]]=keys[i]}return result};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key)}return names.sort()};_.extend=createAssigner(_.allKeys);_.extendOwn=_.assign=createAssigner(_.keys);_.findKey=function(obj,predicate,context){predicate=cb(predicate,context);var keys=_.keys(obj),key;for(var i=0,length=keys.length;i<length;i++){key=keys[i];if(predicate(obj[key],key,obj))return key}};_.pick=function(object,oiteratee,context){var result={},obj=object,iteratee,keys;if(obj==null)return result;if(_.isFunction(oiteratee)){keys=_.allKeys(obj);iteratee=optimizeCb(oiteratee,context)}else{keys=flatten(arguments,false,false,1);iteratee=function(value,key,obj){return key in obj};obj=Object(obj)}for(var i=0,length=keys.length;i<length;i++){var key=keys[i];var value=obj[key];if(iteratee(value,key,obj))result[key]=value}return result};_.omit=function(obj,iteratee,context){if(_.isFunction(iteratee)){iteratee=_.negate(iteratee)}else{var keys=_.map(flatten(arguments,false,false,1),String);iteratee=function(value,key){return!_.contains(keys,key)}}return _.pick(obj,iteratee,context)};_.defaults=createAssigner(_.allKeys,true);_.create=function(prototype,props){var result=baseCreate(prototype);if(props)_.extendOwn(result,props);return result};_.clone=function(obj){if(!_.isObject(obj))return obj;return _.isArray(obj)?obj.slice():_.extend({},obj)};_.tap=function(obj,interceptor){interceptor(obj);return obj};_.isMatch=function(object,attrs){var keys=_.keys(attrs),length=keys.length;if(object==null)return!length;var obj=Object(object);for(var i=0;i<length;i++){var key=keys[i];if(attrs[key]!==obj[key]||!(key in obj))return false}return true};var eq=function(a,b,aStack,bStack){if(a===b)return a!==0||1/a===1/b;if(a==null||b==null)return a===b;if(a instanceof _)a=a._wrapped;if(b instanceof _)b=b._wrapped;var className=toString.call(a);if(className!==toString.call(b))return false;switch(className){case"[object RegExp]":case"[object String]":return""+a===""+b;case"[object Number]":if(+a!==+a)return+b!==+b;return+a===0?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}var areArrays=className==="[object Array]";if(!areArrays){if(typeof a!="object"||typeof b!="object")return false;var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)&&("constructor"in a&&"constructor"in b)){return false}}aStack=aStack||[];bStack=bStack||[];var length=aStack.length;while(length--){if(aStack[length]===a)return bStack[length]===b}aStack.push(a);bStack.push(b);if(areArrays){length=a.length;if(length!==b.length)return false;while(length--){if(!eq(a[length],b[length],aStack,bStack))return false}}else{var keys=_.keys(a),key;length=keys.length;if(_.keys(b).length!==length)return false;while(length--){key=keys[length];if(!(_.has(b,key)&&eq(a[key],b[key],aStack,bStack)))return false}}aStack.pop();bStack.pop();return true};_.isEqual=function(a,b){return eq(a,b)};_.isEmpty=function(obj){if(obj==null)return true;if(isArrayLike(obj)&&(_.isArray(obj)||_.isString(obj)||_.isArguments(obj)))return obj.length===0;return _.keys(obj).length===0};_.isElement=function(obj){return!!(obj&&obj.nodeType===1)};_.isArray=nativeIsArray||function(obj){return toString.call(obj)==="[object Array]"};_.isObject=function(obj){var type=typeof obj;return type==="function"||type==="object"&&!!obj};_.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(name){_["is"+name]=function(obj){return toString.call(obj)==="[object "+name+"]"}});if(!_.isArguments(arguments)){_.isArguments=function(obj){return _.has(obj,"callee")}}if(typeof/./!="function"&&typeof Int8Array!="object"){_.isFunction=function(obj){return typeof obj=="function"||false}}_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))};_.isNaN=function(obj){return _.isNumber(obj)&&obj!==+obj};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)==="[object Boolean]"};_.isNull=function(obj){return obj===null};_.isUndefined=function(obj){return obj===void 0};_.has=function(obj,key){return obj!=null&&hasOwnProperty.call(obj,key)};_.noConflict=function(){root._=previousUnderscore;return this};_.identity=function(value){return value};_.constant=function(value){return function(){return value}};_.noop=function(){};_.property=property;_.propertyOf=function(obj){return obj==null?function(){}:function(key){return obj[key]}};_.matcher=_.matches=function(attrs){attrs=_.extendOwn({},attrs);return function(obj){return _.isMatch(obj,attrs)}};_.times=function(n,iteratee,context){var accum=Array(Math.max(0,n));iteratee=optimizeCb(iteratee,context,1);for(var i=0;i<n;i++)accum[i]=iteratee(i);return accum};_.random=function(min,max){if(max==null){max=min;min=0}return min+Math.floor(Math.random()*(max-min+1))};_.now=Date.now||function(){return(new Date).getTime()};var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var unescapeMap=_.invert(escapeMap);var createEscaper=function(map){var escaper=function(match){return map[match]};var source="(?:"+_.keys(map).join("|")+")";var testRegexp=RegExp(source);var replaceRegexp=RegExp(source,"g");return function(string){string=string==null?"":""+string;return testRegexp.test(string)?string.replace(replaceRegexp,escaper):string}};_.escape=createEscaper(escapeMap);_.unescape=createEscaper(unescapeMap);_.result=function(object,property,fallback){var value=object==null?void 0:object[property];if(value===void 0){value=fallback}return _.isFunction(value)?value.call(object):value};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"};var escaper=/\\|'|\r|\n|\u2028|\u2029/g;var escapeChar=function(match){return"\\"+escapes[match]};_.template=function(text,settings,oldSettings){if(!settings&&oldSettings)settings=oldSettings;settings=_.defaults({},settings,_.templateSettings);var matcher=RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g");var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,escapeChar);index=offset+match.length;if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"}else if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"}else if(evaluate){source+="';\n"+evaluate+"\n__p+='"}return match});source+="';\n";if(!settings.variable)source="with(obj||{}){\n"+source+"}\n";source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{var render=new Function(settings.variable||"obj","_",source)}catch(e){e.source=source;throw e}var template=function(data){return render.call(this,data,_)};var argument=settings.variable||"obj";template.source="function("+argument+"){\n"+source+"}";return template};_.chain=function(obj){var instance=_(obj);instance._chain=true;return instance};var result=function(instance,obj){return instance._chain?_(obj).chain():obj};_.mixin=function(obj){_.each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];push.apply(args,arguments);return result(this,func.apply(_,args))}})};_.mixin(_);_.each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;method.apply(obj,arguments);if((name==="shift"||name==="splice")&&obj.length===0)delete obj[0];return result(this,obj)}});_.each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result(this,method.apply(this._wrapped,arguments))}});_.prototype.value=function(){return this._wrapped};_.prototype.valueOf=_.prototype.toJSON=_.prototype.value;_.prototype.toString=function(){return""+this._wrapped};if(typeof define==="function"&&define.amd){define("underscore",[],function(){return _})}}).call(this);
define('backbone',["underscore"],function(_){var root=this;var previousBackbone=root.Backbone;var slice=Array.prototype.slice;var splice=Array.prototype.splice;var Backbone;if(typeof exports!=="undefined"){Backbone=exports}else{Backbone=root.Backbone={}}Backbone.VERSION="0.9.2";Backbone.setDomLibrary=function(lib){$=lib};Backbone.noConflict=function(){root.Backbone=previousBackbone;return Backbone};Backbone.emulateHTTP=false;Backbone.emulateJSON=false;var eventSplitter=/\s+/;var Events=Backbone.Events={on:function(events,callback,context){var calls,event,node,tail,list;if(!callback)return this;events=events.split(eventSplitter);calls=this._callbacks||(this._callbacks={});while(event=events.shift()){list=calls[event];node=list?list.tail:{};node.next=tail={};node.context=context;node.callback=callback;calls[event]={tail:tail,next:list?list.next:node}}return this},off:function(events,callback,context){var event,calls,node,tail,cb,ctx;if(!(calls=this._callbacks))return;if(!(events||callback||context)){delete this._callbacks;return this}events=events?events.split(eventSplitter):_.keys(calls);while(event=events.shift()){node=calls[event];delete calls[event];if(!node||!(callback||context))continue;tail=node.tail;while((node=node.next)!==tail){cb=node.callback;ctx=node.context;if(callback&&cb!==callback||context&&ctx!==context){this.on(event,cb,ctx)}}}return this},trigger:function(events){var event,node,calls,tail,args,all,rest;if(!(calls=this._callbacks))return this;all=calls.all;events=events.split(eventSplitter);rest=slice.call(arguments,1);while(event=events.shift()){if(node=calls[event]){tail=node.tail;while((node=node.next)!==tail){node.callback.apply(node.context||this,rest)}}if(node=all){tail=node.tail;args=[event].concat(rest);while((node=node.next)!==tail){node.callback.apply(node.context||this,args)}}}return this}};Events.bind=Events.on;Events.unbind=Events.off;var Model=Backbone.Model=function(attributes,options){var defaults;attributes||(attributes={});if(options&&options.parse)attributes=this.parse(attributes);if(defaults=getValue(this,"defaults")){attributes=_.extend({},defaults,attributes)}if(options&&options.collection)this.collection=options.collection;this.attributes={};this._escapedAttributes={};this.cid=_.uniqueId("c");this.changed={};this._silent={};this._pending={};this.set(attributes,{silent:true});this.changed={};this._silent={};this._pending={};this._previousAttributes=_.clone(this.attributes);this.initialize.apply(this,arguments)};_.extend(Model.prototype,Events,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(options){return _.clone(this.attributes)},get:function(attr){return this.attributes[attr]},escape:function(attr){var html;if(html=this._escapedAttributes[attr])return html;var val=this.get(attr);return this._escapedAttributes[attr]=_.escape(val==null?"":""+val)},has:function(attr){return this.get(attr)!=null},set:function(key,value,options){var attrs,attr,val;if(_.isObject(key)||key==null){attrs=key;options=value}else{attrs={};attrs[key]=value}options||(options={});if(!attrs)return this;if(attrs instanceof Model)attrs=attrs.attributes;if(options.unset)for(attr in attrs)attrs[attr]=void 0;if(!this._validate(attrs,options))return false;if(this.idAttribute in attrs)this.id=attrs[this.idAttribute];var changes=options.changes={};var now=this.attributes;var escaped=this._escapedAttributes;var prev=this._previousAttributes||{};for(attr in attrs){val=attrs[attr];if(!_.isEqual(now[attr],val)||options.unset&&_.has(now,attr)){delete escaped[attr];(options.silent?this._silent:changes)[attr]=true}options.unset?delete now[attr]:now[attr]=val;if(!_.isEqual(prev[attr],val)||_.has(now,attr)!=_.has(prev,attr)){this.changed[attr]=val;if(!options.silent)this._pending[attr]=true}else{delete this.changed[attr];delete this._pending[attr]}}if(!options.silent)this.change(options);return this},unset:function(attr,options){(options||(options={})).unset=true;return this.set(attr,null,options)},clear:function(options){(options||(options={})).unset=true;return this.set(_.clone(this.attributes),options)},fetch:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;options.success=function(resp,status,xhr){if(!model.set(model.parse(resp,xhr),options))return false;if(success)success(model,resp)};options.error=Backbone.wrapError(options.error,model,options);return(this.sync||Backbone.sync).call(this,"read",this,options)},save:function(key,value,options){var attrs,current;if(_.isObject(key)||key==null){attrs=key;options=value}else{attrs={};attrs[key]=value}options=options?_.clone(options):{};if(options.wait){if(!this._validate(attrs,options))return false;current=_.clone(this.attributes)}var silentOptions=_.extend({},options,{silent:true});if(attrs&&!this.set(attrs,options.wait?silentOptions:options)){return false}var model=this;var success=options.success;options.success=function(resp,status,xhr){var serverAttrs=model.parse(resp,xhr);if(options.wait){delete options.wait;serverAttrs=_.extend(attrs||{},serverAttrs)}if(!model.set(serverAttrs,options))return false;if(success){success(model,resp)}else{model.trigger("sync",model,resp,options)}};options.error=Backbone.wrapError(options.error,model,options);var method=this.isNew()?"create":"update";var xhr=(this.sync||Backbone.sync).call(this,method,this,options);if(options.wait)this.set(current,silentOptions);return xhr},destroy:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;var triggerDestroy=function(){model.trigger("destroy",model,model.collection,options)};if(this.isNew()){triggerDestroy();return false}options.success=function(resp){if(options.wait)triggerDestroy();if(success){success(model,resp)}else{model.trigger("sync",model,resp,options)}};options.error=Backbone.wrapError(options.error,model,options);var xhr=(this.sync||Backbone.sync).call(this,"delete",this,options);if(!options.wait)triggerDestroy();return xhr},url:function(){var base=getValue(this,"urlRoot")||getValue(this.collection,"url")||urlError();if(this.isNew())return base;return base+(base.charAt(base.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(resp,xhr){return resp},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(options){options||(options={});var changing=this._changing;this._changing=true;for(var attr in this._silent)this._pending[attr]=true;var changes=_.extend({},options.changes,this._silent);this._silent={};for(var attr in changes){this.trigger("change:"+attr,this,this.get(attr),options)}if(changing)return this;while(!_.isEmpty(this._pending)){this._pending={};this.trigger("change",this,options);for(var attr in this.changed){if(this._pending[attr]||this._silent[attr])continue;delete this.changed[attr]}this._previousAttributes=_.clone(this.attributes)}this._changing=false;return this},hasChanged:function(attr){if(!arguments.length)return!_.isEmpty(this.changed);return _.has(this.changed,attr)},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):false;var val,changed=false,old=this._previousAttributes;for(var attr in diff){if(_.isEqual(old[attr],val=diff[attr]))continue;(changed||(changed={}))[attr]=val}return changed},previous:function(attr){if(!arguments.length||!this._previousAttributes)return null;return this._previousAttributes[attr]},previousAttributes:function(){return _.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(attrs,options){if(options.silent||!this.validate)return true;attrs=_.extend({},this.attributes,attrs);var error=this.validate(attrs,options);if(!error)return true;if(options&&options.error){options.error(this,error,options)}else{this.trigger("error",this,error,options)}return false}});var Collection=Backbone.Collection=function(models,options){options||(options={});if(options.model)this.model=options.model;if(options.comparator)this.comparator=options.comparator;this._reset();this.initialize.apply(this,arguments);if(models)this.reset(models,{silent:true,parse:options.parse})};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options)})},add:function(models,options){var i,index,length,model,cid,id,cids={},ids={},dups=[];options||(options={});models=_.isArray(models)?models.slice():[models];for(i=0,length=models.length;i<length;i++){if(!(model=models[i]=this._prepareModel(models[i],options))){throw new Error("Can't add an invalid model to a collection")}cid=model.cid;id=model.id;if(cids[cid]||this._byCid[cid]||id!=null&&(ids[id]||this._byId[id])){dups.push(i);continue}cids[cid]=ids[id]=model}i=dups.length;while(i--){models.splice(dups[i],1)}for(i=0,length=models.length;i<length;i++){(model=models[i]).on("all",this._onModelEvent,this);this._byCid[model.cid]=model;if(model.id!=null)this._byId[model.id]=model}this.length+=length;index=options.at!=null?options.at:this.models.length;splice.apply(this.models,[index,0].concat(models));if(this.comparator)this.sort({silent:true});if(options.silent)return this;for(i=0,length=this.models.length;i<length;i++){if(!cids[(model=this.models[i]).cid])continue;options.index=i;model.trigger("add",model,this,options)}return this},remove:function(models,options){var i,l,index,model;options||(options={});models=_.isArray(models)?models.slice():[models];for(i=0,l=models.length;i<l;i++){model=this.getByCid(models[i])||this.get(models[i]);if(!model)continue;delete this._byId[model.id];delete this._byCid[model.cid];index=this.indexOf(model);this.models.splice(index,1);this.length--;if(!options.silent){options.index=index;model.trigger("remove",model,this,options)}this._removeReference(model)}return this},push:function(model,options){model=this._prepareModel(model,options);this.add(model,options);return model},pop:function(options){var model=this.at(this.length-1);this.remove(model,options);return model},unshift:function(model,options){model=this._prepareModel(model,options);this.add(model,_.extend({at:0},options));return model},shift:function(options){var model=this.at(0);this.remove(model,options);return model},get:function(id){if(id==null)return void 0;return this._byId[id.id!=null?id.id:id]},getByCid:function(cid){return cid&&this._byCid[cid.cid||cid]},at:function(index){return this.models[index]},where:function(attrs){if(_.isEmpty(attrs))return[];return this.filter(function(model){for(var key in attrs){if(attrs[key]!==model.get(key))return false}return true})},sort:function(options){options||(options={});if(!this.comparator)throw new Error("Cannot sort a set without a comparator");var boundComparator=_.bind(this.comparator,this);if(this.comparator.length==1){this.models=this.sortBy(boundComparator)}else{this.models.sort(boundComparator)}if(!options.silent)this.trigger("reset",this,options);return this},pluck:function(attr){return _.map(this.models,function(model){return model.get(attr)})},reset:function(models,options){models||(models=[]);options||(options={});for(var i=0,l=this.models.length;i<l;i++){this._removeReference(this.models[i])}this._reset();this.add(models,_.extend({silent:true},options));if(!options.silent)this.trigger("reset",this,options);return this},fetch:function(options){options=options?_.clone(options):{};if(options.parse===undefined)options.parse=true;var collection=this;var success=options.success;options.success=function(resp,status,xhr){collection[options.add?"add":"reset"](collection.parse(resp,xhr),options);if(success)success(collection,resp)};options.error=Backbone.wrapError(options.error,collection,options);return(this.sync||Backbone.sync).call(this,"read",this,options)},create:function(model,options){var coll=this;options=options?_.clone(options):{};model=this._prepareModel(model,options);if(!model)return false;if(!options.wait)coll.add(model,options);var success=options.success;options.success=function(nextModel,resp,xhr){if(options.wait)coll.add(nextModel,options);if(success){success(nextModel,resp)}else{nextModel.trigger("sync",model,resp,options)}};model.save(null,options);return model},parse:function(resp,xhr){return resp},chain:function(){return _(this.models).chain()},_reset:function(options){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(model,options){options||(options={});if(!(model instanceof Model)){var attrs=model;options.collection=this;model=new this.model(attrs,options);if(!model._validate(model.attributes,options))model=false}else if(!model.collection){model.collection=this}return model},_removeReference:function(model){if(this==model.collection){delete model.collection}model.off("all",this._onModelEvent,this)},_onModelEvent:function(event,model,collection,options){if((event=="add"||event=="remove")&&collection!=this)return;if(event=="destroy"){this.remove(model,options)}if(model&&event==="change:"+model.idAttribute){delete this._byId[model.previous(model.idAttribute)];this._byId[model.id]=model}this.trigger.apply(this,arguments)}});var methods=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];_.each(methods,function(method){Collection.prototype[method]=function(){return _[method].apply(_,[this.models].concat(_.toArray(arguments)))}});var Router=Backbone.Router=function(options){options||(options={});if(options.routes)this.routes=options.routes;this._bindRoutes();this.initialize.apply(this,arguments)};var namedParam=/:\w+/g;var splatParam=/\*\w+/g;var escapeRegExp=/[-[\]{}()+?.,\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){Backbone.history||(Backbone.history=new History);if(!_.isRegExp(route))route=this._routeToRegExp(route);if(!callback)callback=this[name];Backbone.history.route(route,_.bind(function(fragment){var args=this._extractParameters(route,fragment);callback&&callback.apply(this,args);this.trigger.apply(this,["route:"+name].concat(args));Backbone.history.trigger("route",this,name,args)},this));return this},navigate:function(fragment,options){Backbone.history.navigate(fragment,options)},_bindRoutes:function(){if(!this.routes)return;var routes=[];for(var route in this.routes){routes.unshift([route,this.routes[route]])}for(var i=0,l=routes.length;i<l;i++){this.route(routes[i][0],routes[i][1],this[routes[i][1]])}},_routeToRegExp:function(route){route=route.replace(escapeRegExp,"\\$&").replace(namedParam,"([^/]+)").replace(splatParam,"(.*?)");return new RegExp("^"+route+"$")},_extractParameters:function(route,fragment){return route.exec(fragment).slice(1)}});var History=Backbone.History=function(){this.handlers=[];_.bindAll(this,"checkUrl")};var routeStripper=/^[#\/]/;var isExplorer=/msie [\w.]+/;History.started=false;_.extend(History.prototype,Events,{interval:50,getHash:function(windowOverride){var loc=windowOverride?windowOverride.location:window.location;var match=loc.href.match(/#(.*)$/);return match?match[1]:""},getFragment:function(fragment,forcePushState){if(fragment==null){if(this._hasPushState||forcePushState){fragment=window.location.pathname;var search=window.location.search;if(search)fragment+=search}else{fragment=this.getHash()}}if(!fragment.indexOf(this.options.root))fragment=fragment.substr(this.options.root.length);return fragment.replace(routeStripper,"")},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=true;this.options=_.extend({},{root:"/"},this.options,options);this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var fragment=this.getFragment();var docMode=document.documentMode;var oldIE=isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||docMode<=7);if(oldIE){this.iframe=$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(fragment)}if(this._hasPushState){$(window).bind("popstate",this.checkUrl)}else if(this._wantsHashChange&&"onhashchange"in window&&!oldIE){$(window).bind("hashchange",this.checkUrl)}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}this.fragment=fragment;var loc=window.location;var atRoot=loc.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!atRoot){this.fragment=this.getFragment(null,true);window.location.replace(this.options.root+"#"+this.fragment);return true}else if(this._wantsPushState&&this._hasPushState&&atRoot&&loc.hash){this.fragment=this.getHash().replace(routeStripper,"");window.history.replaceState({},document.title,loc.protocol+"//"+loc.host+this.options.root+this.fragment)}if(!this.options.silent){return this.loadUrl()}},stop:function(){$(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);History.started=false},route:function(route,callback){this.handlers.unshift({route:route,callback:callback})},checkUrl:function(e){var current=this.getFragment();if(current==this.fragment&&this.iframe)current=this.getFragment(this.getHash(this.iframe));if(current==this.fragment)return false;if(this.iframe)this.navigate(current);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(fragmentOverride){var fragment=this.fragment=this.getFragment(fragmentOverride);var matched=_.any(this.handlers,function(handler){if(handler.route.test(fragment)){handler.callback(fragment);return true}});return matched},navigate:function(fragment,options){if(!History.started)return false;if(!options||options===true)options={trigger:options};var frag=(fragment||"").replace(routeStripper,"");if(this.fragment==frag)return;if(this._hasPushState){if(frag.indexOf(this.options.root)!=0)frag=this.options.root+frag;this.fragment=frag;window.history[options.replace?"replaceState":"pushState"]({},document.title,frag)}else if(this._wantsHashChange){this.fragment=frag;this._updateHash(window.location,frag,options.replace);if(this.iframe&&frag!=this.getFragment(this.getHash(this.iframe))){if(!options.replace)this.iframe.document.open().close();this._updateHash(this.iframe.location,frag,options.replace)}}else{window.location.assign(this.options.root+fragment)}if(options.trigger)this.loadUrl(fragment)},_updateHash:function(location,fragment,replace){if(replace){location.replace(location.toString().replace(/(javascript:|#).*$/,"")+"#"+fragment)}else{location.hash=fragment}}});var View=Backbone.View=function(options){this.cid=_.uniqueId("view");this._configure(options||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var delegateEventSplitter=/^(\S+)\s*(.*)$/;var viewOptions=["model","collection","el","id","attributes","className","tagName"];_.extend(View.prototype,Events,{tagName:"div",$:function(selector){return this.$el.find(selector)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();return this},make:function(tagName,attributes,content){var el=document.createElement(tagName);if(attributes)$(el).attr(attributes);if(content!=null)$(el).html(content);return el},setElement:function(element,delegate){if(this.$el)this.undelegateEvents();this.$el=element instanceof $?element:$(element);this.el=this.$el[0];if(delegate!==false)this.delegateEvents();return this},delegateEvents:function(events){if(!(events||(events=getValue(this,"events"))))return;this.undelegateEvents();for(var key in events){var method=events[key];if(!_.isFunction(method))method=this[events[key]];if(!method)throw new Error('Method "'+events[key]+'" does not exist');var match=key.match(delegateEventSplitter);var eventName=match[1],selector=match[2];method=_.bind(method,this);eventName+=".delegateEvents"+this.cid;if(selector===""){this.$el.bind(eventName,method)}else{this.$el.delegate(selector,eventName,method)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(options){if(this.options)options=_.extend({},this.options,options);for(var i=0,l=viewOptions.length;i<l;i++){var attr=viewOptions[i];if(options[attr])this[attr]=options[attr]}this.options=options},_ensureElement:function(){if(!this.el){var attrs=getValue(this,"attributes")||{};if(this.id)attrs.id=this.id;if(this.className)attrs["class"]=this.className;this.setElement(this.make(this.tagName,attrs),false)}else{this.setElement(this.el,false)}}});var extend=function(protoProps,classProps){var child=inherits(this,protoProps,classProps);child.extend=this.extend;return child};Model.extend=Collection.extend=Router.extend=View.extend=extend;var methodMap={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};Backbone.sync=function(method,model,options){var type=methodMap[method];options||(options={});var params={type:type,dataType:"json"};if(!options.url){params.url=getValue(model,"url")||urlError()}if(!options.data&&model&&(method=="create"||method=="update")){params.contentType="application/json";params.data=JSON.stringify(model.toJSON())}if(Backbone.emulateJSON){params.contentType="application/x-www-form-urlencoded";params.data=params.data?{model:params.data}:{}}if(Backbone.emulateHTTP){if(type==="PUT"||type==="DELETE"){if(Backbone.emulateJSON)params.data._method=type;params.type="POST";params.beforeSend=function(xhr){xhr.setRequestHeader("X-HTTP-Method-Override",type)}}}if(params.type!=="GET"&&!Backbone.emulateJSON){params.processData=false}return $.ajax(_.extend(params,options))};Backbone.wrapError=function(onError,originalModel,options){return function(model,resp){resp=model===originalModel?resp:model;if(onError){onError(originalModel,resp,options)}else{originalModel.trigger("error",originalModel,resp,options)}}};var ctor=function(){};var inherits=function(parent,protoProps,staticProps){var child;if(protoProps&&protoProps.hasOwnProperty("constructor")){child=protoProps.constructor}else{child=function(){parent.apply(this,arguments)}}_.extend(child,parent);ctor.prototype=parent.prototype;child.prototype=new ctor;if(protoProps)_.extend(child.prototype,protoProps);if(staticProps)_.extend(child,staticProps);child.prototype.constructor=child;child.__super__=parent.prototype;return child};var getValue=function(object,prop){if(!(object&&object[prop]))return null;return _.isFunction(object[prop])?object[prop]():object[prop]};var urlError=function(){throw new Error('A "url" property or function must be specified')};return Backbone});
define('core/url',[],function(){function absURL(path,hostname){var port=location.port;port=port==""||port==80?"":":"+port;if(path.indexOf("/")==0){path=path.substring(1)}if(!hostname){hostname=location.hostname}return location.protocol+"//"+hostname+port+"/"+path}function getURIFragment(name){var regex_string="#"+name+"=([^&#]*)";var regex=new RegExp(regex_string);var result=regex.exec(window.location.hash);if(result==null){return""}else{return decodeURIComponent(result[1])}}function getURLParams(){var queryDict={};location.search.substr(1).split("&").forEach(function(item){key=decodeURIComponent(item.split("=")[0]);val=decodeURIComponent(item.split("=")[1]);queryDict[key]=val});return queryDict}function absExtURL(url){return"http://"+url.replace("http://","")}function wishURL(path){return location.protocol+"//"+path}function contestImageURL(contest_id,size,sequence_id){if(!size){size="medium"}if(!sequence_id){sequence_id=0}return window.lemmings_url+"/"+contest_id+"-"+sequence_id+"-"+size}function resizedContestImageURL(contest_id,width,height,sequence_id,mode){var url=window.location.protocol;url+="//contestimg./api/image/fetch?contest_id=";url+=contest_id;url+="&w=";url+=Math.ceil(width);url+="&h=";url+=Math.ceil(height);if(sequence_id){url+="&s=";url+=sequence_id}if(mode!=null){url+="&m=";url+=mode}return url}return{absURL:absURL,absExtURL:absExtURL,wishURL:wishURL,contestImageURL:contestImageURL,resizedContestImageURL:resizedContestImageURL,getURIFragment:getURIFragment,getURLParams:getURLParams}});
define('lib/jed',["underscore"],function(_){var Jed=function(options){this.defaults={locale_data:{messages:{"":{domain:"messages",lang:"en",plural_forms:"nplurals=2; plural=(n != 1);"}}},domain:"messages"};this.options=_.extend({},this.defaults,options);this.textdomain(this.options.domain);if(options.domain&&!this.options.locale_data[this.options.domain]){throw new Error("Text domain set to non-existent domain: `"+domain+"`")}};Jed.context_delimiter=String.fromCharCode(4);function getPluralFormFunc(plural_form_string){return Jed.PF.compile(plural_form_string||"nplurals=2; plural=(n != 1);")}function Chain(key,i18n){this._key=key;this._i18n=i18n}_.extend(Chain.prototype,{onDomain:function(domain){this._domain=domain;return this},withContext:function(context){this._context=context;return this},ifPlural:function(num,pkey){this._val=num;this._pkey=pkey;return this},fetch:function(sArr){if({}.toString.call(sArr)!="[object Array]"){sArr=[].slice.call(arguments)}return(sArr&&sArr.length?Jed.sprintf:function(x){return x})(this._i18n.dcnpgettext(this._domain,this._context,this._key,this._pkey,this._val),sArr)}});_.extend(Jed.prototype,{translate:function(key){return new Chain(key,this)},textdomain:function(domain){if(!domain){return this._textdomain}this._textdomain=domain},gettext:function(key){return this.dcnpgettext.call(this,undef,undef,key)},dgettext:function(domain,key){return this.dcnpgettext.call(this,domain,undef,key)},dcgettext:function(domain,key){return this.dcnpgettext.call(this,domain,undef,key)},ngettext:function(skey,pkey,val){return this.dcnpgettext.call(this,undef,undef,skey,pkey,val)},dngettext:function(domain,skey,pkey,val){return this.dcnpgettext.call(this,domain,undef,skey,pkey,val)},dcngettext:function(domain,skey,pkey,val){return this.dcnpgettext.call(this,domain,undef,skey,pkey,val)},pgettext:function(context,key){return this.dcnpgettext.call(this,undef,context,key)},dpgettext:function(domain,context,key){return this.dcnpgettext.call(this,domain,context,key)},dcpgettext:function(domain,context,key){return this.dcnpgettext.call(this,domain,context,key)},npgettext:function(context,skey,pkey,val){return this.dcnpgettext.call(this,undef,context,skey,pkey,val)},dnpgettext:function(domain,context,skey,pkey,val){return this.dcnpgettext.call(this,domain,context,skey,pkey,val)},dcnpgettext:function(domain,context,singular_key,plural_key,val){plural_key=plural_key||singular_key;domain=domain||this._textdomain;val=typeof val=="undefined"?1:val;var fallback;if(!this.options){fallback=new Jed;return fallback.dcnpgettext.call(fallback,undefined,undefined,singular_key,plural_key,val)}if(!this.options.locale_data){throw new Error("No locale data provided.")}if(!this.options.locale_data[domain]){throw new Error("Domain `"+domain+"` was not found.")}if(!this.options.locale_data[domain][""]){throw new Error("No locale meta information provided.")}if(!singular_key){throw new Error("No translation key found.")}if(typeof val!="number"){try{val=parseInt(val,10)}catch(e){throw new Error("Error parsing the value.")}if(isNaN(val)){throw new Error("The number that was passed in is not a number.")}}var key=context?context+Jed.context_delimiter+singular_key:singular_key,locale_data=this.options.locale_data,dict=locale_data[domain],pluralForms=dict[""].plural_forms||(locale_data.messages||this.defaults.locale_data.messages)[""].plural_forms,val_idx=getPluralFormFunc(pluralForms)(val)+1,val_list,res;if(!dict){throw new Error("No domain named `"+domain+"` could be found.")}val_list=dict[key];if(!val_list||val_idx>=val_list.length){res=[null,singular_key,plural_key];return res[getPluralFormFunc(pluralForms)(val)+1]}res=val_list[val_idx];if(!res){res=[null,singular_key,plural_key];return res[getPluralFormFunc(pluralForms)(val)+1]}return res}});var sprintf=function(){function get_type(variable){return Object.prototype.toString.call(variable).slice(8,-1).toLowerCase()}function str_repeat(input,multiplier){for(var output=[];multiplier>0;output[--multiplier]=input){}return output.join("")}var str_format=function(){if(!str_format.cache.hasOwnProperty(arguments[0])){str_format.cache[arguments[0]]=str_format.parse(arguments[0])}return str_format.format.call(null,str_format.cache[arguments[0]],arguments)};str_format.format=function(parse_tree,argv){var cursor=1,tree_length=parse_tree.length,node_type="",arg,output=[],i,k,match,pad,pad_character,pad_length;for(i=0;i<tree_length;i++){node_type=get_type(parse_tree[i]);if(node_type==="string"){output.push(parse_tree[i])}else if(node_type==="array"){match=parse_tree[i];if(match[2]){arg=argv[cursor];for(k=0;k<match[2].length;k++){if(!arg.hasOwnProperty(match[2][k])){throw sprintf('[sprintf] property "%s" does not exist',match[2][k])}arg=arg[match[2][k]]}}else if(match[1]){arg=argv[match[1]]}else{arg=argv[cursor++]}if(/[^s]/.test(match[8])&&get_type(arg)!="number"){throw sprintf("[sprintf] expecting number but found %s",get_type(arg))}if(typeof arg=="undefined"||arg===null){arg=""}switch(match[8]){case"b":arg=arg.toString(2);break;case"c":arg=String.fromCharCode(arg);break;case"d":arg=parseInt(arg,10);break;case"e":arg=match[7]?arg.toExponential(match[7]):arg.toExponential();break;case"f":arg=match[7]?parseFloat(arg).toFixed(match[7]):parseFloat(arg);break;case"o":arg=arg.toString(8);break;case"s":arg=(arg=String(arg))&&match[7]?arg.substring(0,match[7]):arg;break;case"u":arg=Math.abs(arg);break;case"x":arg=arg.toString(16);break;case"X":arg=arg.toString(16).toUpperCase();break}arg=/[def]/.test(match[8])&&match[3]&&arg>=0?"+"+arg:arg;pad_character=match[4]?match[4]=="0"?"0":match[4].charAt(1):" ";pad_length=match[6]-String(arg).length;pad=match[6]?str_repeat(pad_character,pad_length):"";output.push(match[5]?arg+pad:pad+arg)}}return output.join("")};str_format.cache={};str_format.parse=function(fmt){var _fmt=fmt,match=[],parse_tree=[],arg_names=0;while(_fmt){if((match=/^[^\x25]+/.exec(_fmt))!==null){parse_tree.push(match[0])}else if((match=/^\x25{2}/.exec(_fmt))!==null){parse_tree.push("%")}else if((match=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(_fmt))!==null){if(match[2]){arg_names|=1;var field_list=[],replacement_field=match[2],field_match=[];if((field_match=/^([a-z_][a-z_\d]*)/i.exec(replacement_field))!==null){field_list.push(field_match[1]);while((replacement_field=replacement_field.substring(field_match[0].length))!==""){if((field_match=/^\.([a-z_][a-z_\d]*)/i.exec(replacement_field))!==null){field_list.push(field_match[1])}else if((field_match=/^\[(\d+)\]/.exec(replacement_field))!==null){field_list.push(field_match[1])}else{throw"[sprintf] huh?"}}}else{throw"[sprintf] huh?"}match[2]=field_list}else{arg_names|=2}if(arg_names===3){throw"[sprintf] mixing positional and named placeholders is not (yet) supported"}parse_tree.push(match)}else{throw"[sprintf] huh?"}_fmt=_fmt.substring(match[0].length)}return parse_tree};return str_format}();var vsprintf=function(fmt,argv){argv.unshift(fmt);return sprintf.apply(null,argv)};Jed.parse_plural=function(plural_forms,n){plural_forms=plural_forms.replace(/n/g,n);return Jed.parse_expression(plural_forms)};Jed.sprintf=function(fmt,args){if({}.toString.call(args)=="[object Array]"){return vsprintf(fmt,[].slice.call(args))}return sprintf.apply(this,[].slice.call(arguments))};Jed.prototype.sprintf=function(){return Jed.sprintf.apply(this,arguments)};Jed.PF={};Jed.PF.parse=function(p){var plural_str=Jed.PF.extractPluralExpr(p);return Jed.PF.parser.parse.call(Jed.PF.parser,plural_str)};Jed.PF.compile=function(p){function imply(val){return val===true?1:val?val:0}var ast=Jed.PF.parse(p);return function(n){return imply(Jed.PF.interpreter(ast)(n))}};Jed.PF.interpreter=function(ast){return function(n){var res;switch(ast.type){case"GROUP":return Jed.PF.interpreter(ast.expr)(n);case"TERNARY":if(Jed.PF.interpreter(ast.expr)(n)){return Jed.PF.interpreter(ast.truthy)(n)}return Jed.PF.interpreter(ast.falsey)(n);case"OR":return Jed.PF.interpreter(ast.left)(n)||Jed.PF.interpreter(ast.right)(n);case"AND":return Jed.PF.interpreter(ast.left)(n)&&Jed.PF.interpreter(ast.right)(n);case"LT":return Jed.PF.interpreter(ast.left)(n)<Jed.PF.interpreter(ast.right)(n);case"GT":return Jed.PF.interpreter(ast.left)(n)>Jed.PF.interpreter(ast.right)(n);case"LTE":return Jed.PF.interpreter(ast.left)(n)<=Jed.PF.interpreter(ast.right)(n);case"GTE":return Jed.PF.interpreter(ast.left)(n)>=Jed.PF.interpreter(ast.right)(n);case"EQ":return Jed.PF.interpreter(ast.left)(n)==Jed.PF.interpreter(ast.right)(n);case"NEQ":return Jed.PF.interpreter(ast.left)(n)!=Jed.PF.interpreter(ast.right)(n);case"MOD":return Jed.PF.interpreter(ast.left)(n)%Jed.PF.interpreter(ast.right)(n);case"VAR":return n;case"NUM":return ast.val;default:throw new Error("Invalid Token found.")}}};Jed.PF.extractPluralExpr=function(p){p=p.replace(/^\s\s*/,"").replace(/\s\s*$/,"");if(!/;\s*$/.test(p)){p=p.concat(";")}var nplurals_re=/nplurals\=(\d+);/,plural_re=/plural\=(.*);/,nplurals_matches=p.match(nplurals_re),res={},plural_matches;if(nplurals_matches.length>1){res.nplurals=nplurals_matches[1]}else{throw new Error("nplurals not found in plural_forms string: "+p)}p=p.replace(nplurals_re,"");plural_matches=p.match(plural_re);if(!(plural_matches&&plural_matches.length>1)){throw new Error("`plural` expression not found: "+p)}return plural_matches[1]};Jed.PF.parser=function(){var parser={trace:function trace(){},yy:{},symbols_:{error:2,expressions:3,e:4,EOF:5,"?":6,":":7,"||":8,"&&":9,"<":10,"<=":11,">":12,">=":13,"!=":14,"==":15,"%":16,"(":17,")":18,n:19,NUMBER:20,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"?",7:":",8:"||",9:"&&",10:"<",11:"<=",12:">",13:">=",14:"!=",15:"==",16:"%",17:"(",18:")",19:"n",20:"NUMBER"},productions_:[0,[3,2],[4,5],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[4,1]],performAction:function anonymous(yytext,yyleng,yylineno,yy,yystate,$$,_$){var $0=$$.length-1;switch(yystate){case 1:return{type:"GROUP",expr:$$[$0-1]};break;case 2:this.$={type:"TERNARY",expr:$$[$0-4],truthy:$$[$0-2],falsey:$$[$0]};break;case 3:this.$={type:"OR",left:$$[$0-2],right:$$[$0]};break;case 4:this.$={type:"AND",left:$$[$0-2],right:$$[$0]};break;case 5:this.$={type:"LT",left:$$[$0-2],right:$$[$0]};break;case 6:this.$={type:"LTE",left:$$[$0-2],right:$$[$0]};break;case 7:this.$={type:"GT",left:$$[$0-2],right:$$[$0]};break;case 8:this.$={type:"GTE",left:$$[$0-2],right:$$[$0]};break;case 9:this.$={type:"NEQ",left:$$[$0-2],right:$$[$0]};break;case 10:this.$={type:"EQ",left:$$[$0-2],right:$$[$0]};break;case 11:this.$={type:"MOD",left:$$[$0-2],right:$$[$0]};break;case 12:this.$={type:"GROUP",expr:$$[$0-1]};break;case 13:this.$={type:"VAR"};break;case 14:this.$={type:"NUM",val:Number(yytext)};break}},table:[{3:1,4:2,17:[1,3],19:[1,4],20:[1,5]},{1:[3]},{5:[1,6],6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{4:17,17:[1,3],19:[1,4],20:[1,5]},{5:[2,13],6:[2,13],7:[2,13],8:[2,13],9:[2,13],10:[2,13],11:[2,13],12:[2,13],13:[2,13],14:[2,13],15:[2,13],16:[2,13],18:[2,13]},{5:[2,14],6:[2,14],7:[2,14],8:[2,14],9:[2,14],10:[2,14],11:[2,14],12:[2,14],13:[2,14],14:[2,14],15:[2,14],16:[2,14],18:[2,14]},{1:[2,1]},{4:18,17:[1,3],19:[1,4],20:[1,5]},{4:19,17:[1,3],19:[1,4],20:[1,5]},{4:20,17:[1,3],19:[1,4],20:[1,5]},{4:21,17:[1,3],19:[1,4],20:[1,5]},{4:22,17:[1,3],19:[1,4],20:[1,5]},{4:23,17:[1,3],19:[1,4],20:[1,5]},{4:24,17:[1,3],19:[1,4],20:[1,5]},{4:25,17:[1,3],19:[1,4],20:[1,5]},{4:26,17:[1,3],19:[1,4],20:[1,5]},{4:27,17:[1,3],19:[1,4],20:[1,5]},{6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[1,28]},{6:[1,7],7:[1,29],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{5:[2,3],6:[2,3],7:[2,3],8:[2,3],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,3]},{5:[2,4],6:[2,4],7:[2,4],8:[2,4],9:[2,4],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,4]},{5:[2,5],6:[2,5],7:[2,5],8:[2,5],9:[2,5],10:[2,5],11:[2,5],12:[2,5],13:[2,5],14:[2,5],15:[2,5],16:[1,16],18:[2,5]},{5:[2,6],6:[2,6],7:[2,6],8:[2,6],9:[2,6],10:[2,6],11:[2,6],12:[2,6],13:[2,6],14:[2,6],15:[2,6],16:[1,16],18:[2,6]},{5:[2,7],6:[2,7],7:[2,7],8:[2,7],9:[2,7],10:[2,7],11:[2,7],12:[2,7],13:[2,7],14:[2,7],15:[2,7],16:[1,16],18:[2,7]},{5:[2,8],6:[2,8],7:[2,8],8:[2,8],9:[2,8],10:[2,8],11:[2,8],12:[2,8],13:[2,8],14:[2,8],15:[2,8],16:[1,16],18:[2,8]},{5:[2,9],6:[2,9],7:[2,9],8:[2,9],9:[2,9],10:[2,9],11:[2,9],12:[2,9],13:[2,9],14:[2,9],15:[2,9],16:[1,16],18:[2,9]},{5:[2,10],6:[2,10],7:[2,10],8:[2,10],9:[2,10],10:[2,10],11:[2,10],12:[2,10],13:[2,10],14:[2,10],15:[2,10],16:[1,16],18:[2,10]},{5:[2,11],6:[2,11],7:[2,11],8:[2,11],9:[2,11],10:[2,11],11:[2,11],12:[2,11],13:[2,11],14:[2,11],15:[2,11],16:[2,11],18:[2,11]},{5:[2,12],6:[2,12],7:[2,12],8:[2,12],9:[2,12],10:[2,12],11:[2,12],12:[2,12],13:[2,12],14:[2,12],15:[2,12],16:[2,12],18:[2,12]},{4:30,17:[1,3],19:[1,4],20:[1,5]},{5:[2,2],6:[1,7],7:[2,2],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,2]}],defaultActions:{6:[2,1]},parseError:function parseError(str,hash){throw new Error(str)},parse:function parse(input){var self=this,stack=[0],vstack=[null],lstack=[],table=this.table,yytext="",yylineno=0,yyleng=0,recovering=0,TERROR=2,EOF=1;this.lexer.setInput(input);this.lexer.yy=this.yy;this.yy.lexer=this.lexer;if(typeof this.lexer.yylloc=="undefined")this.lexer.yylloc={};var yyloc=this.lexer.yylloc;lstack.push(yyloc);if(typeof this.yy.parseError==="function")this.parseError=this.yy.parseError;function popStack(n){stack.length=stack.length-2*n;vstack.length=vstack.length-n;lstack.length=lstack.length-n}function lex(){var token;token=self.lexer.lex()||1;if(typeof token!=="number"){token=self.symbols_[token]||token}return token}var symbol,preErrorSymbol,state,action,a,r,yyval={},p,len,newState,expected;while(true){state=stack[stack.length-1];if(this.defaultActions[state]){action=this.defaultActions[state]}else{if(symbol==null)symbol=lex();action=table[state]&&table[state][symbol]}_handle_error:if(typeof action==="undefined"||!action.length||!action[0]){if(!recovering){expected=[];for(p in table[state])if(this.terminals_[p]&&p>2){expected.push("'"+this.terminals_[p]+"'")}var errStr="";if(this.lexer.showPosition){errStr="Parse error on line "+(yylineno+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+expected.join(", ")+", got '"+this.terminals_[symbol]+"'"}else{errStr="Parse error on line "+(yylineno+1)+": Unexpected "+(symbol==1?"end of input":"'"+(this.terminals_[symbol]||symbol)+"'")}this.parseError(errStr,{text:this.lexer.match,token:this.terminals_[symbol]||symbol,line:this.lexer.yylineno,loc:yyloc,expected:expected})}if(recovering==3){if(symbol==EOF){throw new Error(errStr||"Parsing halted.")}yyleng=this.lexer.yyleng;yytext=this.lexer.yytext;yylineno=this.lexer.yylineno;yyloc=this.lexer.yylloc;symbol=lex()}while(1){if(TERROR.toString()in table[state]){break}if(state==0){throw new Error(errStr||"Parsing halted.")}popStack(1);state=stack[stack.length-1]}preErrorSymbol=symbol;symbol=TERROR;state=stack[stack.length-1];action=table[state]&&table[state][TERROR];recovering=3}if(action[0]instanceof Array&&action.length>1){throw new Error("Parse Error: multiple actions possible at state: "+state+", token: "+symbol)}switch(action[0]){case 1:stack.push(symbol);vstack.push(this.lexer.yytext);lstack.push(this.lexer.yylloc);stack.push(action[1]);symbol=null;if(!preErrorSymbol){yyleng=this.lexer.yyleng;yytext=this.lexer.yytext;yylineno=this.lexer.yylineno;yyloc=this.lexer.yylloc;if(recovering>0)recovering--}else{symbol=preErrorSymbol;preErrorSymbol=null}break;case 2:len=this.productions_[action[1]][1];yyval.$=vstack[vstack.length-len];yyval._$={first_line:lstack[lstack.length-(len||1)].first_line,last_line:lstack[lstack.length-1].last_line,first_column:lstack[lstack.length-(len||1)].first_column,last_column:lstack[lstack.length-1].last_column};r=this.performAction.call(yyval,yytext,yyleng,yylineno,this.yy,action[1],vstack,lstack);if(typeof r!=="undefined"){return r}if(len){stack=stack.slice(0,-1*len*2);vstack=vstack.slice(0,-1*len);lstack=lstack.slice(0,-1*len)}stack.push(this.productions_[action[1]][0]);vstack.push(yyval.$);lstack.push(yyval._$);newState=table[stack[stack.length-2]][stack[stack.length-1]];stack.push(newState);break;case 3:return true}}return true}};var lexer=function(){var lexer={EOF:1,parseError:function parseError(str,hash){if(this.yy.parseError){this.yy.parseError(str,hash)}else{throw new Error(str)}},setInput:function(input){this._input=input;this._more=this._less=this.done=false;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};return this},input:function(){var ch=this._input[0];this.yytext+=ch;this.yyleng++;this.match+=ch;this.matched+=ch;var lines=ch.match(/\n/);if(lines)this.yylineno++;this._input=this._input.slice(1);return ch},unput:function(ch){this._input=ch+this._input;return this},more:function(){this._more=true;return this},pastInput:function(){var past=this.matched.substr(0,this.matched.length-this.match.length);return(past.length>20?"...":"")+past.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var next=this.match;if(next.length<20){next+=this._input.substr(0,20-next.length)}return(next.substr(0,20)+(next.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var pre=this.pastInput();var c=new Array(pre.length+1).join("-");return pre+this.upcomingInput()+"\n"+c+"^"},next:function(){if(this.done){return this.EOF}if(!this._input)this.done=true;var token,match,col,lines;if(!this._more){this.yytext="";this.match=""}var rules=this._currentRules();for(var i=0;i<rules.length;i++){match=this._input.match(this.rules[rules[i]]);if(match){lines=match[0].match(/\n.*/g);if(lines)this.yylineno+=lines.length;this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:lines?lines[lines.length-1].length-1:this.yylloc.last_column+match[0].length};this.yytext+=match[0];this.match+=match[0];this.matches=match;this.yyleng=this.yytext.length;this._more=false;this._input=this._input.slice(match[0].length);this.matched+=match[0];token=this.performAction.call(this,this.yy,this,rules[i],this.conditionStack[this.conditionStack.length-1]);if(token)return token;else return}}if(this._input===""){return this.EOF}else{this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})}},lex:function lex(){var r=this.next();if(typeof r!=="undefined"){return r}else{return this.lex()}},begin:function begin(condition){this.conditionStack.push(condition)},popState:function popState(){return this.conditionStack.pop()},_currentRules:function _currentRules(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function begin(condition){this.begin(condition)}};lexer.performAction=function anonymous(yy,yy_,$avoiding_name_collisions,YY_START){var YYSTATE=YY_START;switch($avoiding_name_collisions){case 0:break;case 1:return 20;break;case 2:return 19;break;case 3:return 8;break;case 4:return 9;break;case 5:return 6;break;case 6:return 7;break;case 7:return 11;break;case 8:return 13;break;case 9:return 10;break;case 10:return 12;break;case 11:return 14;break;case 12:return 15;break;case 13:return 16;break;case 14:return 17;break;case 15:return 18;break;case 16:return 5;break;case 17:return"INVALID";break}};lexer.rules=[/^\s+/,/^[0-9]+(\.[0-9]+)?\b/,/^n\b/,/^\|\|/,/^&&/,/^\?/,/^:/,/^<=/,/^>=/,/^</,/^>/,/^!=/,/^==/,/^%/,/^\(/,/^\)/,/^$/,/^./];lexer.conditions={INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],inclusive:true}};return lexer}();parser.lexer=lexer;return parser}();return{Jed:Jed}});
define('core/i18n',["lib/jed"],function(jed){var Jed=jed.Jed;var locale=window.locale_info["locale"];var jedi18n=undefined;if(window.locale_info["locale_json"]==undefined){jedi18n=new Jed({})}else{jedi18n=new Jed({domain:"wish",locale_data:window.locale_info["locale_json"]})}function _i18n(str){var _args=Array.prototype.slice.apply(arguments);if(typeof str!=="string"){console.log("You passed in '"+str+"' to i18n, did you mean ni18n?")}var result=jedi18n.translate(str).fetch(_args.slice(1));if(locale=="up"){result=result.toUpperCase()}return result}function _ni18n(num,singular,plural){var _args=Array.prototype.slice.apply(arguments);format_args=_args.slice(3);format_args.splice(0,0,_args[0]);var str=jedi18n.translate(singular).ifPlural(num,plural).fetch(format_args);if(locale=="up"){str=str.toUpperCase()}return str}function _ci18n(context,message){context=context.toUpperCase();var _args=Array.prototype.slice.apply(arguments);if(!context){return _i18n(message)}var result=jedi18n.translate(message).withContext(context).fetch(_args.slice(1));if(locale=="up"){result=result.toUpperCase()}return result}function _cni18n(context,num,singular,plural){context=context.toUpperCase();var _args=Array.prototype.slice.apply(arguments);format_args=_args.slice(4);format_args.splice(0,0,_args[1]);if(!context){return _ni18n(num,singular,plural)}var str=jedi18n.translate(singular).ifPlural(num,plural).withContext(context).fetch(format_args);if(locale=="up"){str=str.toUpperCase()}return str}return{i18n:_i18n,ni18n:_ni18n,ci18n:_ci18n,cni18n:_cni18n,sprintf:Jed.sprintf}});
define('core/string_utils',["core/i18n"],function(i18nModule){var i18n=i18nModule.i18n;function formatPhoneNumber(num){num=num.replace(/\D/g,"");if(num.length==10){return num.replace(/(\d{3})(\d{3})(\d{4})/,"$1-$2-$3")}else if(num.length==11){return num.replace(/(\d{1})(\d{3})(\d{3})(\d{4})/,"($1) $2-$3-$4")}else{return num}}function round(num,fixed){if(typeof fixed==="undefined"||!fixed){return Math.round(parseFloat(num))}return parseFloat(num).toFixed(fixed)}function formatPercentage(num,denom,fixed){if(!fixed)fixed=0;var n=parseFloat(num);var d=parseFloat(denom);if(d==0)return"100%";return(n/d*100).toFixed(fixed)+"%"}function newlineToBr(html_string){return html_string.replace(/\n/g,"<br>")}function validatePhoneNumberComponent(type,num){if(type==="phone_number_country"){if(num!=num.replace(/\D/g,"")){return i18n("电话号码不能包含非数字字符。")}if(!(1<=num.length&&num.length<=3)){return i18n("国家代码的长度不正确")}}else if(type==="phone_number_area"){if(num!=num.replace(/\D/g,"")){return i18n("电话号码不能包含非数字的字符。")}if(!(0<=num.length&&num.length<=3)){return i18n("区域代码不是正确的长度")}}else if(type==="phone_number_number"){if(num.indexOf("x")>=0){example="<br>Ex. + 1 - 234 - 5678910x1234";num=num.split("x");if(num.length!=2){return i18n("有分机的电话号码可以但仅限于包含一个x。")+example}if(num[1].length==0){return i18n("分机号码丢失。")+example}if(num[1]!=num[1].replace(/\D/g,"")){return i18n("不能包含非数字的扩展字符。")+example}return validatePhoneNumberComponent(type,num[0])}else{if(num!=num.replace(/\D/g,"")){return i18n("电话号码不能包含非数字的字符。")}if(!(6<=num.length&&num.length<=11)){return i18n("电话号码长度不正确")}}}else{return"Unhandled exception, please contact support"}return true}function cleanPhoneNumber(phone_number){if(phone_number[0]!="+"){phone_number="+"+phone_number}while(phone_number.indexOf("+0")>=0){phone_number="+"+phone_number.substring(2,phone_number.length)}return phone_number}function pluralStr(num,singular,plural){if(num==1){return singular}return plural}function isInt(n){return n%1==0}function addCommas(nStr){nStr+="";x=nStr.split(".");x1=x[0];x2=x.length>1?"."+x[1]:"";var rgx=/(\d+)(\d{3})/;while(rgx.test(x1)){x1=x1.replace(rgx,"$1"+","+"$2")}return x1+x2}function getRatio(numerator,denominator,accuracy,is_percent){var x=parseFloat(numerator);var y=parseFloat(denominator);var to_return=0;if(y!=0&&!isNaN(y)){to_return=x*1/y}if(is_percent==true&&to_return>100){to_return=100}return to_return.toFixed(accuracy)}function checkTimeFromNow(time,diff){var today=new Date;var d=new Date(time.substring(6),time.substring(0,2)-1,time.substring(3,5));d.setDate(d.getDate()+diff);return d<today}function formatCurrency(_n,includeDollar,shouldAddCommas,maxNumber,currencyName){var n=parseFloat(_n);if(isNaN(n)){return _n}if(typeof includeDollar==="undefined"){includeDollar=true}if(typeof shouldAddCommas==="undefined"){shouldAddCommas=true}var addPlus=false;if(maxNumber&&!isNaN(maxNumber)){if(n>maxNumber){n=maxNumber;addPlus=true}}var formatted=n.toFixed(2);if(shouldAddCommas){formatted=addCommas(formatted)}if(includeDollar){formatted="$"+formatted}if(addPlus){formatted=formatted+"+"}if(currencyName){formatted=formatted+'<span class="currency-subscript">'+currencyName+"</span>"}return formatted}function validateVolume(str){var volume_format=/^(\d+(\.\d+)?)\s*(ml|l|oz\.?|m\^3|cm\^3|gallon|quart|cup|qt\.?|pt\.?|litre|liter|pint|fl\.?\s?oz\.?)s?$/gi;if(str.match(volume_format))return true;return false}function validateLength(str){var length_format_1=/^(\d+(\.\d+)?)\s*(mm|cm|m|in\.?|inch(es)?|\"|\'|ft\.?|feet)$/gi;var length_format_2=/^(\d+(\.\d+)?)\s*(ft.?|feet|\')\s*(\d+(\.\d+)?)\s*(in\.?|inche(es)?|\")$/gi;if(str.match(length_format_1)||str.match(length_format_2))return true;return false}function validateArea(str){var area_format_1=/^(\d+(\.\d+)?)\s*(mm|cm|m|in\.?|inch(es)?|\"|\'|ft\.?|feet)\s*(\*|x|by)\s*(\d+(\.\d*)?)\s*(mm|cm|m|in\.?|inch(es)?|\"|\'|ft\.?|feet)$/gi;var area_format_2=/^(\d+(\.\d+)?)\s*(mm|cm|m|in\.?|inch(es)?|\"|\'|ft\.?|feet)\s*(\*|x|by)\s*(\d+(\.\d*)?)\s*(mm|cm|m|in\.?|inch(es)?|\"|\'|ft\.?|feet)\s*(\*|x|X|by)\s*(\d+(\.\d*)?)\s*(mm|cm|m|in\.?|inch(es)?|\"|\'|ft\.?|feet)$/gi;if(str.match(area_format_1)||str.match(area_format_2))return true;return false}function validateVoltage(str){var voltage_format=/^(\d+(\.\d+)?)\s*v$/gi;if(str.match(voltage_format))return true;return false}function validateWeight(str){var weight_format=/^(\d+(\.\d+)?)\s*(mg|g|kg|oz\.?|ounce|gram|pound|lb)s?$/gi;if(str.match(weight_format))return true;return false}function validateSize(size_string,valid_size_names){if(_.indexOf(valid_size_names,size_string)!=-1||!isNaN(size_string)){return false}else if(validateWeight(size_string)||validateLength(size_string)||validateVoltage(size_string)||validateArea(size_string)||validateVolume(size_string)){return false}else{return"Invalid size"}}function validateColor(color_string,valid_color_names){var colors=color_string.toLowerCase().replace(/ /g,"").split("&");if(colors.length>2){return"No more than two colors"}var invalid_colors=_.filter(colors,_.bind(function(color){return _.indexOf(valid_color_names,color)==-1},this));if(invalid_colors.length){return"Invalid color"}return false}function validateShippingTime(time_string){var shipping_times=time_string.split("-");if(shipping_times.length==2){var min_shipping_time=shipping_times[0];var max_shipping_time=shipping_times[1];if(isInt(min_shipping_time)&&isInt(max_shipping_time)){min_shipping_time=parseInt(min_shipping_time);max_shipping_time=parseInt(max_shipping_time);if(min_shipping_time>=2&&max_shipping_time>min_shipping_time){return false}}}return"Invalid shipping time"}function containsChineseCharacter(str){var re=/^.*[\u4E00-\u9FA5].*$/;return re.test(str)}function validateEmail(email){var re=/(^[-!#$%&'*+/=?^_`{}|~0-9A-Z]+(\.[-!#$%&'*+/=?^_`{}|~0-9A-Z]+)*|^"([\001-\010\013\014\016-\037!#-\[\]-\177]|\\[\001-011\013\014\016-\177])*")@(?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\.)+[A-Z]{2,10}\.?$/i;return re.test(email)}function validateURL(url){var re=/^.+\..+\/.+$/;return re.test(url)}function validateMinMaxShipTime(ship_time){if(ship_time%1==0){return false}return"Ship time must be a number"}function validatePrice(price){var re=/^\d{0,2}(\.\d{0,2}){0,1}$/;if(price.match(re)){return false}return"Invalid retail price"}function escapeCSS(text){return text.replace(/[!"#$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g,"\\\\$&")}function is_ascii(text){for(var i=0;i<text.length;i++){if(text.charCodeAt(i)>=128){return false}}return true}function escape(s){var n=s;n=n.replace(/&/g,"&amp;");n=n.replace(/</g,"&lt;");n=n.replace(/>/g,"&gt;");n=n.replace(/"/g,"&quot;");return n}function diffString(o,n){o=o.replace(/\s+$/,"");n=n.replace(/\s+$/,"");var out=diff(o==""?[]:o.split(/\s+/),n==""?[]:n.split(/\s+/));var str="";var oSpace=o.match(/\s+/g);if(oSpace==null){oSpace=["\n"]}else{oSpace.push("\n")}var nSpace=n.match(/\s+/g);if(nSpace==null){nSpace=["\n"]}else{nSpace.push("\n")}if(out.n.length==0){for(var i=0;i<out.o.length;i++){str+="<del>"+escape(out.o[i])+oSpace[i]+"</del>"}}else{if(out.n[0].text==null){for(n=0;n<out.o.length&&out.o[n].text==null;n++){str+="<del>"+escape(out.o[n])+oSpace[n]+"</del>"}}for(var i=0;i<out.n.length;i++){if(out.n[i].text==null){str+="<ins>"+escape(out.n[i])+nSpace[i]+"</ins>"}else{var pre="";for(n=out.n[i].row+1;n<out.o.length&&out.o[n].text==null;n++){pre+="<del>"+escape(out.o[n])+oSpace[n]+"</del>"}str+=" "+out.n[i].text+nSpace[i]+pre}}}return str}function diff(o,n){var ns=new Object;var os=new Object;for(var i=0;i<n.length;i++){if(ns[n[i]]==null)ns[n[i]]={rows:new Array,o:null};ns[n[i]].rows.push(i)}for(var i=0;i<o.length;i++){if(os[o[i]]==null)os[o[i]]={rows:new Array,n:null};os[o[i]].rows.push(i)}for(var i in ns){if(ns[i].rows.length==1&&typeof os[i]!="undefined"&&os[i].rows.length==1){n[ns[i].rows[0]]={text:n[ns[i].rows[0]],row:os[i].rows[0]};o[os[i].rows[0]]={text:o[os[i].rows[0]],row:ns[i].rows[0]}}}for(var i=0;i<n.length-1;i++){if(n[i].text!=null&&n[i+1].text==null&&n[i].row+1<o.length&&o[n[i].row+1].text==null&&n[i+1]==o[n[i].row+1]){n[i+1]={text:n[i+1],row:n[i].row+1};o[n[i].row+1]={text:o[n[i].row+1],row:i+1}}}for(var i=n.length-1;i>0;i--){if(n[i].text!=null&&n[i-1].text==null&&n[i].row>0&&o[n[i].row-1].text==null&&n[i-1]==o[n[i].row-1]){n[i-1]={text:n[i-1],row:n[i].row-1};o[n[i].row-1]={text:o[n[i].row-1],row:i-1}}}return{o:o,n:n}}return{roundFloat:round,checkTimeFromNow:checkTimeFromNow,getRatio:getRatio,addCommas:addCommas,formatCurrency:formatCurrency,pluralStr:pluralStr,formatPhoneNumber:formatPhoneNumber,newlineToBr:newlineToBr,validatePhoneNumberComponent:validatePhoneNumberComponent,validateSize:validateSize,validateArea:validateArea,validateColor:validateColor,validateShippingTime:validateShippingTime,validateEmail:validateEmail,validateURL:validateURL,validateMinMaxShipTime:validateMinMaxShipTime,containsChineseCharacter:containsChineseCharacter,cleanPhoneNumber:cleanPhoneNumber,validateVolume:validateVolume,validateWeight:validateWeight,validateLength:validateLength,validateVoltage:validateVoltage,formatPercentage:formatPercentage,validatePrice:validatePrice,escapeCSS:escapeCSS,is_ascii:is_ascii,diffString:diffString}});
define('core/template',["underscore","core/url","core/string_utils","core/i18n"],function(_,url,string,i18nModule){var GlobalTplContext={wishURL:url.wishURL,absURL:url.absURL,absExtURL:url.absExtURL,contestImageURL:url.contestImageURL,resizedContestImageURL:url.resizedContestImageURL,formatCurrency:string.formatCurrency,pluralStr:string.pluralStr,formatPhoneNumber:string.formatPhoneNumber,newlineToBr:string.newlineToBr,addCommas:string.addCommas,getRatio:string.getRatio,checkTimeFromNow:string.checkTimeFromNow,formatPercentage:string.formatPercentage,roundFloat:string.roundFloat,_:_};_.extend(GlobalTplContext,i18nModule);if(typeof window.staticUrl!==undefined){GlobalTplContext["staticUrl"]=window.staticUrl}function buildTemplate(tpl){if(typeof tpl=="string"){tpl=_.template(tpl)}function renderWrapper(data){data=data?data:{};return tpl(_.extend(data,GlobalTplContext))}return renderWrapper}return{buildTemplate:buildTemplate}});
define('lib/jquery.cookie',[],function(){(function($,document,undefined){var pluses=/\+/g;function raw(s){return s}function decoded(s){return decodeURIComponent(s.replace(pluses," "))}var config=$.cookie=function(key,value,options){if(value!==undefined){options=$.extend({},config.defaults,options);if(value===null){options.expires=-1}if(typeof options.expires==="number"){var days=options.expires,t=options.expires=new Date;t.setDate(t.getDate()+days)}value=config.json?JSON.stringify(value):String(value);return document.cookie=[encodeURIComponent(key),"=",config.raw?value:encodeURIComponent(value),options.expires?"; expires="+options.expires.toUTCString():"",options.path?"; path="+options.path:"",options.domain?"; domain="+options.domain:"",options.secure?"; secure":""].join("")}var decode=config.raw?raw:decoded;var cookies=document.cookie.split("; ");for(var i=0,parts;parts=cookies[i]&&cookies[i].split("=");i++){if(decode(parts.shift())===key){var cookie=decode(parts.join("="));return config.json?JSON.parse(cookie):cookie}}return null};config.defaults={};$.removeCookie=function(key,options){if($.cookie(key)!==null){$.cookie(key,null,options);return true}return false}})(jQuery,document)});
(function(){var progIds=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],tplSplitRegExp=/^\/\/ ([A-Z0-9_]+) \\\\/im,buildMap={},templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},escapes={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g,template=function(text){var matcher=new RegExp([(templateSettings.escape||noMatch).source,(templateSettings.interpolate||noMatch).source,(templateSettings.evaluate||noMatch).source].join("|")+"|$","g");var index=0;var source="__p+='";text=text.replace(/[ \n\t\r]+/g," ");text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,function(match){return"\\"+escapes[match]});source+=escape?"'+((__t=("+escape+"))==null?'':_.escape(__t))+'":interpolate?"'+((__t=("+interpolate+"))==null?'':__t)+'":evaluate?"';"+evaluate+" __p+='":"";index=offset+match.length});source+="';";source=source.replace(/[ \t]+/g," ");source="with(obj||{}){"+source+"}";source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};"+source+"return __p;";return source};define('tpl',[],function(){var tpl;var get,fs;if(typeof window!=="undefined"&&window.navigator&&window.document){get=function(url,callback){var xhr=tpl.createXhr();xhr.open("GET",url,true);xhr.onreadystatechange=function(evt){if(xhr.readyState===4){callback(xhr.responseText)}};xhr.send(null)}}else if(typeof process!=="undefined"&&process.versions&&!!process.versions.node){fs=require.nodeRequire("fs");get=function(url,callback){callback(fs.readFileSync(url,"utf8"))}}return tpl={version:"0.24.0",jsEscape:function(content){return content.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g," ").replace(/[\t]/g," ").replace(/[\r]/g," ")},createXhr:function(){var xhr,i,progId;if(typeof XMLHttpRequest!=="undefined"){return new XMLHttpRequest}else{for(i=0;i<3;i++){progId=progIds[i];try{xhr=new ActiveXObject(progId)}catch(e){}if(xhr){progIds=[progId];break}}}if(!xhr){throw new Error("require.getXhr(): XMLHttpRequest not available")}return xhr},get:get,load:function(name,req,onLoad,config){var filePrefix="../../templates/js/";if(config.locale){filePrefix="../../templates/build-js-"+config.locale+"/"}var fileName=filePrefix+name;var url="nameToUrl"in req?req.nameToUrl(fileName,".html"):req.toUrl(fileName+".html");var tplBegin=url.indexOf(filePrefix);url=config.baseUrl+filePrefix+name+".html";if(buildMap.hasOwnProperty(name)){return onLoad(buildMap[name])}tpl.get(url,function(content){subtemplates=content.split(tplSplitRegExp);if(subtemplates[0]==""){subtemplates=subtemplates.slice(1)}content_obj={};for(var i=0;i<subtemplates.length;i+=2){content_obj[subtemplates[i]]=template(subtemplates[i+1])}if(config.isBuild){pieces=[];for(tpl_name in content_obj){if(content_obj.hasOwnProperty(tpl_name)){pieces.push('"'+tpl_name+'"'+":function(obj){"+content_obj[tpl_name]+"}")}}ret_content="return {"+pieces.join(",")+"};"}else{ret_content={};for(tpl_name in content_obj){if(content_obj.hasOwnProperty(tpl_name)){try{ret_content[tpl_name]=new Function("obj",content_obj[tpl_name])}catch(e){console.log("Exception compiling "+tpl_name);console.debug("Template output (beautify & syntax check...):");console.debug(content_obj[tpl_name]);throw e}}}}buildMap[name]=ret_content;onLoad(ret_content)})},write:function(pluginName,moduleName,write){if(moduleName in buildMap){var content=tpl.jsEscape(buildMap[moduleName]);write("define('"+pluginName+"!"+moduleName+"', function() {"+content.replace(/(\\')/g,"'").replace(/(\\\\)/g,"\\")+"});\n")}}};return function(){}})})();
define('tpl!modal', function() {return {"alert_modal":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="modal hide fade"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button> <h3>'+((__t=(title))==null?'':_.escape(__t))+'</h3> </div> <div class="modal-body"> <div class="alert alert-'+((__t=(type))==null?'':_.escape(__t))+'"> <strong> '; _.each(message.split('\n'), function(msg) { __p+=' <p>'+((__t=(msg))==null?'':_.escape(__t))+'</p> '; }); __p+=' </strong> </div> </div> <div class="modal-footer"> <a data-dismiss="modal" class="btn btn-primary" id="'+((__t=(type))==null?'':_.escape(__t))+'-btn">OK</a> </div> </div> ';}return __p;},"info_modal":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="modal hide fade"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button> <h3>'+((__t=(title))==null?'':_.escape(__t))+'</h3> </div> <div class="modal-body"> '; if (typeof body !== "undefined") { __p+=' '+((__t=(body))==null?'':__t)+' '; } else { __p+=' <div class=""> <strong> '; _.each(message.split('\n'), function(msg) { __p+=' <p>'+((__t=(msg))==null?'':_.escape(__t))+'</p> '; }); __p+=' </strong> </div> '; } __p+=' </div> <div class="modal-footer"> <a data-dismiss="modal" class="btn btn-primary">OK</a> </div> </div> ';}return __p;},"relogin_modal":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="modal hide fade"> <div class="modal-header" style="background: #f1f1f1"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button> <h3 style="text-align: center;">'+((__t=(title))==null?'':_.escape(__t))+'</h3> </div> <div class="modal-body"> <div style="text-align: center; padding: 0px 40px 0px 40px; font-size: 16px; margin-top: 5px;"> <div style="font-size: 14px"> '; _.each(message.split('\n'), function(msg) { __p+=' <p>'+((__t=(msg))==null?'':_.escape(__t))+'</p> '; }); __p+=' </div> <table> <tr> <td valign="middle" style="font-size: 14px; text-align: right; padding-bottom: 10px"> '+((__t=(username_prompt))==null?'':_.escape(__t))+': </td> <td> <input id="username" style="text-align:left; padding: 10px; width: 275px;" type="text" value="'+((__t=(username_txt))==null?'':_.escape(__t))+'" required="true" disabled /> </td> </tr> <tr> <td valign="middle" style="font-size: 14px; text-align: right; padding-bottom: 10px"> '+((__t=(password_prompt))==null?'':_.escape(__t))+': </td> <td> <input id="password" type="password" name="password" style="text-align:left; padding: 10px; width:275px;" required="true" placeholder="'+((__t=(password_txt))==null?'':_.escape(__t))+'" /> </td> </tr> </table> </div> </div> <div class="modal-footer"> <a data-dismiss="modal" class="btn btn-cancel">'+((__t=(cancel_txt))==null?'':_.escape(__t))+'</a> <a class="btn btn-primary" id="relogin-btn" >'+((__t=(relogin_txt))==null?'':_.escape(__t))+'</a> </div> </div> ';}return __p;}};});

define('core/api',["underscore","core/url","lib/jquery.cookie","tpl!modal","core/i18n"],function(_,urlModule,cookie,modals,i18n){var i18n=i18n.i18n;function _handleError(resp,data,xhr,opt,cb,call_data){if(window.debug){if(resp){console.debug("API call error: %s (code %d)",resp.msg,resp.code)}if(data&&data.trace){console.debug(data.trace)}else if(resp.data&&resp.data.trace){console.debug(resp.data.trace)}}if(resp.code==2&&resp.data.session_expired==true){setTimeout(function(){window.location=urlModule.absURL("/login")},3500)}if(resp.code==3&&resp.data.secure_session_expired==true){var uname=resp.data.username;launchReloginModal(uname,call_data)}if(cb){cb(resp,data,xhr,opt)}else{var msg=resp&&resp.msg?resp.msg:i18n("未知错误");launchErrorModal(msg)}}function launchErrorModal(message){var modal_el=modals.alert_modal({title:"Error",message:message,type:"error"});var $modal_el=$(modal_el);$modal_el.modal({});$modal_el.on("hidden",function(){$modal_el.remove()});return $modal_el}function launchReloginModal(uname,call_data){var modal_el=modals.relogin_modal({title:i18n("请重新输入你的密码"),message:i18n("为了你的安全,你必须重新输入密码继续操作:"),username_txt:uname,password_txt:i18n("密码"),username_prompt:i18n("用户名"),password_prompt:i18n("重新输入密码"),relogin_txt:i18n("提交密码"),cancel_txt:i18n("取消")});var $modal_el=$(modal_el);var $pwd_box=$modal_el.find("#password");var $relogin_btn=$modal_el.find("#relogin-btn");var $click_btn=$relogin_btn;$modal_el.on("shown",function(){$pwd_box.focus()});$modal_el.modal({});$relogin_btn.on("click",function(){pwd=$pwd_box.val();if(pwd==""){$err_modal=launchErrorModal(i18n("请输入密码"));$mb=$modal_el.find(".modal-body");$click_btn=$err_modal.find(".btn");$err_modal.find(".modal-body").css({height:$mb.height(),width:$mb.width()});return}call("relogin",{password:pwd},function(){$modal_el.modal("hide");call.apply(this,call_data)},function(){$err_modal=launchErrorModal(i18n("不正确的密码"));$mb=$modal_el.find(".modal-body");$click_btn=$err_modal.find(".btn");$err_modal.find(".modal-body").css({height:$mb.height(),width:$mb.width()})})});$pwd_box.keypress(function(evt){if(evt.keyCode==13){$click_btn.click();if($click_btn!=$relogin_btn){$click_btn=$relogin_btn}}});$modal_el.on("hidden",function(){$modal_el.remove()})}function launchSuccessModal(message){var modal_el=modals.alert_modal({title:"Success",message:message,type:"success"});var $modal_el=$(modal_el);$modal_el.modal({});$modal_el.on("hidden",function(){$modal_el.remove()});return $modal_el}function launchInfoModal(message,title){var modal_el=modals.info_modal({title:title,message:message});var $modal_el=$(modal_el);$modal_el.modal({});$modal_el.on("hidden",function(){$modal_el.remove()})}var makeOriginalXhr=_.bind($.ajaxSettings.xhr,$.ajaxSettings);var newOptions={};function handleOnProgress(evt,options){if(typeof options.progress==="function"){options.progress(options.__jqXHR,evt)}}newOptions.xhr=function(){var s=this;var newXhr=makeOriginalXhr();if(newXhr){newXhr.addEventListener("progress",function(evt){handleOnProgress(evt,s)})}return newXhr};$.ajaxSetup(newOptions);function call(method,params,callback,errorCallback,data,selector){var url=urlModule.absURL("api/"+method);var args=arguments;_.each(params,function(v,k){if(v==null){delete params[k]}});return $.ajax({beforeSend:function(xhr,settings){xhr.setRequestHeader("X-XSRFToken",$.cookie("_xsrf"));return true},type:"POST",url:url,dataType:"json",data:params,success:function(o,xhr,opt){o.additional_data=data;if(callback){callback(o,data,xhr,opt)}},error:function(xhr,opt,data){if(opt=="abort"){return}else{try{resp=jQuery.parseJSON(xhr.responseText)}catch(err){if(xhr.status==504){resp={code:4,msg:"Request Timedout"}}else{resp={code:9,msg:"Unknown Error"}}}_handleError(resp,data,xhr,opt,errorCallback,args)}}})}function file(method,params,callback,progressCallback,errorCallback,data,selector){var url=urlModule.absURL("api/"+method);_.each(params,function(v,k){if(v==null){delete params[k]}});return $.ajax({beforeSend:function(xhr,settings){xhr.setRequestHeader("X-XSRFToken",$.cookie("_xsrf"));return true},progress:function(xhr,progressEvent){if(progressCallback){progressCallback(progressEvent)}},type:"POST",url:url,data:params,processData:false,contentType:false,success:function(o,xhr,opt){if(callback){callback(o,data,xhr,opt)}},error:function(xhr,opt,data){if(opt=="abort"){return}else{try{resp=jQuery.parseJSON(xhr.responseText)}catch(err){if(xhr.status==504){resp={code:4,msg:"Request Timedout"}}else{resp={code:9,msg:"Unknown Error"}}}_handleError(resp,data,xhr,opt,errorCallback,arguments)}}})}return{launchSuccessModal:launchSuccessModal,launchErrorModal:launchErrorModal,launchInfoModal:launchInfoModal,call:call,file:file,_handleError:_handleError}});
define('core/bb',["backbone","core/template","core/api"],function(Backbone,TplModule,api){var BackboneView=Backbone.View.extend({buildTpl:function(tpl){return TplModule.buildTemplate(tpl)}});var BackboneModel=Backbone.Model.extend({readOnlyAttributes:[],sync:function(method,model,_options){var options={};$.extend(true,options,_options);var urlPostfix=method;if(method=="read"){urlPostfix="get"}if(!options.url){options.url=model.urlRoot}options.url+="/"+urlPostfix;var params=model.toJSON();return api.call(options.url,params,options.callback,options.errorCallback,options.data,options.selector)},fetch:function(_options){var options={};$.extend(true,options,_options);var model=this;var callback=options.callback;options.callback=_.bind(function(resp,data,xhr,opt){if(!model.set(model.parse(resp,xhr),options))return false;if(callback)callback(model,resp)},this);return this.sync.call(this,"read",this,options)},save:function(_options){var options={};$.extend(true,options,_options);var model=this;var callback=options.callback;options.callback=_.bind(function(resp,data,xhr,opt){if(!model.set(model.parse(resp,xhr),options))return false;if(callback)callback(model,resp)},this);var method=this.isNew()?"create":"update";return this.sync.call(this,method,this,options)},destroy:function(_options){var options={};$.extend(true,options,_options);var model=this;var triggerDestroy=function(){model.trigger("destroy",model,model.collection,options)};if(this.isNew()){triggerDestroy();return false}var callback=options.callback;options.callback=function(resp){if(options.wait)triggerDestroy();if(callback){callback(model,resp)}else{model.trigger("sync",model,resp,options)}};options.error=Backbone.wrapError(options.error,model,options);var xhr=(this.sync||Backbone.sync).call(this,"delete",this,options);if(!options.wait)triggerDestroy();return xhr},parse:function(resp,xhr){return resp.data},toJSON:function(options){var data={};for(var att in this.attributes){if(!_.contains(this.readOnlyAttributes,att)){if(this.attributes[att]!==null&&typeof this.attributes[att]==="object"){data[att]=JSON.stringify(this.attributes[att])}else{data[att]=this.attributes[att]}}}return data}});var BackboneRouter=Backbone.Router.extend({});var BackboneCollection=Backbone.Collection.extend({});var startHistory=function(){if(Backbone.history){Backbone.history.start()}};return{BackboneView:BackboneView,BackboneModel:BackboneModel,BackboneRouter:BackboneRouter,BackboneCollection:BackboneCollection,startHistory:startHistory}});
define('domReady',[],function(){var isBrowser=typeof window!=="undefined"&&window.document,isPageLoaded=!isBrowser,doc=isBrowser?document:null,readyCalls=[],readyLoaderCalls=[],req=requirejs||require||{},oldResourcesReady=req.resourcesReady,scrollIntervalId;function runCallbacks(callbacks){for(var i=0,callback;callback=callbacks[i];i++){callback(doc)}}function callReady(){var callbacks=readyCalls,loaderCallbacks=readyLoaderCalls;if(isPageLoaded){if(callbacks.length){readyCalls=[];runCallbacks(callbacks)}if(req.resourcesDone&&loaderCallbacks.length){readyLoaderCalls=[];runCallbacks(loaderCallbacks)}}}if("resourcesReady"in req){req.resourcesReady=function(isReady){if(oldResourcesReady){oldResourcesReady(isReady)}if(isReady){callReady()}}}function pageLoaded(){if(!isPageLoaded){isPageLoaded=true;if(scrollIntervalId){clearInterval(scrollIntervalId)}callReady()}}if(isBrowser){if(document.addEventListener){document.addEventListener("DOMContentLoaded",pageLoaded,false);window.addEventListener("load",pageLoaded,false)}else if(window.attachEvent){window.attachEvent("onload",pageLoaded);if(self===self.top){scrollIntervalId=setInterval(function(){try{if(document.body){document.documentElement.doScroll("left");pageLoaded()}}catch(e){}},30)}}if(document.readyState==="complete"){pageLoaded()}}function domReady(callback){if(isPageLoaded){callback(doc)}else{readyCalls.push(callback)}return domReady}domReady.withResources=function(callback){if(isPageLoaded&&req.resourcesDone){callback(doc)}else{readyLoaderCalls.push(callback)}return domReady};domReady.version="1.0.0";domReady.load=function(name,req,onLoad,config){if(config.isBuild){onLoad(null)}else{domReady(onLoad)}};return domReady});
define('tpl!modals/base_modal', function() {return {"base_modal":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="modal hide fade" id="'+((__t=(modal_id))==null?'':_.escape(__t))+'"> <div class="modal-header"> <h3>'+((__t=(modal_header))==null?'':_.escape(__t))+'</h3> </div> <div class=\'modal-body\'></div> <div class="modal-footer"> <a data-dismiss="modal" class="btn">Close</a> </div> </div> ';}return __p;}};});

define('view/modal/BaseModal',["core/bb","tpl!modals/base_modal"],function(bb,modal_tpl){var BaseModalView=bb.BackboneView.extend({setView:function(options){this.view=$(modal_tpl.base_modal({modal_id:options.id,modal_header:options.header}));this.view.find(".modal-body").html(options.body);return this.view},launchModal:function(el,options){var $modal_el=$(el);if(!options)options={};$modal_el.on("hidden",_.bind(function(){this.trigger("hidden")},this));if($(".modal-backdrop")){$modal_el.on("shown",function(e){var $t=$(e.target);if($t.hasClass("modal")){$t2=$t.data("modal");$t2.$backdrop.css("z-index",1047)}}).on("hidden",function(e){var $t=$(e.target);if($t.hasClass("modal")){$("body").addClass("modal-open")}}).on("focusin",function(e){e.stopPropagation()})}$modal_el.modal(options);$modal_el.on("hidden",function(){$modal_el.remove()});this.setElement($modal_el)},apiError:function(resp){this.$(".modal-footer").html("<button "+'class="btn btn-primary" data-dismiss="modal">Ok</button>');this.$(".modal-body").html('<div class="alert alert-error">'+"<strong>"+resp.msg+"</strong>"+"</div>")},apiSuccess:function(msg){this.$(".modal-footer").html("<button "+'class="btn btn-primary" data-dismiss="modal">Ok</button>');this.$(".modal-body").html('<div class="alert alert-success"><strong>'+msg+"</strong></div>")},closeModal:function(){$(this.el).modal("hide")}});return BaseModalView});
define('tpl!modals/onboarding_checklist', function() {return {"modal":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div id="onboarding-checklist-modal" class="modal hide fade"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button> <h3>'+((__t=(modal_title))==null?'':_.escape(__t))+'</h3> </div> <div class="modal-body"> </div> <div class="modal-footer"> <a class="btn btn-primary" href="'+((__t=(absURL('/')))==null?'':_.escape(__t))+'">'+((__t=(i18n("返回主页")))==null?'':_.escape(__t))+'</a> <button data-dismiss="modal" type="button" class="btn">'+((__t=(i18n("关闭")))==null?'':_.escape(__t))+'</button> </div> </div> ';}return __p;}};});

define('tpl!new_onboarding', function() {return {"contact_info":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="onboarding-form"> <div class="title"> '+((__t=(i18n("增加你的联系方式")))==null?'':_.escape(__t))+' </div> <form> <div class="row-fluid"> <div class="span6 control-group"> <label class="control-label" for="first_name">'+((__t=(i18n("名字")))==null?'':_.escape(__t))+'</label> <div class="controls input-append"> <input type="text" class="form-control" value="'+((__t=(fields.first_name))==null?'':_.escape(__t))+'" id="first_name" placeholder="'+((__t=(i18n("名字")))==null?'':_.escape(__t))+'" required/> <span class="add-on"><i class="icon icon-pencil"></i></span> </div> </div> <div class="span6 control-group"> <label class="control-label" for="last_name">'+((__t=(i18n("姓氏")))==null?'':_.escape(__t))+'</label> <div class="controls input-append"> <input type="text" class="form-control" value="'+((__t=(fields.last_name))==null?'':_.escape(__t))+'" id="last_name" placeholder="'+((__t=(i18n("姓氏")))==null?'':_.escape(__t))+'" required/> <span class="add-on"><i class="icon icon-pencil"></i></span> </div> </div> </div> <div class="row-fluid"> <div class="span12 control-group"> <label class="control-label" for="street_address1"> '+((__t=(i18n("街道地址")))==null?'':_.escape(__t))+' </label> <div class="controls input-append"> <input type="text" class="form-control" value="'+((__t=(fields.street_address1))==null?'':_.escape(__t))+'" id="street_address1" placeholder="'+((__t=(i18n("街道地址")))==null?'':_.escape(__t))+'" required/> <span class="add-on"><i class="icon icon-pencil"></i></span> </div> </div> </div> <div class="row-fluid"> <div class="span12 control-group"> <div class="controls input-append"> <input type="text" class="form-control" value="'+((__t=(fields.street_address2))==null?'':_.escape(__t))+'" id="street_address2" placeholder="'+((__t=(i18n("地址2（可选的）")))==null?'':_.escape(__t))+'"/> <span class="add-on"><i class="icon icon-pencil"></i></span> </div> </div> </div> <div class="row-fluid"> <div class="span6 control-group"> <label class="control-label" for="country_code"> '+((__t=(i18n("国家")))==null?'':_.escape(__t))+' </label> <div class="controls input-append"> <select id="country_code" class="form-control" required> <option value>'+((__t=(i18n("选择一个")))==null?'':_.escape(__t))+'</option> '; _.each(countries, function(country) { __p+=' '; var code = country[0]; __p+=' '; var name = code == "GB" ? "United Kingdom" : country[1]; __p+=' <option '+((__t=(code == fields.country_code ? 'selected' : ''))==null?'':_.escape(__t))+' value="'+((__t=(code))==null?'':_.escape(__t))+'">'+((__t=(name))==null?'':_.escape(__t))+'</option> '; }); __p+=' </select> <span class="add-on"><i class="icon icon-pencil"></i></span> </div> </div> <div class="span6 control-group"> <label class="control-label" for="state"> '+((__t=(i18n("州")))==null?'':_.escape(__t))+' </label> <div id="state-container" class="controls input-append"> </div> </div> </div> <div class="row-fluid"> <div class="span6 control-group"> <label class="control-label" for="city"> '+((__t=(i18n("城市")))==null?'':_.escape(__t))+' </label> <div id="city-container" class="controls input-append"> </div> </div> <div class="span6 control-group"> <label class="control-label" for="zipcode"> '+((__t=(i18n("邮政编码")))==null?'':_.escape(__t))+' </label> <div class="controls input-append"> <input type="text" class="form-control" value="'+((__t=(fields.zipcode))==null?'':_.escape(__t))+'" id="zipcode" placeholder="'+((__t=(i18n("邮政编码")))==null?'':_.escape(__t))+'" required/> <span class="add-on"><i class="icon icon-pencil"></i></span> </div> </div> </div> <div class="row-fluid"> <div class="span6 control-group"> <label class="control-label" for="phone_country"> '+((__t=(i18n("电话号码")))==null?'':_.escape(__t))+' </label> <div class="controls row-fluid"> <div class="span3"> <input type="text" class="form-control phone-component" value="'+((__t=(fields.phone_number_country))==null?'':_.escape(__t))+'" required id="phone_number_country" placeholder="'+((__t=(i18n("国家")))==null?'':_.escape(__t))+'"/> </div> <div class="span3"> <input type="text" class="form-control phone-component" value="'+((__t=(fields.phone_number_area))==null?'':_.escape(__t))+'" required id="phone_number_area" placeholder="'+((__t=(i18n("区域")))==null?'':_.escape(__t))+'"/> </div> <div class="span6 input-append"> <input type="text" class="form-control phone-component" value="'+((__t=(fields.phone_number_number))==null?'':_.escape(__t))+'" required id="phone_number_number" placeholder="'+((__t=(i18n("号码")))==null?'':_.escape(__t))+'"/> <span class="add-on"><i class="icon icon-pencil"></i></span> </div> </div> <div class="controls row-fluid"> Ex. + 1 - 234 - 5678910 <br/> Ex. + 86 - - 13912345678 <br/> Ex. + 86 - 21 - 65142545 </div> </div> </div> </form> <hr/> <div class="buttons clearfix"> <div class="pull-left"> </div> <div class="pull-right"> <span id="next-btn" class="flat-orange-btn onboarding-btn"> '+((__t=(i18n("下一页")))==null?'':_.escape(__t))+' </span> </div> </div> </div> ';}return __p;},"state_input":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' '; if (state_options) { __p+=' <select id="state" class="form-control" required> <option value="">'+((__t=(i18n("选择一个")))==null?'':_.escape(__t))+'</option> '; _.each(state_options, function(state) { __p+=' <option '+((__t=(state == fields.state ? 'selected' : ''))==null?'':_.escape(__t))+' value="'+((__t=(state))==null?'':_.escape(__t))+'">'+((__t=(state))==null?'':_.escape(__t))+'</option> '; }); __p+=' </select> '; } else { __p+=' <input type="text" class="form-control" value="'+((__t=(fields.state))==null?'':_.escape(__t))+'" id="state" placeholder="'+((__t=(i18n("州")))==null?'':_.escape(__t))+'" required '+((__t=(state_options === null ? 'disabled' : ''))==null?'':_.escape(__t))+'/> '; } __p+=' <span class="add-on"><i class="icon icon-pencil"></i></span> ';}return __p;},"city_input":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' '; if (city_options) { __p+=' <select id="city" class="form-control" required> <option value>'+((__t=(i18n("选择一个")))==null?'':_.escape(__t))+'</option> '; _.each(city_options, function(city) { __p+=' <option '+((__t=(city == fields.city ? 'selected' : ''))==null?'':_.escape(__t))+' value="'+((__t=(city))==null?'':_.escape(__t))+'">'+((__t=(city))==null?'':_.escape(__t))+'</option> '; }); __p+=' </select> '; } else { __p+=' <input type="text" class="form-control" value="'+((__t=(fields.city))==null?'':_.escape(__t))+'" id="city" placeholder="'+((__t=(i18n("城市")))==null?'':_.escape(__t))+'" required '+((__t=(city_options === null ? 'disabled' : ''))==null?'':_.escape(__t))+'/> '; } __p+=' <span class="add-on"><i class="icon icon-pencil"></i></span> ';}return __p;},"store_info":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="onboarding-form"> <div class="title"> '+((__t=(i18n("告诉我们更多关于您的店铺情况")))==null?'':_.escape(__t))+' </div> <form> <div class="row-fluid"> <div class="span12 control-group"> <label class="control-label" for="store_url"> '+((__t=(i18n("目前您常使用的平台是?")))==null?'':_.escape(__t))+' </label> <div class="controls input-prepend input-append"> <select id="store_platform" class="form-control add-on" required data-name="'+((__t=(i18n("当前店铺平台")))==null?'':_.escape(__t))+'"> <option value>'+((__t=(i18n("选择一个")))==null?'':_.escape(__t))+'</option> '; _.each(store_platforms, function(platform) { __p+=' <option '+((__t=(fields.store_platform == platform[0] ? 'selected' : ''))==null?'':_.escape(__t))+' value="'+((__t=(platform[0]))==null?'':_.escape(__t))+'">'+((__t=(platform[1]))==null?'':_.escape(__t))+'</option> '; }); __p+=' </select> <input type="url" id="store_url" data-name="'+((__t=(i18n("店铺URL或链接")))==null?'':_.escape(__t))+'" class="form-control" value="'+((__t=(fields.store_url))==null?'':_.escape(__t))+'" '+((__t=(fields.store_platform ? '' : 'disabled'))==null?'':_.escape(__t))+' placeholder="'+((__t=(i18n("店铺URL或链接")))==null?'':_.escape(__t))+'" required /> <span class="add-on"><i class="icon icon-pencil"></i></span> </div> </div> </div> <div class="row-fluid"> <div class="span12 control-group"> <label class="control-label" for="annual_gmv"> '+((__t=(i18n("您的店铺去年营业额是多少?(美元)")))==null?'':_.escape(__t))+' </label> <div class="controls input-append"> <input type="number" class="form-control" required min="0" step="0.01" value="'+((__t=(fields.annual_gmv))==null?'':_.escape(__t))+'" id="annual_gmv" placeholder="'+((__t=(i18n("去年收入（美金）")))==null?'':_.escape(__t))+'" data-name="'+((__t=(i18n("去年收益")))==null?'':_.escape(__t))+'"/> <span class="add-on"><i class="icon icon-pencil"></i></span> </div> </div> </div> <div class="row-fluid"> <div class="span12 control-group"> <label class="control-label" for="product_categories"> '+((__t=(i18n("产品类别")))==null?'':_.escape(__t))+' </label> <div class="row-fluid"> '; var i = 0; __p+=' '; _.each(product_categories, function(text, key) { __p+=' '; if (i % 3 == 0 && i !== 0) { __p+=' </div> <div class="row-fluid"> '; } __p+=' <div class="span4"> <label class="checkbox-label"> <input type="checkbox" name="product_categories" '; if (fields.product_categories[key]) { __p+=' checked '; } __p+=' class="form-control" value="'+((__t=(key))==null?'':_.escape(__t))+'"/> '+((__t=(text))==null?'':_.escape(__t))+' </label> </div> '; i++; __p+=' '; }); __p+=' </div> </div> </div> </form> <div id="bottom-notice"> '+((__t=(i18n("通过点击“进入我的店铺”,您同意")))==null?'':_.escape(__t))+' <a href="'+((__t=(absURL('terms-of-service')))==null?'':_.escape(__t))+'" target="_blank"> '+((__t=(i18n("Wish的服务条款")))==null?'':_.escape(__t))+' </a> '+((__t=(i18n("并且")))==null?'':_.escape(__t))+' <a href="'+((__t=(absURL('policy/home')))==null?'':_.escape(__t))+'" target="_blank"> '+((__t=(i18n("政策")))==null?'':_.escape(__t))+' </a> </div> <hr/> <div class="buttons clearfix"> <div class="pull-left"> <span id="back-btn" class="btn-link text-btn onboarding-btn"> '+((__t=(i18n("返回")))==null?'':_.escape(__t))+' </span> </div> <div class="pull-right"> <span id="next-btn" class="flat-orange-btn onboarding-btn"> '+((__t=(i18n("输入我的店铺")))==null?'':_.escape(__t))+' </span> </div> </div> </div> ';}return __p;},"checklist_view":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="onboarding-checklist"> '; if (title !== null) { __p+=' <h3 class="title">'+((__t=(title))==null?'':_.escape(__t))+'</h3> '; } __p+=' '; if (subtitle || subtitle === null) { __p+=' <div class="subtitle alert alert-success"> '; if (subtitle === null) { __p+=' '; if (remaining_items.length === 0) { __p+=' '+((__t=(i18n("您已经准备好了! 现在就点击下方的按钮开启您的店铺!")))==null?'':_.escape(__t))+' '; } else if (remaining_items.length === 1) { __p+=' '+((__t=(i18n("几乎好了!%1$s 来开启您的店铺!", remaining_items[0].text)))==null?'':_.escape(__t))+' '; } else if (remaining_items.length === 2) { __p+=' '+((__t=(i18n("仅剩两步便可开启您的店铺!")))==null?'':_.escape(__t))+' '; } else { __p+=' '+((__t=(i18n("仅剩一些步骤便可开启您的店铺!")))==null?'':_.escape(__t))+' '; } __p+=' '; } else { __p+=' '+((__t=(subtitle))==null?'':_.escape(__t))+' '; } __p+=' </div> '; } __p+=' <div class="onboarding-checklist-container"></div> '; if (bottom_btn || remaining_items.length === 0) { __p+=' <div class="onboarding-open-store-btn '+((__t=(remaining_items.length ? 'disabled' : ''))==null?'':_.escape(__t))+'"> '+((__t=(btn_text))==null?'':_.escape(__t))+' </div> '; } __p+=' </div> ';}return __p;}};});

define('tpl!checklist', function() {return {"checklist":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="checklist"> '; _.each(items, function(item, idx) { __p+=' <div class="clearfix checklist-item'+((__t=(item.complete ? ' checklist-item-complete' : ''))==null?'':_.escape(__t))+'" data-idx="'+((__t=(idx))==null?'':_.escape(__t))+'"> <div class="checklist-item-icon pull-left"> <i class="'+((__t=(item.complete ? 'fa fa-check' : ''))==null?'':_.escape(__t))+'"></i> </div> <span class="checklist-item-text pull-left"> '+((__t=(item.text))==null?'':_.escape(__t))+' </span> '; if (item.complete) { __p+=' <span class="checklist-item-btn pull-right"> '+((__t=(item.doneText))==null?'':_.escape(__t))+' </span> '; } else { __p+=' '; if (item.url === null) { __p+=' <span class="checklist-item-btn pull-right"> '+((__t=(item.btnText))==null?'':_.escape(__t))+' </span> '; } else { __p+=' <a href="'+((__t=(item.url))==null?'':_.escape(__t))+'" class="checklist-item-btn pull-right"> '+((__t=(item.btnText))==null?'':_.escape(__t))+' </a> '; } __p+=' '; } __p+=' </div> '; }); __p+=' </div> ';}return __p;}};});

define('view/Checklist',["underscore","core/bb","tpl!checklist","core/i18n"],function(_,bb,tpl,i18nModule){var i18n=i18nModule.i18n;var baseItem={text:"To do item",btnText:i18n("开始"),complete:false,btnDone:true,doneText:i18n("完成"),url:null};var ChecklistView=bb.BackboneView.extend({options:{},initialize:function(options){$.extend(true,this.options,options);this.items=_.map(options.items,function(item){var new_item={};$.extend(new_item,baseItem);$.extend(new_item,item);return new_item});this.tpl=this.buildTpl(tpl.checklist)},events:{"click .checklist-item-btn":"itemClicked"},itemClicked:function(evt){var $item=$(evt.currentTarget).closest(".checklist-item");var idx=$item.attr("data-idx");this.trigger("itemClicked",idx)},render:function(){this.$el.html(this.tpl({items:this.items}));return this}});return ChecklistView});
define('view/OnboardingChecklist',["underscore","core/bb","tpl!new_onboarding","core/i18n","core/url","view/Checklist"],function(_,bb,tpl,i18nModule,urlModule,ChecklistView){var i18n=i18nModule.i18n;var absURL=urlModule.absURL;var OnboardingChecklistView=bb.BackboneView.extend({options:{merchant:null,step_dict:null,title:i18n("开通您的店铺"),subtitle:null,btn_text:i18n("开通您的店铺"),bottom_btn:true},urls:{1:null,2:null,3:absURL("request-confirmation-email"),4:absURL("request-confirmation-by-phone"),5:absURL("payment-settings"),6:absURL("add-products"),7:absURL("merchant/extra-info")},initialize:function(options){$.extend(true,this.options,options);this.merchant=this.options.merchant;this.step_dict=this.options.step_dict;this.tpl=this.buildTpl(tpl.checklist_view);this.completed=this.merchant.new_onboarding_steps_completed},events:{"click .onboarding-open-store-btn":"openStoreClicked"},itemClicked:function(idx){idx++},canOpenStore:function(){return this.merchant.new_onboarding_steps_completed.length===this.merchant.new_onboarding_steps_required.length},openStoreClicked:function(){if(this.canOpenStore()){window.location.href=absURL("brand-authorization/education")}},updateSteps:function(merchant_user){var completed=merchant_user.new_onboarding_steps_completed;var difference=_.difference(completed,this.completed);this.completed=completed;this.merchant=merchant_user;this.render();if(difference.length>0){var selectors=_.map(difference,_.bind(function(step){return'.checklist > .checklist-item[data-idx="'+(step-1)+'"]'},this));var selector=selectors.join(",");var $items=this.$(selector);$items.addClass("updated");window.setTimeout(function(){$items.removeClass("updated")},1e3)}},render:function(){var steps=_.pick(this.step_dict,this.merchant.new_onboarding_steps_required);var items=_.map(steps,_.bind(function(text,idx){var complete=_.contains(this.completed,parseInt(idx));return{text:text,complete:complete,url:this.urls[idx]}},this));var remaining_items=_.filter(items,function(item){return!item.complete});var tplContext={remaining_items:remaining_items};$.extend(tplContext,this.options);this.$el.html(this.tpl(tplContext));var checklist=new ChecklistView({el:this.$el.find(".onboarding-checklist-container"),items:items,title:this.options.title,subtitle:this.options.subtitle,btn_text:this.options.btn_text});checklist.on("itemClicked",_.bind(this.itemClicked,this));checklist.render();if(this.canOpenStore()){this.$(".onboarding-open-store-btn").removeClass("disabled")}return this}});return OnboardingChecklistView});
define('view/modal/OnboardingChecklist',["underscore","view/modal/BaseModal","tpl!modals/onboarding_checklist","core/i18n","view/OnboardingChecklist"],function(_,BaseModalView,tpl,i18nModule,OnboardingChecklistView){var i18n=i18nModule.i18n;var OnboardingChecklistModalView=BaseModalView.extend({options:{modal_title:i18n("开通您的店铺"),title:null,bottom_btn:true},initialize:function(options){$.extend(true,this.options,options);this.tpl=this.buildTpl(tpl.modal)},events:{},updateSteps:function(merchant_user){this.checklist.updateSteps(merchant_user)},render:function(){this.modal_el=this.tpl(this.options);this.launchModal(this.modal_el);this.checklist=new OnboardingChecklistView(this.options);this.checklist.setElement(this.$el.find(".modal-body"));this.checklist.render();return this}});return OnboardingChecklistModalView});
define('base_page',["backbone","core/bb","core/api","domReady","lib/jquery.cookie","core/url","view/modal/OnboardingChecklist"],function(Backbone,bb,api,domReady,Cookie,urlModule,OnboardingChecklistModal){var error_logger_initialize=function(){window.onerror=function(errorMsg,url,lineNumber){var currTime=(new Date).getTime();var lastLogTime=$.cookie("last_error_log_time");if(lastLogTime&&currTime-lastLogTime<1e3){return}$.cookie("last_error_log_time",currTime);api.call("log-js-error",{error_msg:errorMsg,url:url,line_number:lineNumber})}};var log_client_pref=function(){if(window.performance&&window.performance.timing&&window.pageParams&&window.pageParams.monitor_key){var perf_data={};for(attribute in window.performance.timing){if(typeof window.performance.timing[attribute]=="number"){perf_data[attribute]=window.performance.timing[attribute]}}perf_data.uid=window.pageParams.monitor_key;api.call("client-perf",perf_data,function(){},function(){})}};var core_page_initialize=function(){var $subnav=$("#sub-header-nav");if($subnav.height()>41){var $page_content=$("#page-content");var top_margin=20+$subnav.height()-41+"px";$page_content.css("margin-top",top_margin)}};var init_onboarding=function(){var merchant=window.pageParams.merchant_user;if(merchant&&merchant.is_new_merchant_lead){var step_dict=window.pageParams.onboarding_step_dict;var modal=new OnboardingChecklistModal({merchant:merchant,step_dict:step_dict});var launch_onboarding_modal=function(){modal.render()};$(".btn-open-onboarding-checklist-modal").click(launch_onboarding_modal);$(document).on("refreshOnboardingChecklist",function(){api.call("merchant-user/get",{},function(resp){modal.render();modal.updateSteps(resp.data.merchant_user)})})}};var core_page_finish=function(){bb.startHistory();error_logger_initialize();log_client_pref();$("#page-content").tooltip({selector:"[rel=tooltip]"});remind_payment_settings();initalize_language_selector();initialize_su();$(window).scroll(function(){if($(window).width()<1024){$(".navbar").css({left:0-$(window).scrollLeft()+"px"})}else{$(".navbar").css({left:"0"})}});init_onboarding()};var initalize_language_selector=function(){$(".lang-sel").on("click",function(evt){var locale=$(evt.currentTarget).attr("data-lang");api.call("change-locale",{locale:locale},function(resp){window.location.reload()})})};var initialize_su=function(){loginAs=function(evt){var $el=$(evt.currentTarget);var bd_client=$el.attr("data-uid");api.call("login-as",{bd_client:bd_client},function(resp){window.location.href=urlModule.absURL("/")})};$(document).on("click",".login-as-button",loginAs)};var remind_payment_settings=function(){if($.cookie("require_payment_info")=="1"&&window.pageParams.current_step===undefined){$("#menu-account").popover({html:true,content:'<div class="info-popover">You have not setup your '+"payment settings, please tell us how you would like "+'to be paid.<br><a class="now">Do it now</a> '+'| <a class="later">Hide</a></div>',placement:"bottom",trigger:"manual"});$("#menu-account").popover("show");$("#menu-account, .info-popover .later").click(function(){$("#menu-account").popover("destroy");document.cookie="require_payment_info=;"+"expires=Thu, 01 Jan 1970 00:00:01 GMT;"});$(".info-popover .now").click(function(){window.location.href="/payment-settings";document.cookie="require_payment_info=;"+"expires=Thu, 01 Jan 1970 00:00:01 GMT;"})}};var on_dom_ready=function(init_function){domReady(function(){core_page_initialize();init_function();core_page_finish()})};return{onDomReady:on_dom_ready}});
define('tpl!help/add_products_page', function() {return {"help":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class=\'report-page-help\'> Learn how to add products to Wish <a href="http://merchantfaq./hc/en-us/articles/204530598-How-Do-I-Add-A-Product-Manually-" target="_blank"> here</a>. </div> ';}return __p;}};});

define('tpl!subheader', function() {return {"help_dropdown":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <li class=\'subheader-help dropdown\'> <a herf="#" class=\'page-help-btn dropdown-toggle\' data-toggle="dropdown"> Help </a> <ul class=\'dropdown-menu pull-right\'><li><div class=\'help-content\'> <div class=\'help-detail-placeholder\'></div> <div><a class=\'hide take-tour btn btn-info\'> Take a tour </a></div> <div><p class=\'contact\'> '; if (window.pageParams.bd_rep) { __p+=' Please contact <a href="mailto:'+((__t=(window.pageParams.bd_rep.email))==null?'':_.escape(__t))+'">'+((__t=(window.pageParams.bd_rep.name))==null?'':_.escape(__t))+'</a> for assistance. '; } else { __p+=' Please contact <a href="mailto:merchant_support@">support</a> for assistance. '; } __p+=' </p></div> <a class=\'close-help\'> Okay, I get it </a> </div></li></ul> </li> ';}return __p;}};});

define('tpl!help_tour', function() {return {"base_tour":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class=\'tour-step\'> <div class=\'tour-content-placeholder\'></div> <ul class=\'nav-tour nav-pills nav\'> '; if(!last){ __p+=' <li><a class=\'skip-tour-btn\'>Skip</a></li> '; } __p+=' <li><a class=\'prev-step-btn\'>Back</a></li> '; if(!last){ __p+=' <li><a class=\'next-step-btn\'>Next</a></li> '; } else { __p+=' <li><a class=\'done-btn\'>Cool, I\'ll take it from here</a></li> '; } __p+=' </ul> </div> ';}return __p;}};});

define('view/TourView',["underscore","core/bb","tpl!help_tour"],function(_,bb,tour_tpl){var TourView=bb.BackboneView.extend({step:0,initialize:function(options){this.info=options.info;this.parent_help=options.parent_help;this.cb=options.cb},startTour:function(){this.step=0;this.renderStep()},events:{"click .next-step-btn":"nextStep","click .prev-step-btn":"prevStep","click .skip-tour-btn":"done","click .done-btn":"done"},nextStep:function(){this.step+=1;this.renderStep()},prevStep:function(){this.step-=1;this.renderStep()},renderStep:function(){$(".popover").remove();var init=this.info[this.step][3];if(init!=null&&init!=undefined){init()}this.buildStep(this.info[this.step],this.step==this.info.length-1);var target=$(this.info[this.step][0]);target.popover("show");this.setElement($(".popover"))},done:function(){$(".popover").remove();this.setElement(null);this.step=0;if(this.cb!=null&&this.cb!=undefined){this.cb()}},buildStep:function(stepInfo,last){var target=$(stepInfo[0]);var base_tpl=$(tour_tpl.base_tour({last:last}));base_tpl.find(".tour-content-placeholder").html(stepInfo[1]);target.popover({html:true,content:base_tpl[0].outerHTML,trigger:"manual",placement:stepInfo[2],container:"#page-content"})}});return TourView});
define('view/HelpDropdownView',["tpl!subheader","core/bb","view/TourView"],function(subheader_tpl,bb,TourView){var HelpDropdownView=bb.BackboneView.extend({initialize:function(options){if(options.steps){this.tourView=new TourView({info:options.steps,cb:options.cb,parent_help:this})}else{this.tourView=null}this.subTpl=this.buildTpl(options.tpl)},render:function(){this.view=$(subheader_tpl.help_dropdown({has_tour:this.has_tour}));var content=this.subTpl({});this.view.find(".help-detail-placeholder").html(content);$("#sub-header-nav .pull-right .nav").prepend(this.view);if(this.tourView){this.view.find(".take-tour").removeClass("hide")}this.setElement(this.view);return this},closeHelp:function(){var subheader=this.view.find(".subheader-help");if(subheader.hasClass("open")){subheader.find(".page-help-btn").dropdown("toggle")}},startTour:function(){this.closeHelp();this.tourView.startTour()},events:{"click .close-help":"closeHelp","click .contact a":"closeHelp","click .take-tour":"startTour"}});return HelpDropdownView});
define('core/dom_utils',[],function(){function val(el){return $.trim($(el).hasClass("watermark")?"":$(el).val())}return{val:val}});
(function($){$.fn.ajaxSubmit=function(options){if(!this.length){log("ajaxSubmit: skipping submit process - no element selected");return this}var method,action,url,$form=this;if(typeof options=="function"){options={success:options}}method=this.attr("method");action=this.attr("action");url=typeof action==="string"?$.trim(action):"";url=url||window.location.href||"";if(url){url=(url.match(/^([^#]+)/)||[])[1]}options=$.extend(true,{url:url,success:$.ajaxSettings.success,type:method||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},options);var veto={};this.trigger("form-pre-serialize",[this,options,veto]);if(veto.veto){log("ajaxSubmit: submit vetoed via form-pre-serialize trigger");return this}if(options.beforeSerialize&&options.beforeSerialize(this,options)===false){log("ajaxSubmit: submit aborted via beforeSerialize callback");return this}var traditional=options.traditional;if(traditional===undefined){traditional=$.ajaxSettings.traditional}var qx,n,v,a=this.formToArray(options.semantic);if(options.data){options.extraData=options.data;qx=$.param(options.data,traditional)}if(options.beforeSubmit&&options.beforeSubmit(a,this,options)===false){log("ajaxSubmit: submit aborted via beforeSubmit callback");return this}this.trigger("form-submit-validate",[a,this,options,veto]);if(veto.veto){log("ajaxSubmit: submit vetoed via form-submit-validate trigger");return this}var q=$.param(a,traditional);if(qx)q=q?q+"&"+qx:qx;if(options.type.toUpperCase()=="GET"){options.url+=(options.url.indexOf("?")>=0?"&":"?")+q;options.data=null}else{options.data=q}var callbacks=[];if(options.resetForm){callbacks.push(function(){$form.resetForm()})}if(options.clearForm){callbacks.push(function(){$form.clearForm()})}if(!options.dataType&&options.target){var oldSuccess=options.success||function(){};callbacks.push(function(data){var fn=options.replaceTarget?"replaceWith":"html";$(options.target)[fn](data).each(oldSuccess,arguments)})}else if(options.success){callbacks.push(options.success)}options.success=function(data,status,xhr){var context=options.context||options;for(var i=0,max=callbacks.length;i<max;i++){callbacks[i].apply(context,[data,status,xhr||$form,$form])}};var fileInputs=$("input:file",this).length>0;var mp="multipart/form-data";var multipart=$form.attr("enctype")==mp||$form.attr("encoding")==mp;if(options.iframe!==false&&(fileInputs||options.iframe||multipart)){if(options.closeKeepAlive){$.get(options.closeKeepAlive,function(){fileUpload(a)})}else{fileUpload(a)}}else{if($.browser.msie&&method=="get"&&typeof options.type==="undefined"){var ieMeth=$form[0].getAttribute("method");if(typeof ieMeth==="string")options.type=ieMeth}$.ajax(options)}this.trigger("form-submit-notify",[this,options]);return this;function fileUpload(a){var form=$form[0],el,i,s,g,id,$io,io,xhr,sub,n,timedOut,timeoutHandle;var useProp=!!$.fn.prop;if(a){if(useProp){for(i=0;i<a.length;i++){el=$(form[a[i].name]);el.prop("disabled",false)}}else{for(i=0;i<a.length;i++){el=$(form[a[i].name]);el.removeAttr("disabled")}}}if($(":input[name=submit],:input[id=submit]",form).length){alert('Error: Form elements must not have name or id of "submit".');return}s=$.extend(true,{},$.ajaxSettings,options);s.context=s.context||s;id="jqFormIO"+(new Date).getTime();if(s.iframeTarget){$io=$(s.iframeTarget);n=$io.attr("name");if(n==null)$io.attr("name",id);else id=n}else{$io=$('<iframe name="'+id+'" src="'+s.iframeSrc+'" />');$io.css({position:"absolute",top:"-1000px",left:"-1000px"})}io=$io[0];xhr={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(status){var e=status==="timeout"?"timeout":"aborted";log("aborting upload... "+e);this.aborted=1;$io.attr("src",s.iframeSrc);xhr.error=e;s.error&&s.error.call(s.context,xhr,e,status);g&&$.event.trigger("ajaxError",[xhr,s,e]);s.complete&&s.complete.call(s.context,xhr,e)}};g=s.global;if(g&&!$.active++){$.event.trigger("ajaxStart")}if(g){$.event.trigger("ajaxSend",[xhr,s])}if(s.beforeSend&&s.beforeSend.call(s.context,xhr,s)===false){if(s.global){$.active--}return}if(xhr.aborted){return}sub=form.clk;if(sub){n=sub.name;if(n&&!sub.disabled){s.extraData=s.extraData||{};s.extraData[n]=sub.value;if(sub.type=="image"){s.extraData[n+".x"]=form.clk_x;s.extraData[n+".y"]=form.clk_y}}}var CLIENT_TIMEOUT_ABORT=1;var SERVER_ABORT=2;function getDoc(frame){var doc=frame.contentWindow?frame.contentWindow.document:frame.contentDocument?frame.contentDocument:frame.document;return doc}function doSubmit(){var t=$form.attr("target"),a=$form.attr("action");form.setAttribute("target",id);if(!method){form.setAttribute("method","POST")}if(a!=s.url){form.setAttribute("action",s.url)}if(!s.skipEncodingOverride&&(!method||/post/i.test(method))){$form.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"})}if(s.timeout){timeoutHandle=setTimeout(function(){timedOut=true;cb(CLIENT_TIMEOUT_ABORT)},s.timeout)}function checkState(){try{var state=getDoc(io).readyState;log("state = "+state);if(state.toLowerCase()=="uninitialized")setTimeout(checkState,50)}catch(e){log("Server abort: ",e," (",e.name,")");cb(SERVER_ABORT);timeoutHandle&&clearTimeout(timeoutHandle);timeoutHandle=undefined}}var extraInputs=[];try{if(s.extraData){for(var n in s.extraData){extraInputs.push($('<input type="hidden" name="'+n+'" />').attr("value",s.extraData[n]).appendTo(form)[0])}}if(!s.iframeTarget){$io.appendTo("body");io.attachEvent?io.attachEvent("onload",cb):io.addEventListener("load",cb,false)}setTimeout(checkState,15);form.submit()}finally{form.setAttribute("action",a);if(t){form.setAttribute("target",t)}else{$form.removeAttr("target")}$(extraInputs).remove()}}if(s.forceSync){doSubmit()}else{setTimeout(doSubmit,10)}var data,doc,domCheckCount=50,callbackProcessed;function cb(e){if(xhr.aborted||callbackProcessed){return}try{doc=getDoc(io)}catch(ex){log("cannot access response document: ",ex);e=SERVER_ABORT}if(e===CLIENT_TIMEOUT_ABORT&&xhr){xhr.abort("timeout");return}else if(e==SERVER_ABORT&&xhr){xhr.abort("server abort");return}if(!doc||doc.location.href==s.iframeSrc){if(!timedOut)return}io.detachEvent?io.detachEvent("onload",cb):io.removeEventListener("load",cb,false);var status="success",errMsg;try{if(timedOut){throw"timeout"}var isXml=s.dataType=="xml"||doc.XMLDocument||$.isXMLDoc(doc);log("isXml="+isXml);if(!isXml&&window.opera&&(doc.body==null||doc.body.innerHTML=="")){if(--domCheckCount){log("requeing onLoad callback, DOM not available");setTimeout(cb,250);return}}var docRoot=doc.body?doc.body:doc.documentElement;xhr.responseText=docRoot?docRoot.innerHTML:null;xhr.responseXML=doc.XMLDocument?doc.XMLDocument:doc;if(isXml)s.dataType="xml";xhr.getResponseHeader=function(header){var headers={"content-type":s.dataType};return headers[header]};if(docRoot){xhr.status=Number(docRoot.getAttribute("status"))||xhr.status;xhr.statusText=docRoot.getAttribute("statusText")||xhr.statusText}var dt=(s.dataType||"").toLowerCase();var scr=/(json|script|text)/.test(dt);if(scr||s.textarea){var ta=doc.getElementsByTagName("textarea")[0];if(ta){xhr.responseText=ta.value;xhr.status=Number(ta.getAttribute("status"))||xhr.status;xhr.statusText=ta.getAttribute("statusText")||xhr.statusText}else if(scr){var pre=doc.getElementsByTagName("pre")[0];var b=doc.getElementsByTagName("body")[0];if(pre){xhr.responseText=pre.textContent?pre.textContent:pre.innerText}else if(b){xhr.responseText=b.textContent?b.textContent:b.innerText}}}else if(dt=="xml"&&!xhr.responseXML&&xhr.responseText!=null){xhr.responseXML=toXml(xhr.responseText)}try{data=httpData(xhr,dt,s)}catch(e){status="parsererror";xhr.error=errMsg=e||status}}catch(e){log("error caught: ",e);status="error";xhr.error=errMsg=e||status}if(xhr.aborted){log("upload aborted");status=null}if(xhr.status){status=xhr.status>=200&&xhr.status<300||xhr.status===304?"success":"error"}if(status==="success"){s.success&&s.success.call(s.context,data,"success",xhr);g&&$.event.trigger("ajaxSuccess",[xhr,s])}else if(status){if(errMsg==undefined)errMsg=xhr.statusText;s.error&&s.error.call(s.context,xhr,status,errMsg);g&&$.event.trigger("ajaxError",[xhr,s,errMsg])}g&&$.event.trigger("ajaxComplete",[xhr,s]);if(g&&!--$.active){$.event.trigger("ajaxStop")}s.complete&&s.complete.call(s.context,xhr,status);callbackProcessed=true;if(s.timeout)clearTimeout(timeoutHandle);setTimeout(function(){if(!s.iframeTarget)$io.remove();xhr.responseXML=null},100)}var toXml=$.parseXML||function(s,doc){if(window.ActiveXObject){doc=new ActiveXObject("Microsoft.XMLDOM");doc.async="false";doc.loadXML(s)}else{doc=(new DOMParser).parseFromString(s,"text/xml")}return doc&&doc.documentElement&&doc.documentElement.nodeName!="parsererror"?doc:null};var parseJSON=$.parseJSON||function(s){return window["eval"]("("+s+")")};var httpData=function(xhr,type,s){var ct=xhr.getResponseHeader("content-type")||"",xml=type==="xml"||!type&&ct.indexOf("xml")>=0,data=xml?xhr.responseXML:xhr.responseText;if(xml&&data.documentElement.nodeName==="parsererror"){$.error&&$.error("parsererror")}if(s&&s.dataFilter){data=s.dataFilter(data,type)}if(typeof data==="string"){if(type==="json"||!type&&ct.indexOf("json")>=0){data=parseJSON(data)}else if(type==="script"||!type&&ct.indexOf("javascript")>=0){$.globalEval(data)}}return data}}};$.fn.ajaxForm=function(options){if(this.length===0){var o={s:this.selector,c:this.context};if(!$.isReady&&o.s){log("DOM not ready, queuing ajaxForm");$(function(){$(o.s,o.c).ajaxForm(options)});return this}log("terminating; zero elements found by selector"+($.isReady?"":" (DOM not ready)"));return this}return this.ajaxFormUnbind().bind("submit.form-plugin",function(e){if(!e.isDefaultPrevented()){e.preventDefault();$(this).ajaxSubmit(options)}}).bind("click.form-plugin",function(e){var target=e.target;var $el=$(target);if(!$el.is(":submit,input:image")){var t=$el.closest(":submit");if(t.length==0){return}target=t[0]}var form=this;form.clk=target;if(target.type=="image"){if(e.offsetX!=undefined){form.clk_x=e.offsetX;form.clk_y=e.offsetY}else if(typeof $.fn.offset=="function"){var offset=$el.offset();form.clk_x=e.pageX-offset.left;form.clk_y=e.pageY-offset.top}else{form.clk_x=e.pageX-target.offsetLeft;form.clk_y=e.pageY-target.offsetTop}}setTimeout(function(){form.clk=form.clk_x=form.clk_y=null},100)})};$.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")};$.fn.formToArray=function(semantic){var a=[];if(this.length===0){return a}var form=this[0];var els=semantic?form.getElementsByTagName("*"):form.elements;if(!els){return a}var i,j,n,v,el,max,jmax;for(i=0,max=els.length;i<max;i++){el=els[i];n=el.name;if(!n){continue}if(semantic&&form.clk&&el.type=="image"){if(!el.disabled&&form.clk==el){a.push({name:n,value:$(el).val()});a.push({name:n+".x",value:form.clk_x},{name:n+".y",value:form.clk_y})}continue}v=$.fieldValue(el,true);if(v&&v.constructor==Array){for(j=0,jmax=v.length;j<jmax;j++){a.push({name:n,value:v[j]})}}else if(v!==null&&typeof v!="undefined"){a.push({name:n,value:v})}}if(!semantic&&form.clk){var $input=$(form.clk),input=$input[0];n=input.name;if(n&&!input.disabled&&input.type=="image"){a.push({name:n,value:$input.val()});a.push({name:n+".x",value:form.clk_x},{name:n+".y",value:form.clk_y})}}return a};$.fn.formSerialize=function(semantic){return $.param(this.formToArray(semantic))};$.fn.fieldSerialize=function(successful){var a=[];this.each(function(){var n=this.name;if(!n){return}var v=$.fieldValue(this,successful);if(v&&v.constructor==Array){for(var i=0,max=v.length;i<max;i++){a.push({name:n,value:v[i]})}}else if(v!==null&&typeof v!="undefined"){a.push({name:this.name,value:v})}});return $.param(a)};$.fn.fieldValue=function(successful){for(var val=[],i=0,max=this.length;i<max;i++){var el=this[i];var v=$.fieldValue(el,successful);if(v===null||typeof v=="undefined"||v.constructor==Array&&!v.length){continue}v.constructor==Array?$.merge(val,v):val.push(v)}return val};$.fieldValue=function(el,successful){var n=el.name,t=el.type,tag=el.tagName.toLowerCase();if(successful===undefined){successful=true}if(successful&&(!n||el.disabled||t=="reset"||t=="button"||(t=="checkbox"||t=="radio")&&!el.checked||(t=="submit"||t=="image")&&el.form&&el.form.clk!=el||tag=="select"&&el.selectedIndex==-1)){return null}if(tag=="select"){var index=el.selectedIndex;if(index<0){return null}var a=[],ops=el.options;var one=t=="select-one";var max=one?index+1:ops.length;for(var i=one?index:0;i<max;i++){var op=ops[i];if(op.selected){var v=op.value;if(!v){v=op.attributes&&op.attributes["value"]&&!op.attributes["value"].specified?op.text:op.value}if(one){return v}a.push(v)}}return a}return $(el).val()};$.fn.clearForm=function(){return this.each(function(){$("input,select,textarea",this).clearFields()})};$.fn.clearFields=$.fn.clearInputs=function(){var re=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var t=this.type,tag=this.tagName.toLowerCase();if(re.test(t)||tag=="textarea"){this.value=""}else if(t=="checkbox"||t=="radio"){this.checked=false}else if(tag=="select"){this.selectedIndex=-1}})};$.fn.resetForm=function(){return this.each(function(){if(typeof this.reset=="function"||typeof this.reset=="object"&&!this.reset.nodeType){this.reset()}})};$.fn.enable=function(b){if(b===undefined){b=true}return this.each(function(){this.disabled=!b})};$.fn.selected=function(select){if(select===undefined){select=true}return this.each(function(){var t=this.type;if(t=="checkbox"||t=="radio"){this.checked=select}else if(this.tagName.toLowerCase()=="option"){var $sel=$(this).parent("select");if(select&&$sel[0]&&$sel[0].type=="select-one"){$sel.find("option").selected(false)}this.selected=select}})};$.fn.ajaxSubmit.debug=false;function log(){if(!$.fn.ajaxSubmit.debug)return;var msg="[jquery.form] "+Array.prototype.join.call(arguments,"");if(window.console&&window.console.log){window.console.log(msg)}else if(window.opera&&window.opera.postError){window.opera.postError(msg)}}})(jQuery);
define("lib/jquery.form", function(){});

define('core/s3',["core/api","core/i18n","lib/jquery.form"],function(api,i18nModule,_jqueryform){var i18n=i18nModule.i18n;function createCORSRequest(){var xhr;if(typeof XMLHttpRequest!="undefined"){xhr=new XMLHttpRequest}return xhr}function logErrorsToServer(response,status,state,description){api.call("log-manual-upload-image-error",{response:response,status:status,state:state,description:description,url:window.location.href},null)}function validateFile(url,success,failure,verifyURL){if(typeof verifyURL==="undefined")verifyURL="merch-url/image";api.call(verifyURL,{url:url},success,failure)}function checkFileType(file){allowedDocTypes=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"];if(file.type.indexOf("image/")==0){return"image"}else if(allowedDocTypes.indexOf(file.type)>-1){return"doc"}return false}function fallbackServerUpload(form,success,failure,type){if(form==null){failure({msg:i18n("您的浏览器不支持拖动文件上传。请替换使用按钮来上传")});return}var url;if(type==="image"){url="/api/upload-tmp-image"}else{url="/api/upload-tmp-file"}form.ajaxForm({url:url,type:"post",dataType:"text",success:success,error:failure});form.submit()}function uploadToS3(form,success,failure,ext,allowDocs,overrideFile){if(typeof allowDocs=="undefined")allowDocs=false;var file;if(form==null){file=overrideFile}else{file=form.find("input.real-file-upload")[0].files[0]}var type=checkFileType(file);if(!type||type==="doc"&&!allowDocs){failure({msg:"Invalid file type"},null);return}var xhr=createCORSRequest();if(xhr==undefined){fallbackServerUpload(form,success,failure,type)}else{var verifyURL;if(type==="image"){verifyURL="merch-url/image"}else{verifyURL="merch-url/file"}api.call("generate-signed-upload-url",{type:file.type,ext:ext,name:file.name},function(resp){var image_url=resp.data.image_url;xhr.addEventListener("load",function(e){if(xhr.readyState!=4){return}if(!(200<=(_ref=xhr.status)&&_ref<300)){failure(resp,xhr);logErrorsToServer(xhr.response,xhr.status,"load","uploadToS3")}else{validateFile(image_url,function(){success(resp,xhr)},function(){failure(resp,xhr)},verifyURL)}},false);xhr.addEventListener("error",function(e){fallbackServerUpload(form,success,failure,type);logErrorsToServer(xhr.response,xhr.status,"error","uploadToS3")},false);xhr.addEventListener("abort",function(e){failure(resp,xhr);logErrorsToServer(xhr.response,xhr.status,"abort","uploadToS3")},false);xhr.open("PUT",resp.data.url,true);xhr.setRequestHeader("Content-Type",file.type);xhr.setRequestHeader("x-amz-acl","public-read");xhr.timeout=6e4;xhr.ontimeout=function(){fallbackServerUpload(form,success,failure,type);logErrorsToServer(xhr.response,xhr.status,"timeout","uploadToS3")};xhr.send(file)},function(resp){failure(resp)})}}function dropzoneUploadFiles(files,dropzone,allowDocs,allowImages){if(typeof allowDocs=="undefined")allowDocs=false;if(typeof allowImages=="undefined")allowImages=true;var file=files[0];var type=checkFileType(file);if(!type){dropzone._errorProcessing(files,"");return}else if(type==="doc"){if(allowDocs){verifyURL="merch-url/file"}else{dropzone._errorProcessing(files,"");return}}else if(type==="image"){if(allowImages){verifyURL="merch-url/image"}else{dropzone._errorProcessing(files,"");return}}api.call("generate-signed-upload-url",{type:file.type,name:file.name},function(resp){var url=resp.data.url;uploadFiles(files,dropzone,url,resp.data.image_url,verifyURL)},function(){dropzone._errorProcessing(files,"");logErrorsToServer("generate url failed","","","dropzoneUploadFiles")})}function uploadFiles(files,dropzone,url,image_url,verifyURL){var file,handleError,headerName,headerValue,headers,i,input,inputName,inputType,key,option,progressObj,response,updateProgress,value,xhr,_i,_j,_k,_l,_len,_len1,_len2,_len3,_m,_ref,_ref1,_ref2,_ref3,_ref4,_ref5,_this=dropzone;xhr=new XMLHttpRequest;for(_i=0,_len=files.length;_i<_len;_i++){file=files[_i];file.xhr=xhr}xhr.open("PUT",url,true);xhr.withCredentials=!!dropzone.options.withCredentials;response=null;handleError=function(){return _this._errorProcessing(files,_this.options.dictResponseError.replace("{{statusCode}}",xhr.status),xhr)};xhr.onload=function(e){var _ref;if(files[0].status=="canceled"){return}if(xhr.readyState!==4){return}response=image_url;if(!(200<=(_ref=xhr.status)&&_ref<300)){logErrorsToServer(xhr.response,xhr.status,"load","uploadFiles");return handleError()}else{validateFile(response,function(){_this._finished(files,response,e)},function(){handleError()},verifyURL)}};xhr.onerror=function(){if(files[0].status=="canceled"){return}logErrorsToServer(xhr.response,xhr.status,"error","uploadFiles");return handleError()};xhr.onabort=function(){if(files[0].status=="canceled"){return}logErrorsToServer(xhr.response,xhr.status,"abort","uploadFiles");return handleError()};progressObj=(_ref=xhr.upload)!=null?_ref:xhr;progressObj.onprogress=updateProgress;headers={Accept:"application/json","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"};if(dropzone.options.headers){extend(headers,dropzone.options.headers)}for(headerName in headers){headerValue=headers[headerName];xhr.setRequestHeader(headerName,headerValue)}xhr.setRequestHeader("Content-Type",file.type);xhr.setRequestHeader("x-amz-acl","public-read");return xhr.send(file)}return{uploadToS3:uploadToS3,dropzoneUploadFiles:dropzoneUploadFiles,logErrorsToServer:logErrorsToServer}});
define('tpl!add_products_page', function() {return {"add_products_page":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <!-- NOTE: if you update this, make sure the add product page in onboarding flow still works --> <legend>'+((__t=(i18n("添加产品")))==null?'':_.escape(__t))+'</legend> <div id="add-product-form"> <div id="basic-info" class="form-horizontal"> <div class="section-title">'+((__t=(i18n("基本信息")))==null?'':_.escape(__t))+'</div> '+((__t=(inputRowTpl({ 'index': window.pageParams.index_map.NAME_COLUMN })))==null?'':__t)+' '+((__t=(inputRowTpl({ 'index': window.pageParams.index_map.DESCRIPTION_COLUMN })))==null?'':__t)+' '+((__t=(inputRowTpl({ 'index': window.pageParams.index_map.TAGS_COLUMN })))==null?'':__t)+' '+((__t=(inputRowTpl({ 'index': window.pageParams.index_map.PARENT_UNIQUE_ID_COLUMN })))==null?'':__t)+' '+((__t=(inputRowTpl({ 'index': window.pageParams.index_map.UNIQUE_ID_COLUMN })))==null?'':__t)+' </div> <div id="main-image" class="form-horizontal"> <div class="section-title"> '+((__t=(i18n("主图片")))==null?'':_.escape(__t))+' </div> <div class="clearfix"> <div id="main-image-div" class="dropzone text-center pull-left" > <div id="main-image-no-image"> <div class="main-fallback-hide no-image-prompt alert alert-success" > '+((__t=(i18n("将文件拖放至此处")))==null?'':_.escape(__t))+' </div> <div class="main-fallback-hide no-image-prompt-or" > '+((__t=(i18n("或... ")))==null?'':_.escape(__t))+' </div> <button id="fake-file-upload-main" class="btn no-image-prompt-btn" type="button"> <img src="'+((__t=("//static.china-merchant./img/ic_monitor.png?v=18"))==null?'':_.escape(__t))+'" /> '+((__t=(i18n("从计算机选择")))==null?'':_.escape(__t))+' </button> <div class="no-image-prompt-or" > '+((__t=(i18n("或... ")))==null?'':_.escape(__t))+'</div> <button name="image-web-url" class="btn no-image-prompt-btn" type="button"> <img src="'+((__t=("//static.china-merchant./img/ic_globe.png?v=18"))==null?'':_.escape(__t))+'" /> '+((__t=(i18n("网络地址 (URL)")))==null?'':_.escape(__t))+' </button> </div> <form> <input class="real-file-upload" maxlength="10000000000" name="image-file-upload" type="file" accept=".jpg,.jpeg,.gif,.png" /> </form> </div> <div class="add-image-info pull-left"> <div class="add-image-info-text"> <a target="_blank" href="http://merchantfaq./hc/en-us/articles/204531768-What-constitutes-as-a-fake-or-a-counterfeit-item-"> '+((__t=(i18n("严禁在 Wish 上出售伪造产品。")))==null?'':_.escape(__t))+' </a> </div> <div class="add-image-info-text"> '+((__t=(i18n("配有多张高质量图片的产品往往销售情况最好。")))==null?'':_.escape(__t))+' </div> <div class="add-image-info-text"> '+((__t=(i18n("添加像素至少为 800 x 800 的图片。")))==null?'':_.escape(__t))+' </div> <div class="add-image-info-text"> '+((__t=(i18n("不得盗取其他商户的图片，否则您的产品将被删除。")))==null?'':_.escape(__t))+' </div> '; if (!onboarding) { __p+=' <div class="add-image-info-text"> '+((__t=(i18n("有关知识产权规则的更多信息，请查看")))==null?'':_.escape(__t))+' <a target="_blank" href="'+((__t=(absURL('brand-university')))==null?'':_.escape(__t))+'"> '+((__t=(i18n("品牌大学")))==null?'':_.escape(__t))+' </a> <sup style="color:red">'+((__t=(i18n("新")))==null?'':_.escape(__t))+'</sup> </div> '; } __p+=' </div> </div> <div class="section-title"> '+((__t=(i18n("额外图片")))==null?'':_.escape(__t))+' </div> <button id="fake-file-upload-extra" class="btn no-image-prompt-btn" type="button"> <img src="'+((__t=("//static.china-merchant./img/ic_monitor.png?v=18"))==null?'':_.escape(__t))+'" /> '+((__t=(i18n("从计算机添加")))==null?'':_.escape(__t))+' </button> <button name="extra-image-web-url" id="extra-image-web-url" class="btn no-image-prompt-btn" > <img src="'+((__t=("//static.china-merchant./img/ic_globe.png?v=18"))==null?'':_.escape(__t))+'" /> '+((__t=(i18n("通过网络地址 (URL) 添加")))==null?'':_.escape(__t))+' </button> <div id="extra-image-div" class="clearfix dropzone"> <form> <input class="real-file-upload" maxlength="10000000000" name="image-file-upload" type="file" accept=".jpg,.jpeg,.gif,.png" /> </form> <div style="position: absolute"> '; _.each(_.range(5), function() { __p+=' <div class="no-photo-div text-center">'+((__t=(i18n("将文件拖放至此处")))==null?'':_.escape(__t))+'</div> '; }); __p+=' <div class="hide" id="extra-images-row2"> '; _.each(_.range(5), function() { __p+=' <div class="no-photo-div text-center">'+((__t=(i18n("将文件拖放至此处")))==null?'':_.escape(__t))+'</div> '; }); __p+=' </div> </div> </div> <div id="add-image-error" class="alert alert-error hide"> </div> </div> <div id="inventory-shipping" class="form-horizontal earnings-section"> <div class="section-title">'+((__t=(i18n("库存和运送")))==null?'':_.escape(__t))+'</div> '; if (window.pageParams.rev_share) { __p+=' '+((__t=(inputRowTpl({ 'index': window.pageParams.index_map.PRICE_COLUMN })))==null?'':__t)+' '; } else { __p+=' '+((__t=(inputRowTpl({ 'index': window.pageParams.index_map.COST_COLUMN })))==null?'':__t)+' '; } __p+=' '+((__t=(inputRowTpl({ 'index': window.pageParams.index_map.QUANTITY_COLUMN })))==null?'':__t)+' '+((__t=(inputRowTpl({ 'index': window.pageParams.index_map.SHIPPING_COLUMN })))==null?'':__t)+' <div class="control-group"> <label class="control-label" > <span class="col-name"> '+((__t=(i18n("利润")))==null?'':__t)+'</span> </label> <div class="controls input-append"> <input class="input-block-level" type="text" id = "earnings" disabled /> </div> </div> <input type="hidden" name="'+((__t=(window.pageParams.commerce_columns[window.pageParams.index_map.SHIPPING_TIME_COLUMN].name))==null?'':__t)+'" id="shipping-time-submit" > <div id="shipping-time"> <div class="control-label"> '+((__t=(window.pageParams.commerce_columns[window.pageParams.index_map.SHIPPING_TIME_COLUMN].name))==null?'':__t)+' </div> <div id="common-ship-time"> '; for (var i = 0; i < common_shipping_time.length; i++) { __p+=' '+((__t=(shippingTimeRowTpl({ 'time': common_shipping_time[i] })))==null?'':__t)+' '; } __p+=' <div class="clearfix"> <div> <label class="pull-left ship-time-labels-other"> <input type="checkbox" class="ship-time-checkbox" name="ship-time-checkbox" id="ship-time-other"> '+((__t=(i18n("其他：")))==null?'':__t)+' </label> </div> <div> <div class="pull-left ship-time-input ship-time-input-div"> <label> '+((__t=(i18n("最小预估数")))==null?'':__t)+' </label> <div class="control-group" data-col-index="'+((__t=(window.pageParams.index_map.SHIPPING_TIME_COLUMN))==null?'':__t)+'" > <div class="ship-time-controls controls input-append"> <input class="input-block-level ship-time-text" type="text" name="'+((__t=(window.pageParams.commerce_columns[window.pageParams.index_map.SHIPPING_TIME_COLUMN].name))==null?'':__t)+'" id="min-ship-time" /> <span class="add-on"><i class="icon-pencil"></i></span> </div> </div> </div> <div class="pull-left ship-time-input ship-time-input-div"> <label> '+((__t=(i18n("最大预估数")))==null?'':__t)+' </label> <div class="control-group" data-col-index="'+((__t=(window.pageParams.index_map.SHIPPING_TIME_COLUMN))==null?'':__t)+'"> <div class="ship-time-controls controls input-append"> <input class="input-block-level ship-time-text" type="text" name="'+((__t=(window.pageParams.commerce_columns[window.pageParams.index_map.SHIPPING_TIME_COLUMN].name))==null?'':__t)+'" id="max-ship-time" /> <span class="add-on"><i class="icon-pencil"></i></span> </div> </div> </div> </div> </div> </div> </div> </div> <div id="colors-info" class="form-horizontal"> <div class="section-title"> '+((__t=(i18n("颜色")))==null?'':_.escape(__t))+' </div> <div id="colors-selection" class="colors-selection"> '; for (var i = 0; i < common_colors.length; i++) { __p+=' '+((__t=(colorRowTpl({ 'colorName': common_colors[i].name, 'colorHex': common_colors[i].hexcode, 'checked': false })))==null?'':__t)+' '; } __p+=' </div> <label class="colors-selection"> '+((__t=(i18n("其他：")))==null?'':_.escape(__t))+' <input id="other-color-typeahead" type = "text"> <button class="btn" id="add-other-color" disabled> '+((__t=(i18n("添加")))==null?'':_.escape(__t))+'</button> </label> </div> <div id="sizes-info" class="form-horizontal"> <div class="section-title"> '+((__t=(i18n("尺码")))==null?'':_.escape(__t))+' </div> <div id="sizes-selection" class="tabbable"> <ul class="nav nav-pills"> '; for (var i = 0; i < valid_sizes.length; i++) { __p+=' '+((__t=(sizeTabHeadingTpl({ 'categoryIndex': valid_sizes[i][0], 'categoryName': valid_sizes[i][1] })))==null?'':__t)+' '; } __p+=' </ul> </div> <div class="tab-content"> '; for (var i = 0; i < valid_sizes.length; i++) { __p+=' '+((__t=(sizeTabPaneTpl({ 'categoryIndex': valid_sizes[i][0], 'categoryName': valid_sizes[i][1], 'categoryList': valid_sizes[i][2], 'sizeRowTpl': sizeRowTpl })))==null?'':__t)+' '; } __p+=' </div> </div> <div id="add-variations" class="form-horizontal"> <div class="section-title">'+((__t=(i18n("产品变量")))==null?'':_.escape(__t))+'</div> <div id="variations-section" class = "variations-section"> <div id="variations-heading" class="hide"> <h5 class="variation-heading-size">'+((__t=(i18n("尺寸")))==null?'':__t)+'</h5> <h5 class="variation-heading-color">'+((__t=(i18n("颜色")))==null?'':__t)+'</h5> <h5 class="variation-input-large">'+((__t=(i18n("唯一 ID (SKU)")))==null?'':__t)+'</h5> '; if (window.pageParams.rev_share) { __p+=' <h5 class="variation-input-small"> '+((__t=(window.pageParams.commerce_columns[window.pageParams.index_map.PRICE_COLUMN].name))==null?'':__t)+' </h5> '; } else { __p+=' <h5 class="variation-input-small"> '+((__t=(window.pageParams.commerce_columns[window.pageParams.index_map.COST_COLUMN].name))==null?'':__t)+' </h5> '; } __p+=' <h5 class="variation-input-small">'+((__t=(i18n("数量")))==null?'':__t)+'</h5> <h5 class="variation-input-earnings">'+((__t=(i18n("利润")))==null?'':__t)+'</h5> </div> </div> </div> <div id="optional-info" class="form-horizontal"> <div class="section-title"> '+((__t=(i18n("可选信息")))==null?'':_.escape(__t))+' <div id="toggle-optional" class="pull-right"><i class="icon-minus"></i></div> </div> <div id="optional-fields"> '+((__t=(inputRowTpl({ 'index': window.pageParams.index_map.MSRP_COLUMN })))==null?'':__t)+' '+((__t=(inputRowTpl({ 'index': window.pageParams.index_map.BRAND_COLUMN })))==null?'':__t)+' '+((__t=(inputRowTpl({ 'index': window.pageParams.index_map.UPC_COLUMN })))==null?'':__t)+' '+((__t=(inputRowTpl({ 'index': window.pageParams.index_map.CLICK_OUT_URL_COLUMN })))==null?'':__t)+' '; if(window.pageParams['use_custom_charts']){ __p+=' '+((__t=(sizingChartRowTpl()))==null?'':__t)+' '; } __p+=' </div> </div> <div id="auto-refund" class="form-horizontal"> <div class="section-title"> '+((__t=(i18n("自动退款所需等待的天数")))==null?'':_.escape(__t))+' </div> <div id="auto-refund-section"> <input value="5" type="text" class="auto-refund-input" disabled> '+((__t=(i18n("自动退款所需等待的天数")))==null?'':_.escape(__t))+' <h5> '+((__t=(i18n("所有订单必须在5天内履行，否则将会被自动退款。")))==null?'':_.escape(__t))+' </h5> </div> </div> <div id="summary-action" class="form-horizontal"> <div class="section-title">'+((__t=(i18n("摘要")))==null?'':_.escape(__t))+'</div> <div class="control-group text-center"> <div id="summary-error" class="alert alert-error"> '+((__t=(i18n("您未填写产品名称。")))==null?'':_.escape(__t))+' </div> <div id="summary-info" class="alert alert-info hide"> Creating <span id="product-name"></span> with <span id="variations-count">0</span> variations </div> </div> <div id="buttons-section" class="control-group text-right"> <button id="clear-button" class="btn btn-large">'+((__t=(i18n("清除")))==null?'':_.escape(__t))+'</button> <button id="submit-button" type="button" class="btn btn-primary btn-large">'+((__t=(i18n("提交")))==null?'':_.escape(__t))+'</button> <div id="loading-spinner" class="loading hide"></div> </div> </div> </div> ';}return __p;},"input_row":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' '; var col_name = window.pageParams.commerce_columns[index].name; __p+=' '; var required = !_.contains(window.pageParams.optional_col_index, index); __p+=' <div class="control-group"> <label class="control-label" data-col-index="'+((__t=(index))==null?'':_.escape(__t))+'"> <span class="col-name">'+((__t=(col_name))==null?'':_.escape(__t))+'</span> <i class="icon-question-sign"></i> </label> <div class="controls input-append"> '; if (index == window.pageParams.index_map.TAGS_COLUMN) { __p+=' <ul class="typeahead-tokenizer"></ul> '; } else { __p+=' ';if (index == window.pageParams.index_map.DESCRIPTION_COLUMN) { __p+=' <textarea rows = "5" '; } else { __p+=' <input '; } __p+=' class="input-block-level '; if (required) { __p+='required'; } __p+='" name="'+((__t=(col_name))==null?'':_.escape(__t))+'" type="text" value="'+((__t=(window.pageParams.prefill_values[index] || ''))==null?'':_.escape(__t))+'" placeholder="'+((__t=(window.pageParams.column_info[col_name].examples[0]))==null?'':_.escape(__t))+'" /> '; } __p+=' <span class="add-on"><i class="icon-pencil"></i></span> </div> </div> ';}return __p;},"image_row":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' '; var col_name = window.pageParams.commerce_columns[index].name; __p+=' '; var required = !_.contains(window.pageParams.optional_col_index, index); __p+=' '; var image_pref = window.pageParams.image_pref; __p+=' <div class="control-group"> <label class="control-label" data-col-index="'+((__t=(index))==null?'':_.escape(__t))+'"> <span class="col-name">'+((__t=(col_name))==null?'':_.escape(__t))+'</span> <i class="icon-question-sign"></i> </label> <div class="controls img-controls"> '; if (!image_pref) { __p+=' <div class="image-method-chooser btn-group"> <button class="btn image-btn web-image-btn"> <img src="'+((__t=("//static.china-merchant./img/ic_globe.png?v=18"))==null?'':_.escape(__t))+'" /> '+((__t=(i18n("从网络上传 (URL)")))==null?'':_.escape(__t))+' </button> <button class="btn image-btn computer-image-btn"> <img src="'+((__t=("//static.china-merchant./img/ic_monitor.png?v=18"))==null?'':_.escape(__t))+'" /> '+((__t=(i18n("从计算机上传")))==null?'':_.escape(__t))+' </button> </div> '; } __p+=' <div class="web img-input '; if (image_pref != window.pageParams.pref_map.WEB) { __p+='hide'; } __p+='"> <div class="input-append"> <input class="input-block-level web-input-field '; if (required) { __p+='required'; } __p+='" name="'+((__t=(col_name))==null?'':_.escape(__t))+'" type="text" placeholder="'+((__t=(window.pageParams.column_info[col_name].examples[0]))==null?'':_.escape(__t))+'" /> <span class="add-on"><i class="icon-pencil"></i></span> </div> <div> <button class="btn-small btn image-btn computer-image-btn"> <img src="'+((__t=("//static.china-merchant./img/ic_monitor.png?v=18"))==null?'':_.escape(__t))+'" /> '+((__t=(i18n("从计算机上传")))==null?'':_.escape(__t))+' </button> </div> </div> <div class="computer img-input '; if ( image_pref != window.pageParams.pref_map.COMPUTER) { __p+=' hide '; } __p+=' "> <div class="input-prepend input-block-level input-append"> <button class="btn fake-file-upload"> '+((__t=(i18n("从计算机选择图片")))==null?'':_.escape(__t))+' </button> <input readonly class="file-display-input" type="text" /> <span class="add-on"><i class="icon-pencil"></i></span> </div> <form> <input class="real-file-upload" maxlength="10000000000" name="image-file-upload" type="file" accept=".jpg,.jpeg,.gif,.png" /> </form> <button class="btn btn-small image-btn web-image-btn"> <img src="'+((__t=("//static.china-merchant./img/ic_globe.png?v=18"))==null?'':_.escape(__t))+'" /> '+((__t=(i18n("从网络上传 (URL)")))==null?'':_.escape(__t))+' </button> </div> </div> </div> ';}return __p;},"variation_section":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="variation-section"> <div class="remove-variation pull-right" rel="tooltip" data-original-title="'+((__t=(i18n("删除此变量")))==null?'':_.escape(__t))+'"> <i class="icon-remove"></i> </div> '+((__t=(inputRowTpl({ 'index': window.pageParams.index_map.SIZE_COLUMN })))==null?'':__t)+' '+((__t=(inputRowTpl({ 'index': window.pageParams.index_map.COLOR_COLUMN })))==null?'':__t)+' '+((__t=(inputRowTpl({ 'index': window.pageParams.index_map.UNIQUE_ID_COLUMN })))==null?'':__t)+' '; if (window.pageParams.rev_share) { __p+=' '+((__t=(inputRowTpl({ 'index': window.pageParams.index_map.PRICE_COLUMN })))==null?'':__t)+' '; } else { __p+=' '+((__t=(inputRowTpl({ 'index': window.pageParams.index_map.COST_COLUMN })))==null?'':__t)+' '; } __p+=' '+((__t=(inputRowTpl({ 'index': window.pageParams.index_map.QUANTITY_COLUMN })))==null?'':__t)+' '+((__t=(inputRowTpl({ 'index': window.pageParams.index_map.SHIPPING_COLUMN })))==null?'':__t)+' '+((__t=(inputRowTpl({ 'index': window.pageParams.index_map.SHIPPING_TIME_COLUMN })))==null?'':__t)+' </div> ';}return __p;},"variation_row":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="variation-row earnings-section" name="'+((__t=(variationName))==null?'':__t)+'"> <div class="variation-inputs"> <span name="size-label" class="variation-name-label"> '+((__t=(variationSize))==null?'':__t)+' </span> </div> <div class="variation-inputs"> <span name="color-label" class="variation-name-label"> '; if (colorHex != "") { __p+=' <div '; if(colorHex == "url"){ __p+=' class="color-box color-box-image" style="background-image: url(\''+((__t=(window.pageParams.multicolor_image))==null?'':__t)+'\')" '; } else { __p+=' class="color-box" style="background-color: '+((__t=(colorHex))==null?'':__t)+'" '; } __p+=' > </div> '; } __p+=' '+((__t=(variationColor))==null?'':__t)+' </span> </div> <input type="hidden" name="Size" value="'+((__t=(variationSize.replace(/"/g, '&quot;')))==null?'':__t)+'"> <input type="hidden" name="Color" value="'+((__t=(variationColor))==null?'':__t)+'"> '+((__t=(variationInputTpl({ 'index': window.pageParams.index_map.UNIQUE_ID_COLUMN, 'inputClass': "input-large" })))==null?'':__t)+' '; if (window.pageParams.rev_share) { __p+=' '+((__t=(variationInputTpl({ 'index': window.pageParams.index_map.PRICE_COLUMN, 'inputClass': "input-small" })))==null?'':__t)+' '; } else { __p+=' '+((__t=(variationInputTpl({ 'index': window.pageParams.index_map.COST_COLUMN, 'inputClass': "input-small" })))==null?'':__t)+' '; } __p+=' '+((__t=(variationInputTpl({ 'index': window.pageParams.index_map.QUANTITY_COLUMN, 'inputClass': "input-small" })))==null?'':__t)+' <div class="control-group" > <div class="controls input-append input-small"> <input class="input-block-level" type="text" id = "earnings" disabled value = "'+((__t=(earnings))==null?'':__t)+'" /> </div> </div> </div> ';}return __p;},"variation_input_row":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' '; var col_name = window.pageParams.commerce_columns[index].name; __p+=' '; var required = !_.contains(window.pageParams.optional_col_index, index); __p+=' '; var example = window.pageParams.column_info[col_name].examples[0]; __p+=' '; if(index != window.pageParams.index_map.UNIQUE_ID_COLUMN && example.indexOf("Acceptable: ") == 0) { example = example.substring(12); } __p+=' <div class="control-group" data-col-index="'+((__t=(index))==null?'':_.escape(__t))+'" > <div class="controls input-append '+((__t=(inputClass))==null?'':__t)+'"> <input class="input-block-level '; if (required) { __p+='required'; } __p+='" name="'+((__t=(col_name))==null?'':_.escape(__t))+'" type="text" value="'+((__t=(window.pageParams.prefill_values[index] || ''))==null?'':_.escape(__t))+'" placeholder="'+((__t=(example))==null?'':_.escape(__t))+'" /> <span class="add-on"><i class="icon-pencil"></i></span> </div> </div> ';}return __p;},"color_row":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <label class="color-labels"> <input type="checkbox" class="colours-row-checkbox" name="'+((__t=(colorName.replace(/[\W]/g, '')))==null?'':__t)+'" display-name="'+((__t=(colorName))==null?'':__t)+'" color-hex="'+((__t=(colorHex))==null?'':__t)+'" '; if (checked) { __p+=' checked '; } __p+=' > '; if (colorHex != "") { __p+=' <div '; if(colorHex == "url"){ __p+=' class="color-box color-box-image" style="background-image: url(\''+((__t=(window.pageParams.multicolor_image))==null?'':__t)+'\')" '; } else { __p+=' class="color-box" style="background-color: '+((__t=(colorHex))==null?'':__t)+'" '; } __p+=' > </div> '; } __p+=' '+((__t=(colorName))==null?'':__t)+' </label> ';}return __p;},"size_row":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <label class="size-labels"> <input type="checkbox" class="sizes-row-checkbox" name="'+((__t=(sizeName.replace(/[\W]/g, '')))==null?'':__t)+'" display-name="'+((__t=(sizeName.replace(/"/g, '&quot;')))==null?'':__t)+'" '; if (checked) { __p+=' checked '; } __p+=' > '+((__t=(sizeName))==null?'':__t)+' </label> ';}return __p;},"size_tab_heading":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <li><a href="#size-category-tab-'+((__t=(categoryIndex))==null?'':__t)+'" data-toggle="tab"> '+((__t=(categoryName))==null?'':__t)+' </a></li> ';}return __p;},"size_tab_pane":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' '; var column_size = categoryList.length/3; var i = 0; __p+=' <div id="size-category-tab-'+((__t=(categoryIndex))==null?'':__t)+'" class="tab-pane"> <div class="size-category-checkbox-section"> <div class="size-category-column" id="size-category-column-1"> '; for (i; i < column_size; i++) { __p+=' '+((__t=(sizeRowTpl({ 'sizeName': categoryList[i][1], 'checked': false })))==null?'':__t)+' '; } __p+=' </div> <div class="size-category-column" id="size-category-column-2"> '; for (; i < column_size * 2; i++) { __p+=' '+((__t=(sizeRowTpl({ 'sizeName': categoryList[i][1], 'checked': false })))==null?'':__t)+' '; } __p+=' </div> <div class="size-category-column" id="size-category-column-3"> '; for (; i < categoryList.length; i++) { __p+=' '+((__t=(sizeRowTpl({ 'sizeName': categoryList[i][1], 'checked': false })))==null?'':__t)+' '; } __p+=' </div> </div> <div class="size-category-add-section"> </div> <div class="size-category-size-chart"> </div> </div> ';}return __p;},"sizes_add_input":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div> <label class="variation-inputs"> Other: <input class="sizes_user_input" type="text" id="'+((__t=(inputId))==null?'':__t)+'"> </label> <button class="btn" type="button" id="'+((__t=(buttonId))==null?'':__t)+'" disabled> Add </button> </div> ';}return __p;},"fake_dropzone_preview":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="image-preview-div pull-left fake-preview" parent-dropzone="'+((__t=(parentDropzone))==null?'':__t)+'" > <img class="image-preview-thumbnail" data-dz-thumbnail="" src="'+((__t=(src))==null?'':__t)+'"> <a class="image-preview-remove fake-dropzone-remove" data-dz-remove></a> </div> ';}return __p;},"real_dropzone_preview":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="pull-left image-preview-div"> <img class="image-preview-thumbnail" data-dz-thumbnail=""> <a class="image-preview-remove" data-dz-remove></a> </div> ';}return __p;},"shipping_time_row":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <label class="ship-time-labels"> <input type="checkbox" class="ship-time-checkbox" name="ship-time-checkbox" value="'+((__t=(time))==null?'':__t)+'"> '+((__t=(time))==null?'':__t)+' </label> ';}return __p;},"sizing_chart_row":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="control-group"> <label class="control-label"> <span class="col-name">Custom Sizing Chart</span> </label> <div class="controls input-append"> <input id=\'custom-sizing-chart\' class="input-block-level" name="sizing_chart" type="text" value="" disabled /> <span class="pick-sizing-chart btn add-on"><i class="icon-list"></i></span> </div> </div> ';}return __p;}};});

!function($){var Typeahead=function(element,options){this.$element=$(element);this.options=$.extend({},$.fn.typeahead.defaults,options);this.matcher=this.options.matcher||this.matcher;this.sorter=this.options.sorter||this.sorter;this.highlighter=this.options.highlighter||this.highlighter;this.$menu=$(this.options.menu).appendTo("body");this.source=this.options.source;this.onselect=this.options.onselect;this.autoselect=this.options.autoselect;this.autowidth=this.options.autowidth;this.strings=true;this.shown=false;this.timeout=this.options.timeout||10;this.listen()};Typeahead.prototype={constructor:Typeahead,select:function(){var text,original_text;var hasactive=!this.$menu.find(".active").length==0;if(!hasactive){var val=this.$element.val()}else{var val=JSON.parse(this.$menu.find(".active").attr("data-value"))}if(!this.strings&&hasactive)text=val[this.options.property];else text=val;original_text=this.$element.val();this.$element.val(text);if(typeof this.onselect=="function")this.onselect(val,text,original_text);return this.hide()},show:function(){var pos=$.extend({},this.$element.offset(),{height:this.$element[0].offsetHeight});this.$menu.css({top:pos.top+pos.height,left:pos.left});this.$menu.show();this.shown=true;return this},hide:function(){this.$menu.hide();this.shown=false;return this},lookup:function(event){var that=this,items,q,value;this.query=this.$element.val();if(typeof this.source=="function"){value=this.source(this,this.query);if(value)this.process(value)}else{this.process(this.source)}},process:function(results){var that=this,items,q;if(results.length&&typeof results[0]!="string")this.strings=false;this.query=this.$element.val();if(!this.query){return this.shown?this.hide():this}items=$.grep(results,function(item){if(!that.strings)item=item[that.options.property];if(that.matcher(item))return item});items=this.sorter(items);if(!items.length){return this.shown?this.hide():this}return this.render(items.slice(0,this.options.items)).show()},matcher:function(item){return~item.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(items){var beginswith=[],caseSensitive=[],caseInsensitive=[],item,sortby;while(item=items.shift()){if(this.strings)sortby=item;else sortby=item[this.options.property];if(!sortby.toLowerCase().indexOf(this.query.toLowerCase()))beginswith.push(item);else if(~sortby.indexOf(this.query))caseSensitive.push(item);else caseInsensitive.push(item)}return beginswith.concat(caseSensitive,caseInsensitive)},highlighter:function(item){return item.replace(new RegExp("("+this.query+")","ig"),function($1,match){return"<strong>"+match+"</strong>"})},render:function(items){var that=this;items=$(items).map(function(i,item){i=$(that.options.item).attr("data-value",JSON.stringify(item));if(!that.strings)item=item[that.options.property];i.find("a").html(that.highlighter(item));return i[0]});if(that.autoselect)items.first().addClass("active");if(that.autowidth)this.$menu.width(this.$element.width());this.$menu.html(items);return this},next:function(event){var active=this.$menu.find(".active").removeClass("active"),next=active.next();if(!next.length){next=$(this.$menu.find("li")[0])}next.addClass("active")},prev:function(event){var active=this.$menu.find(".active").removeClass("active"),prev=active.prev();if(!prev.length){prev=this.$menu.find("li").last()}prev.addClass("active")},listen:function(){this.$element.on("blur",$.proxy(this.blur,this)).on("keypress",$.proxy(this.keypress,this)).on("keyup",$.proxy(this.keyup,this));if($.browser.webkit||$.browser.msie){this.$element.on("keydown",$.proxy(this.keypress,this))}this.$menu.on("click",$.proxy(this.click,this)).on("mouseenter","li",$.proxy(this.mouseenter,this))},keyup:function(e){e.stopPropagation();e.preventDefault();switch(e.keyCode){case 40:case 38:break;case 13:if(!this.shown)return;this.select();break;case 9:var that=this;e.stopPropagation();e.preventDefault();setTimeout(function(){that.hide()},150);break;case 27:this.hide();break;default:if(this.timer)clearTimeout(this.timer);var self=this;this.timer=setTimeout(function(){self.lookup()},this.timeout)}},keypress:function(e){e.stopPropagation();if(!this.shown)return;switch(e.keyCode){case 9:case 13:case 27:e.preventDefault();break;case 38:if(e.type==="keydown"){e.preventDefault();this.prev()}break;case 40:e.preventDefault();this.next();break}},blur:function(e){var that=this;e.stopPropagation();e.preventDefault();setTimeout(function(){that.hide()},150)},click:function(e){e.stopPropagation();e.preventDefault();this.select()},mouseenter:function(e){this.$menu.find(".active").removeClass("active");$(e.currentTarget).addClass("active")}};$.fn.typeahead=function(option){return this.each(function(){var $this=$(this),data=$this.data("typeahead"),options=typeof option=="object"&&option;if(!data)$this.data("typeahead",data=new Typeahead(this,options));if(typeof option=="string")data[option]()})};$.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',onselect:null,autoselect:true,autowidth:true,timeout:10,property:"value"};$.fn.typeahead.Constructor=Typeahead;$(function(){$("body").on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(e){var $this=$(this);if($this.data("typeahead"))return;e.preventDefault();$this.typeahead($this.data())})})}(window.jQuery);
define("lib/bootstrap-typeahead", function(){});

define('view/TagTokenizer',["underscore","core/bb","core/api","lib/bootstrap-typeahead"],function(_,bb,api,typeahead2){var TagTokenizerView=bb.BackboneView.extend({notag:"No tags found, press ENTER to create tag",newtag:"Create new tag: ",max_tokens:10,initialize:function(options){this.tokens=[];this.last_query="";this.ul_el=options.ul_el;this.input_el=options.ul_el+" .token-input";this.hidden_el=options.ul_el+" input[type=hidden]";this.placeholder=options.placeholder||"";this.input_class=options.input_class||"";this.input_name=options.input_name||"";this.setElement($(this.ul_el));$(this.ul_el).html('<li class="token-li first-li">'+'<input class="token-input " type="text" placeholder="'+this.placeholder+'">'+'<input id="'+this.input_name+'" name="'+this.input_name+'" class="'+this.input_class+'" type="hidden">'+"</li>");if("initial_tokens"in options&&options.initial_tokens.length>0){for(var i=0;i<options.initial_tokens.length;i++){this.addToken(options.initial_tokens[i],true)}}if("max_tokens"in options){this.max_tokens=options.max_tokens}$(this.input_el).typeahead({minLength:1,source:_.bind(this.tokenSource,this),matcher:function(item){return true},onselect:_.bind(this.tokenUpdater,this),autowidth:false,timeout:200});var _this=this;$(this.input_el).focus(function(){$(_this.ul_el).addClass("focus")});$(this.input_el).blur(function(){$(_this.ul_el).removeClass("focus")});$(this.ul_el).click(function(){$(_this.input_el).focus()})},events:{"click .close":"deleteToken"},tokenSource:function(typeahead,query){var _this=this;var params={q:query};if(query==""){return[]}api.call("contest-tag/search",params,function(resp){var tags=[];var exactMatchFound=false;for(var i=0;i<resp.data.tags.length;i++){var tag=resp.data.tags[i].tag;tags.push(tag);if(query.toUpperCase()==tag.toUpperCase()){exactMatchFound=true}}if(tags.length==0){tags.push(_this.notag)}else if(!exactMatchFound){var createTag=_this.newtag+query;tags.push(createTag)}this.last_query=query;typeahead.process(tags)})},tokenUpdater:function(item){this.addToken(item);$(this.hidden_el).trigger("change")},addToken:function(item,is_initial_render){$(this.input_el).val("");$(this.input_el).removeAttr("placeholder");if(this.tokens.length>=this.max_tokens&&!is_initial_render){alert("Sorry, you can only have up to "+this.max_tokens+" tags.");return}if($.inArray(item,this.tokens)>=0&&!is_initial_render){alert("That tag already exists!");return}if(item==this.notag||item.indexOf(this.newtag)==0){item=last_query}$(this.input_el).parent().removeClass("first-li").before('<li class="token-li token-item">'+item+'<a class="close" data-token="'+item+'">&times;</a></li>');this.tokens.push(item);$(this.hidden_el).val(this.tokens.join(","));$(this.input_el).focus()},deleteToken:function(evt){var token=$(evt.currentTarget).data("token");this.tokens=this.removeFromArray(token,this.tokens);var tokens_val=this.tokens.join(",");$(this.hidden_el).val(tokens_val);if(tokens_val==""){$(this.input_el).attr("placeholder",this.placeholder);$(this.input_el).parent().addClass("first-li")}$(evt.currentTarget).parent().remove();$(this.hidden_el).trigger("change")},removeFromArray:function(value,arr){return $.grep(arr,function(elem,index){return elem==value},true)}});return TagTokenizerView});
define('tpl!modals/column_info', function() {return {"col_info_modal":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="modal hide fade"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button> <h3>'+((__t=(col_name))==null?'':_.escape(__t))+'</h3> </div> <div class="modal-body"> <div class="section"> <h5>Type</h5> <div class="content">'+((__t=(col_info.type))==null?'':_.escape(__t))+'</div> </div> <div class="section"> <h5>Description</h5> <div class="content">'+((__t=(col_info.explain_text))==null?'':__t)+'</div> </div> <div class="section"> <h5>Examples</h5> <div class="content"> <ul class="example-list"> '; _.each(col_info.examples, function(example) { __p+=' <li>'+((__t=(example))==null?'':_.escape(__t))+'</li> '; }); __p+=' </ul> </div> </div> </div> <div class="modal-footer"> <a href="#" data-dismiss="modal" class="btn">OK</a> </div> </div> ';}return __p;}};});

define('view/modal/ColumnInfoModalView',["view/modal/BaseModal","tpl!modals/column_info"],function(BaseModalView,tpl){var ColumnInfoModalView=BaseModalView.extend({column_info:window.pageParams.column_info,initialize:function(col_name){this.colName=$.trim(col_name);this.tpl=this.buildTpl(tpl.col_info_modal);this.el=this.tpl({col_name:this.colName,col_info:this.column_info[this.colName]})},render:function(){this.launchModal(this.el)}});return ColumnInfoModalView});
define('tpl!modals/add_product_success_modal', function() {return {"add_product_success_modal":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div id="add_product_success_modal" class="modal hide fade"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button> <h3>'+((__t=(header))==null?'':__t)+'</h3> </div> <div class="modal-body"> '+((__t=(body))==null?'':__t)+' </div> <div class="modal-footer"> <span class="error pull-left"></span> <a data-dismiss="modal" class="btn"> '+((__t=(i18n("关闭")))==null?'':__t)+'</a> <a class="btn btn-primary" id="add-another-btn"> '+((__t=(i18n("添加其他产品")))==null?'':__t)+'</a> </div> </div>';}return __p;}};});

define('view/modal/AddProductSuccessModal',["core/api","view/modal/BaseModal","tpl!modals/add_product_success_modal"],function(api,BaseModalView,tpl){var AddProductSuccessModal=BaseModalView.extend({initialize:function(options){this.tpl=this.buildTpl(tpl.add_product_success_modal);this.header=options.header;this.body=options.body},render:function(){var modal_el=this.tpl({header:this.header,body:this.body});this.launchModal(modal_el)},events:{"click #add-another-btn":"addAnother"},addAnother:function(){this.closeModal();window.location.reload()}});return AddProductSuccessModal});
(function(factory){factory(jQuery)})(function(jQuery){var module={exports:{}};module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[event]=this._callbacks[event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){var self=this;this._callbacks=this._callbacks||{};function on(){self.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length};(function(){var Dropzone,Em,camelize,contentLoaded,detectVerticalSquash,drawImageIOSFix,noop,without,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},__slice=[].slice;Em=typeof Emitter!=="undefined"&&Emitter!==null?Emitter:require("emitter");noop=function(){};Dropzone=function(_super){var extend;__extends(Dropzone,_super);Dropzone.prototype.events=["drop","dragstart","dragend","dragenter","dragover","dragleave","addedfile","removedfile","thumbnail","error","errormultiple","processing","processingmultiple","uploadprogress","totaluploadprogress","sending","sendingmultiple","success","successmultiple","canceled","canceledmultiple","complete","completemultiple","reset","maxfilesexceeded","maxfilesreached"];Dropzone.prototype.defaultOptions={url:null,method:"post",withCredentials:false,parallelUploads:2,uploadMultiple:false,maxFilesize:256,paramName:"file",createImageThumbnails:true,maxThumbnailFilesize:10,thumbnailWidth:100,thumbnailHeight:100,maxFiles:null,params:{},clickable:true,ignoreHiddenFiles:true,acceptedFiles:null,acceptedMimeTypes:null,autoProcessQueue:true,autoQueue:true,addRemoveLinks:false,previewsContainer:null,dictDefaultMessage:"Drop files here to upload",dictFallbackMessage:"Your browser does not support drag'n'drop file uploads.",dictFallbackText:"Please use the fallback form below to upload your files like in the olden days.",dictFileTooBig:"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",dictInvalidFileType:"You can't upload files of this type.",dictResponseError:"Server responded with {{statusCode}} code.",dictCancelUpload:"Cancel upload",dictCancelUploadConfirmation:"Are you sure you want to cancel this upload?",dictRemoveFile:"Remove file",dictRemoveFileConfirmation:null,dictMaxFilesExceeded:"You can not upload any more files.",accept:function(file,done){return done()},init:function(){return noop},forceFallback:false,fallback:function(){var child,messageElement,span,_i,_len,_ref;this.element.className=""+this.element.className+" dz-browser-not-supported";_ref=this.element.getElementsByTagName("div");for(_i=0,_len=_ref.length;_i<_len;_i++){child=_ref[_i];if(/(^| )dz-message($| )/.test(child.className)){messageElement=child;child.className="dz-message";continue}}if(!messageElement){messageElement=Dropzone.createElement('<div class="dz-message"><span></span></div>');this.element.appendChild(messageElement)}span=messageElement.getElementsByTagName("span")[0];if(span){span.textContent=this.options.dictFallbackMessage}return this.element.appendChild(this.getFallbackForm())},resize:function(file){var info,srcRatio,trgRatio;info={srcX:0,srcY:0,srcWidth:file.width,srcHeight:file.height};srcRatio=file.width/file.height;info.optWidth=this.options.thumbnailWidth;info.optHeight=this.options.thumbnailHeight;if(info.optWidth==null&&info.optHeight==null){info.optWidth=info.srcWidth;info.optHeight=info.srcHeight}else if(info.optWidth==null){info.optWidth=srcRatio*info.optHeight}else if(info.optHeight==null){info.optHeight=1/srcRatio*info.optWidth}trgRatio=info.optWidth/info.optHeight;if(file.height<info.optHeight||file.width<info.optWidth){info.trgHeight=info.srcHeight;info.trgWidth=info.srcWidth}else{if(srcRatio>trgRatio){info.srcHeight=file.height;info.srcWidth=info.srcHeight*trgRatio}else{info.srcWidth=file.width;info.srcHeight=info.srcWidth/trgRatio}}info.srcX=(file.width-info.srcWidth)/2;info.srcY=(file.height-info.srcHeight)/2;return info},drop:function(e){return this.element.classList.remove("dz-drag-hover")},dragstart:noop,dragend:function(e){return this.element.classList.remove("dz-drag-hover")},dragenter:function(e){return this.element.classList.add("dz-drag-hover")},dragover:function(e){return this.element.classList.add("dz-drag-hover")},dragleave:function(e){return this.element.classList.remove("dz-drag-hover")},paste:noop,reset:function(){return this.element.classList.remove("dz-started")},addedfile:function(file){var node,removeFileEvent,removeLink,_i,_j,_k,_len,_len1,_len2,_ref,_ref1,_ref2,_results;if(this.element===this.previewsContainer){this.element.classList.add("dz-started")}if(this.previewsContainer){file.previewElement=Dropzone.createElement(this.options.previewTemplate.trim());file.previewTemplate=file.previewElement;this.previewsContainer.appendChild(file.previewElement);_ref=file.previewElement.querySelectorAll("[data-dz-name]");for(_i=0,_len=_ref.length;_i<_len;_i++){node=_ref[_i];node.textContent=file.name}_ref1=file.previewElement.querySelectorAll("[data-dz-size]");for(_j=0,_len1=_ref1.length;_j<_len1;_j++){node=_ref1[_j];node.innerHTML=this.filesize(file.size)}if(this.options.addRemoveLinks){file._removeLink=Dropzone.createElement('<a class="dz-remove" href="javascript:undefined;" data-dz-remove>'+this.options.dictRemoveFile+"</a>");file.previewElement.appendChild(file._removeLink)}removeFileEvent=function(_this){return function(e){e.preventDefault();e.stopPropagation();if(file.status===Dropzone.UPLOADING){return Dropzone.confirm(_this.options.dictCancelUploadConfirmation,function(){return _this.removeFile(file)})}else{if(_this.options.dictRemoveFileConfirmation){return Dropzone.confirm(_this.options.dictRemoveFileConfirmation,function(){return _this.removeFile(file)})}else{return _this.removeFile(file)}}}}(this);_ref2=file.previewElement.querySelectorAll("[data-dz-remove]");_results=[];for(_k=0,_len2=_ref2.length;_k<_len2;_k++){removeLink=_ref2[_k];_results.push(removeLink.addEventListener("click",removeFileEvent))}return _results}},removedfile:function(file){var _ref;if(file.previewElement){if((_ref=file.previewElement)!=null){_ref.parentNode.removeChild(file.previewElement)}}return this._updateMaxFilesReachedClass()},thumbnail:function(file,dataUrl){var thumbnailElement,_i,_len,_ref,_results;if(file.previewElement){file.previewElement.classList.remove("dz-file-preview");file.previewElement.classList.add("dz-image-preview");_ref=file.previewElement.querySelectorAll("[data-dz-thumbnail]");_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){thumbnailElement=_ref[_i];thumbnailElement.alt=file.name;_results.push(thumbnailElement.src=dataUrl)}return _results}},error:function(file,message){var node,_i,_len,_ref,_results;if(file.previewElement){file.previewElement.classList.add("dz-error");if(typeof message!=="String"&&message.error){message=message.error}_ref=file.previewElement.querySelectorAll("[data-dz-errormessage]");_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){node=_ref[_i];_results.push(node.textContent=message)}return _results}},errormultiple:noop,processing:function(file){if(file.previewElement){file.previewElement.classList.add("dz-processing");if(file._removeLink){return file._removeLink.textContent=this.options.dictCancelUpload}}},processingmultiple:noop,uploadprogress:function(file,progress,bytesSent){var node,_i,_len,_ref,_results;if(file.previewElement){_ref=file.previewElement.querySelectorAll("[data-dz-uploadprogress]");_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){node=_ref[_i];_results.push(node.style.width=""+progress+"%")}return _results}},totaluploadprogress:noop,sending:noop,sendingmultiple:noop,success:function(file){if(file.previewElement){return file.previewElement.classList.add("dz-success")}},successmultiple:noop,canceled:function(file){return this.emit("error",file,"Upload canceled.")},canceledmultiple:noop,complete:function(file){if(file._removeLink){return file._removeLink.textContent=this.options.dictRemoveFile}},completemultiple:noop,maxfilesexceeded:noop,maxfilesreached:noop,previewTemplate:'<div class="dz-preview dz-file-preview">\n  <div class="dz-details">\n    <div class="dz-filename"><span data-dz-name></span></div>\n    <div class="dz-size" data-dz-size></div>\n    <img data-dz-thumbnail />\n  </div>\n  <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>\n  <div class="dz-success-mark"><span>✔</span></div>\n  <div class="dz-error-mark"><span>✘</span></div>\n  <div class="dz-error-message"><span data-dz-errormessage></span></div>\n</div>'};extend=function(){var key,object,objects,target,val,_i,_len;target=arguments[0],objects=2<=arguments.length?__slice.call(arguments,1):[];for(_i=0,_len=objects.length;_i<_len;_i++){object=objects[_i];for(key in object){val=object[key];target[key]=val}}return target};function Dropzone(element,options){var elementOptions,fallback,_ref;this.element=element;this.version=Dropzone.version;this.defaultOptions.previewTemplate=this.defaultOptions.previewTemplate.replace(/\n*/g,"");this.clickableElements=[];this.listeners=[];this.files=[];if(typeof this.element==="string"){this.element=document.querySelector(this.element)}if(!(this.element&&this.element.nodeType!=null)){throw new Error("Invalid dropzone element.")}if(this.element.dropzone){throw new Error("Dropzone already attached.")}Dropzone.instances.push(this);this.element.dropzone=this;elementOptions=(_ref=Dropzone.optionsForElement(this.element))!=null?_ref:{};this.options=extend({},this.defaultOptions,elementOptions,options!=null?options:{});if(this.options.forceFallback||!Dropzone.isBrowserSupported()){return this.options.fallback.call(this)}if(this.options.url==null){this.options.url=this.element.getAttribute("action")}if(!this.options.url){throw new Error("No URL provided.")}if(this.options.acceptedFiles&&this.options.acceptedMimeTypes){throw new Error("You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.")}if(this.options.acceptedMimeTypes){this.options.acceptedFiles=this.options.acceptedMimeTypes;delete this.options.acceptedMimeTypes}this.options.method=this.options.method.toUpperCase();if((fallback=this.getExistingFallback())&&fallback.parentNode){fallback.parentNode.removeChild(fallback)}if(this.options.previewsContainer!==false){if(this.options.previewsContainer){this.previewsContainer=Dropzone.getElement(this.options.previewsContainer,"previewsContainer")}else{this.previewsContainer=this.element}}if(this.options.clickable){if(this.options.clickable===true){this.clickableElements=[this.element]}else{this.clickableElements=Dropzone.getElements(this.options.clickable,"clickable")}}this.init()}Dropzone.prototype.getAcceptedFiles=function(){var file,_i,_len,_ref,_results;_ref=this.files;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){file=_ref[_i];if(file.accepted){_results.push(file)}}return _results};Dropzone.prototype.getRejectedFiles=function(){var file,_i,_len,_ref,_results;_ref=this.files;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){file=_ref[_i];if(!file.accepted){_results.push(file)}}return _results};Dropzone.prototype.getFilesWithStatus=function(status){var file,_i,_len,_ref,_results;_ref=this.files;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){file=_ref[_i];if(file.status===status){_results.push(file)}}return _results};Dropzone.prototype.getQueuedFiles=function(){return this.getFilesWithStatus(Dropzone.QUEUED)};Dropzone.prototype.getUploadingFiles=function(){return this.getFilesWithStatus(Dropzone.UPLOADING)};Dropzone.prototype.getActiveFiles=function(){var file,_i,_len,_ref,_results;_ref=this.files;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){file=_ref[_i];if(file.status===Dropzone.UPLOADING||file.status===Dropzone.QUEUED){_results.push(file)}}return _results};Dropzone.prototype.init=function(){var eventName,noPropagation,setupHiddenFileInput,_i,_len,_ref,_ref1;if(this.element.tagName==="form"){this.element.setAttribute("enctype","multipart/form-data")}if(this.element.classList.contains("dropzone")&&!this.element.querySelector(".dz-message")){this.element.appendChild(Dropzone.createElement('<div class="dz-default dz-message"><span>'+this.options.dictDefaultMessage+"</span></div>"))}if(this.clickableElements.length){setupHiddenFileInput=function(_this){return function(){if(_this.hiddenFileInput){document.body.removeChild(_this.hiddenFileInput)}_this.hiddenFileInput=document.createElement("input");_this.hiddenFileInput.setAttribute("type","file");if(_this.options.maxFiles==null||_this.options.maxFiles>1){_this.hiddenFileInput.setAttribute("multiple","multiple")}_this.hiddenFileInput.className="dz-hidden-input";if(_this.options.acceptedFiles!=null){_this.hiddenFileInput.setAttribute("accept",_this.options.acceptedFiles)}_this.hiddenFileInput.style.visibility="hidden";_this.hiddenFileInput.style.position="absolute";_this.hiddenFileInput.style.top="0";_this.hiddenFileInput.style.left="0";_this.hiddenFileInput.style.height="0";_this.hiddenFileInput.style.width="0";document.body.appendChild(_this.hiddenFileInput);return _this.hiddenFileInput.addEventListener("change",function(){var file,files,_i,_len;files=_this.hiddenFileInput.files;if(files.length){for(_i=0,_len=files.length;_i<_len;_i++){file=files[_i];_this.addFile(file)}}return setupHiddenFileInput()})}}(this);setupHiddenFileInput()}this.URL=(_ref=window.URL)!=null?_ref:window.webkitURL;_ref1=this.events;for(_i=0,_len=_ref1.length;_i<_len;_i++){eventName=_ref1[_i];this.on(eventName,this.options[eventName])}this.on("uploadprogress",function(_this){return function(){return _this.updateTotalUploadProgress()}}(this));this.on("removedfile",function(_this){return function(){return _this.updateTotalUploadProgress()}}(this));this.on("canceled",function(_this){return function(file){return _this.emit("complete",file)}}(this));this.on("complete",function(_this){return function(file){if(_this.getUploadingFiles().length===0&&_this.getQueuedFiles().length===0){return setTimeout(function(){return _this.emit("queuecomplete")},0)}}}(this));noPropagation=function(e){e.stopPropagation();if(e.preventDefault){return e.preventDefault()}else{return e.returnValue=false}};this.listeners=[{element:this.element,events:{dragstart:function(_this){return function(e){return _this.emit("dragstart",e)}}(this),dragenter:function(_this){return function(e){noPropagation(e);return _this.emit("dragenter",e)}}(this),dragover:function(_this){return function(e){var efct;try{efct=e.dataTransfer.effectAllowed}catch(_error){}e.dataTransfer.dropEffect="move"===efct||"linkMove"===efct?"move":"copy";noPropagation(e);return _this.emit("dragover",e)}}(this),dragleave:function(_this){return function(e){return _this.emit("dragleave",e)}}(this),drop:function(_this){return function(e){noPropagation(e);return _this.drop(e)}}(this),dragend:function(_this){return function(e){return _this.emit("dragend",e)}}(this)}}];this.clickableElements.forEach(function(_this){return function(clickableElement){return _this.listeners.push({element:clickableElement,events:{click:function(evt){if(clickableElement!==_this.element||(evt.target===_this.element||Dropzone.elementInside(evt.target,_this.element.querySelector(".dz-message")))){return _this.hiddenFileInput.click()}}}})}}(this));this.enable();return this.options.init.call(this)};Dropzone.prototype.destroy=function(){var _ref;this.disable();this.removeAllFiles(true);if((_ref=this.hiddenFileInput)!=null?_ref.parentNode:void 0){this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput);this.hiddenFileInput=null}delete this.element.dropzone;return Dropzone.instances.splice(Dropzone.instances.indexOf(this),1)};Dropzone.prototype.updateTotalUploadProgress=function(){var activeFiles,file,totalBytes,totalBytesSent,totalUploadProgress,_i,_len,_ref;totalBytesSent=0;totalBytes=0;activeFiles=this.getActiveFiles();if(activeFiles.length){_ref=this.getActiveFiles();for(_i=0,_len=_ref.length;_i<_len;_i++){file=_ref[_i];totalBytesSent+=file.upload.bytesSent;totalBytes+=file.upload.total}totalUploadProgress=100*totalBytesSent/totalBytes}else{totalUploadProgress=100}return this.emit("totaluploadprogress",totalUploadProgress,totalBytes,totalBytesSent)};Dropzone.prototype._getParamName=function(n){if(typeof this.options.paramName==="function"){return this.options.paramName(n)}else{return""+this.options.paramName+(this.options.uploadMultiple?"["+n+"]":"")}};Dropzone.prototype.getFallbackForm=function(){var existingFallback,fields,fieldsString,form;if(existingFallback=this.getExistingFallback()){return existingFallback}fieldsString='<div class="dz-fallback">';if(this.options.dictFallbackText){fieldsString+="<p>"+this.options.dictFallbackText+"</p>"}fieldsString+='<input type="file" name="'+this._getParamName(0)+'" '+(this.options.uploadMultiple?'multiple="multiple"':void 0)+' /><input type="submit" value="Upload!"></div>';fields=Dropzone.createElement(fieldsString);if(this.element.tagName!=="FORM"){form=Dropzone.createElement('<form action="'+this.options.url+'" enctype="multipart/form-data" method="'+this.options.method+'"></form>');form.appendChild(fields)}else{this.element.setAttribute("enctype","multipart/form-data");this.element.setAttribute("method",this.options.method)}return form!=null?form:fields};Dropzone.prototype.getExistingFallback=function(){var fallback,getFallback,tagName,_i,_len,_ref;getFallback=function(elements){var el,_i,_len;for(_i=0,_len=elements.length;_i<_len;_i++){el=elements[_i];if(/(^| )fallback($| )/.test(el.className)){return el}}};_ref=["div","form"];for(_i=0,_len=_ref.length;_i<_len;_i++){tagName=_ref[_i];if(fallback=getFallback(this.element.getElementsByTagName(tagName))){return fallback}}};Dropzone.prototype.setupEventListeners=function(){var elementListeners,event,listener,_i,_len,_ref,_results;_ref=this.listeners;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){elementListeners=_ref[_i];_results.push(function(){var _ref1,_results1;_ref1=elementListeners.events;_results1=[];for(event in _ref1){listener=_ref1[event];_results1.push(elementListeners.element.addEventListener(event,listener,false))}return _results1}())}return _results};Dropzone.prototype.removeEventListeners=function(){var elementListeners,event,listener,_i,_len,_ref,_results;_ref=this.listeners;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){elementListeners=_ref[_i];_results.push(function(){var _ref1,_results1;_ref1=elementListeners.events;_results1=[];for(event in _ref1){listener=_ref1[event];_results1.push(elementListeners.element.removeEventListener(event,listener,false))}return _results1}())}return _results};Dropzone.prototype.disable=function(){var file,_i,_len,_ref,_results;this.clickableElements.forEach(function(element){return element.classList.remove("dz-clickable")});this.removeEventListeners();_ref=this.files;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){file=_ref[_i];_results.push(this.cancelUpload(file))}return _results};Dropzone.prototype.enable=function(){this.clickableElements.forEach(function(element){return element.classList.add("dz-clickable")});return this.setupEventListeners()};Dropzone.prototype.filesize=function(size){var string;if(size>=1024*1024*1024*1024/10){size=size/(1024*1024*1024*1024/10);string="TiB"}else if(size>=1024*1024*1024/10){size=size/(1024*1024*1024/10);string="GiB"}else if(size>=1024*1024/10){size=size/(1024*1024/10);string="MiB"}else if(size>=1024/10){size=size/(1024/10);string="KiB"}else{size=size*10;string="b"}return"<strong>"+Math.round(size)/10+"</strong> "+string};Dropzone.prototype._updateMaxFilesReachedClass=function(){if(this.options.maxFiles!=null&&this.getAcceptedFiles().length>=this.options.maxFiles){if(this.getAcceptedFiles().length===this.options.maxFiles){this.emit("maxfilesreached",this.files)}return this.element.classList.add("dz-max-files-reached")}else{return this.element.classList.remove("dz-max-files-reached")}};Dropzone.prototype.drop=function(e){var files,items;if(!e.dataTransfer){return}this.emit("drop",e);files=e.dataTransfer.files;if(files.length){items=e.dataTransfer.items;if(items&&items.length&&items[0].webkitGetAsEntry!=null){this._addFilesFromItems(items)}else{this.handleFiles(files)}}};Dropzone.prototype.paste=function(e){var items,_ref;if((e!=null?(_ref=e.clipboardData)!=null?_ref.items:void 0:void 0)==null){return}this.emit("paste",e);items=e.clipboardData.items;if(items.length){return this._addFilesFromItems(items)}};Dropzone.prototype.handleFiles=function(files){var file,_i,_len,_results;_results=[];for(_i=0,_len=files.length;_i<_len;_i++){file=files[_i];_results.push(this.addFile(file))}return _results};Dropzone.prototype._addFilesFromItems=function(items){var entry,item,_i,_len,_results;_results=[];for(_i=0,_len=items.length;_i<_len;_i++){item=items[_i];if(item.webkitGetAsEntry!=null&&(entry=item.webkitGetAsEntry())){if(entry.isFile){_results.push(this.addFile(item.getAsFile()))}else if(entry.isDirectory){_results.push(this._addFilesFromDirectory(entry,entry.name))}else{_results.push(void 0)}}else if(item.getAsFile!=null){if(item.kind==null||item.kind==="file"){_results.push(this.addFile(item.getAsFile()))}else{_results.push(void 0)}}else{_results.push(void 0)}}return _results};Dropzone.prototype._addFilesFromDirectory=function(directory,path){var dirReader,entriesReader;dirReader=directory.createReader();entriesReader=function(_this){return function(entries){var entry,_i,_len;for(_i=0,_len=entries.length;_i<_len;_i++){entry=entries[_i];if(entry.isFile){entry.file(function(file){if(_this.options.ignoreHiddenFiles&&file.name.substring(0,1)==="."){return}file.fullPath=""+path+"/"+file.name;return _this.addFile(file)})}else if(entry.isDirectory){_this._addFilesFromDirectory(entry,""+path+"/"+entry.name)}}}}(this);return dirReader.readEntries(entriesReader,function(error){return typeof console!=="undefined"&&console!==null?typeof console.log==="function"?console.log(error):void 0:void 0})};Dropzone.prototype.accept=function(file,done){if(file.size>this.options.maxFilesize*1024*1024){return done(this.options.dictFileTooBig.replace("{{filesize}}",Math.round(file.size/1024/10.24)/100).replace("{{maxFilesize}}",this.options.maxFilesize))}else if(!Dropzone.isValidFile(file,this.options.acceptedFiles)){return done(this.options.dictInvalidFileType)}else if(this.options.maxFiles!=null&&this.getAcceptedFiles().length>=this.options.maxFiles){done(this.options.dictMaxFilesExceeded.replace("{{maxFiles}}",this.options.maxFiles));return this.emit("maxfilesexceeded",file)}else{return this.options.accept.call(this,file,done)}};Dropzone.prototype.addFile=function(file){file.upload={progress:0,total:file.size,bytesSent:0};this.files.push(file);file.status=Dropzone.ADDED;this.emit("addedfile",file);this._enqueueThumbnail(file);return this.accept(file,function(_this){return function(error){if(error){file.accepted=false;_this._errorProcessing([file],error)}else{file.accepted=true;if(_this.options.autoQueue){_this.enqueueFile(file)}}return _this._updateMaxFilesReachedClass()}}(this))};Dropzone.prototype.enqueueFiles=function(files){var file,_i,_len;for(_i=0,_len=files.length;_i<_len;_i++){file=files[_i];this.enqueueFile(file)}return null};Dropzone.prototype.enqueueFile=function(file){if(file.status===Dropzone.ADDED&&file.accepted===true){file.status=Dropzone.QUEUED;if(this.options.autoProcessQueue){return setTimeout(function(_this){return function(){return _this.processQueue()}}(this),0)}}else{throw new Error("This file can't be queued because it has already been processed or was rejected.")}};Dropzone.prototype._thumbnailQueue=[];Dropzone.prototype._processingThumbnail=false;Dropzone.prototype._enqueueThumbnail=function(file){if(this.options.createImageThumbnails&&file.type.match(/image.*/)&&file.size<=this.options.maxThumbnailFilesize*1024*1024){this._thumbnailQueue.push(file);return setTimeout(function(_this){return function(){return _this._processThumbnailQueue()}}(this),0)}};Dropzone.prototype._processThumbnailQueue=function(){if(this._processingThumbnail||this._thumbnailQueue.length===0){return}this._processingThumbnail=true;return this.createThumbnail(this._thumbnailQueue.shift(),function(_this){return function(){_this._processingThumbnail=false;return _this._processThumbnailQueue()}}(this))};Dropzone.prototype.removeFile=function(file){if(file.status===Dropzone.UPLOADING){this.cancelUpload(file)}this.files=without(this.files,file);this.emit("removedfile",file);if(this.files.length===0){return this.emit("reset")}};Dropzone.prototype.removeAllFiles=function(cancelIfNecessary){var file,_i,_len,_ref;if(cancelIfNecessary==null){cancelIfNecessary=false}_ref=this.files.slice();for(_i=0,_len=_ref.length;_i<_len;_i++){file=_ref[_i];if(file.status!==Dropzone.UPLOADING||cancelIfNecessary){this.removeFile(file)}}return null};Dropzone.prototype.createThumbnail=function(file,callback){var fileReader;fileReader=new FileReader;fileReader.onload=function(_this){return function(){var img;img=document.createElement("img");img.onload=function(){var canvas,ctx,resizeInfo,thumbnail,_ref,_ref1,_ref2,_ref3;file.width=img.width;file.height=img.height;resizeInfo=_this.options.resize.call(_this,file);if(resizeInfo.trgWidth==null){resizeInfo.trgWidth=resizeInfo.optWidth}if(resizeInfo.trgHeight==null){resizeInfo.trgHeight=resizeInfo.optHeight}canvas=document.createElement("canvas");ctx=canvas.getContext("2d");canvas.width=resizeInfo.trgWidth;canvas.height=resizeInfo.trgHeight;drawImageIOSFix(ctx,img,(_ref=resizeInfo.srcX)!=null?_ref:0,(_ref1=resizeInfo.srcY)!=null?_ref1:0,resizeInfo.srcWidth,resizeInfo.srcHeight,(_ref2=resizeInfo.trgX)!=null?_ref2:0,(_ref3=resizeInfo.trgY)!=null?_ref3:0,resizeInfo.trgWidth,resizeInfo.trgHeight);thumbnail=canvas.toDataURL("image/png");_this.emit("thumbnail",file,thumbnail);if(callback!=null){return callback()}};return img.src=fileReader.result}}(this);return fileReader.readAsDataURL(file)};Dropzone.prototype.processQueue=function(){var i,parallelUploads,processingLength,queuedFiles;parallelUploads=this.options.parallelUploads;processingLength=this.getUploadingFiles().length;i=processingLength;if(processingLength>=parallelUploads){return}queuedFiles=this.getQueuedFiles();if(!(queuedFiles.length>0)){return}if(this.options.uploadMultiple){return this.processFiles(queuedFiles.slice(0,parallelUploads-processingLength))}else{while(i<parallelUploads){if(!queuedFiles.length){return}this.processFile(queuedFiles.shift());i++}}};Dropzone.prototype.processFile=function(file){return this.processFiles([file])};Dropzone.prototype.processFiles=function(files){var file,_i,_len;for(_i=0,_len=files.length;_i<_len;_i++){file=files[_i];file.processing=true;file.status=Dropzone.UPLOADING;this.emit("processing",file)}if(this.options.uploadMultiple){this.emit("processingmultiple",files)}return this.uploadFiles(files)};Dropzone.prototype._getFilesWithXhr=function(xhr){var file,files;return files=function(){var _i,_len,_ref,_results;_ref=this.files;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){file=_ref[_i];if(file.xhr===xhr){_results.push(file)}}return _results}.call(this)};Dropzone.prototype.cancelUpload=function(file){var groupedFile,groupedFiles,_i,_j,_len,_len1,_ref;if(file.status===Dropzone.UPLOADING){groupedFiles=this._getFilesWithXhr(file.xhr);for(_i=0,_len=groupedFiles.length;_i<_len;_i++){groupedFile=groupedFiles[_i];groupedFile.status=Dropzone.CANCELED}file.xhr.abort();for(_j=0,_len1=groupedFiles.length;_j<_len1;_j++){groupedFile=groupedFiles[_j];this.emit("canceled",groupedFile)}if(this.options.uploadMultiple){this.emit("canceledmultiple",groupedFiles)}}else if((_ref=file.status)===Dropzone.ADDED||_ref===Dropzone.QUEUED){file.status=Dropzone.CANCELED;this.emit("canceled",file);if(this.options.uploadMultiple){this.emit("canceledmultiple",[file])}}if(this.options.autoProcessQueue){return this.processQueue()}};Dropzone.prototype.uploadFile=function(file){return this.uploadFiles([file])};Dropzone.prototype.uploadFiles=function(files){var file,formData,handleError,headerName,headerValue,headers,i,input,inputName,inputType,key,option,progressObj,response,updateProgress,value,xhr,_i,_j,_k,_l,_len,_len1,_len2,_len3,_m,_ref,_ref1,_ref2,_ref3,_ref4,_ref5;xhr=new XMLHttpRequest;for(_i=0,_len=files.length;_i<_len;_i++){file=files[_i];file.xhr=xhr}xhr.open(this.options.method,this.options.url,true);xhr.withCredentials=!!this.options.withCredentials;response=null;handleError=function(_this){return function(){var _j,_len1,_results;_results=[];for(_j=0,_len1=files.length;_j<_len1;_j++){file=files[_j];_results.push(_this._errorProcessing(files,response||_this.options.dictResponseError.replace("{{statusCode}}",xhr.status),xhr))}return _results}}(this);updateProgress=function(_this){return function(e){var allFilesFinished,progress,_j,_k,_l,_len1,_len2,_len3,_results;if(e!=null){progress=100*e.loaded/e.total;for(_j=0,_len1=files.length;_j<_len1;_j++){file=files[_j];file.upload={progress:progress,total:e.total,bytesSent:e.loaded}}}else{allFilesFinished=true;progress=100;for(_k=0,_len2=files.length;_k<_len2;_k++){file=files[_k];if(!(file.upload.progress===100&&file.upload.bytesSent===file.upload.total)){allFilesFinished=false}file.upload.progress=progress;file.upload.bytesSent=file.upload.total}if(allFilesFinished){return}}_results=[];for(_l=0,_len3=files.length;_l<_len3;_l++){file=files[_l];_results.push(_this.emit("uploadprogress",file,progress,file.upload.bytesSent))}return _results}}(this);xhr.onload=function(_this){return function(e){var _ref;if(files[0].status===Dropzone.CANCELED){return}if(xhr.readyState!==4){return}response=xhr.responseText;if(xhr.getResponseHeader("content-type")&&~xhr.getResponseHeader("content-type").indexOf("application/json")){try{response=JSON.parse(response)}catch(_error){e=_error;response="Invalid JSON response from server."}}updateProgress();if(!(200<=(_ref=xhr.status)&&_ref<300)){return handleError()}else{return _this._finished(files,response,e)}}}(this);xhr.onerror=function(_this){return function(){if(files[0].status===Dropzone.CANCELED){return}return handleError()}}(this);progressObj=(_ref=xhr.upload)!=null?_ref:xhr;progressObj.onprogress=updateProgress;headers={Accept:"application/json","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"};if(this.options.headers){extend(headers,this.options.headers)}for(headerName in headers){headerValue=headers[headerName];xhr.setRequestHeader(headerName,headerValue)}formData=new FormData;if(this.options.params){_ref1=this.options.params;for(key in _ref1){value=_ref1[key];formData.append(key,value)}}for(_j=0,_len1=files.length;_j<_len1;_j++){file=files[_j];this.emit("sending",file,xhr,formData)}if(this.options.uploadMultiple){this.emit("sendingmultiple",files,xhr,formData);
}if(this.element.tagName==="FORM"){_ref2=this.element.querySelectorAll("input, textarea, select, button");for(_k=0,_len2=_ref2.length;_k<_len2;_k++){input=_ref2[_k];inputName=input.getAttribute("name");inputType=input.getAttribute("type");if(input.tagName==="SELECT"&&input.hasAttribute("multiple")){_ref3=input.options;for(_l=0,_len3=_ref3.length;_l<_len3;_l++){option=_ref3[_l];if(option.selected){formData.append(inputName,option.value)}}}else if(!inputType||(_ref4=inputType.toLowerCase())!=="checkbox"&&_ref4!=="radio"||input.checked){formData.append(inputName,input.value)}}}for(i=_m=0,_ref5=files.length-1;0<=_ref5?_m<=_ref5:_m>=_ref5;i=0<=_ref5?++_m:--_m){formData.append(this._getParamName(i),files[i],files[i].name)}return xhr.send(formData)};Dropzone.prototype._finished=function(files,responseText,e){var file,_i,_len;for(_i=0,_len=files.length;_i<_len;_i++){file=files[_i];file.status=Dropzone.SUCCESS;this.emit("success",file,responseText,e);this.emit("complete",file)}if(this.options.uploadMultiple){this.emit("successmultiple",files,responseText,e);this.emit("completemultiple",files)}if(this.options.autoProcessQueue){return this.processQueue()}};Dropzone.prototype._errorProcessing=function(files,message,xhr){var file,_i,_len;for(_i=0,_len=files.length;_i<_len;_i++){file=files[_i];file.status=Dropzone.ERROR;this.emit("error",file,message,xhr);this.emit("complete",file)}if(this.options.uploadMultiple){this.emit("errormultiple",files,message,xhr);this.emit("completemultiple",files)}if(this.options.autoProcessQueue){return this.processQueue()}};return Dropzone}(Em);Dropzone.version="3.10.2";Dropzone.options={};Dropzone.optionsForElement=function(element){if(element.getAttribute("id")){return Dropzone.options[camelize(element.getAttribute("id"))]}else{return void 0}};Dropzone.instances=[];Dropzone.forElement=function(element){if(typeof element==="string"){element=document.querySelector(element)}if((element!=null?element.dropzone:void 0)==null){throw new Error("No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.")}return element.dropzone};Dropzone.autoDiscover=true;Dropzone.discover=function(){var checkElements,dropzone,dropzones,_i,_len,_results;if(document.querySelectorAll){dropzones=document.querySelectorAll(".dropzone")}else{dropzones=[];checkElements=function(elements){var el,_i,_len,_results;_results=[];for(_i=0,_len=elements.length;_i<_len;_i++){el=elements[_i];if(/(^| )dropzone($| )/.test(el.className)){_results.push(dropzones.push(el))}else{_results.push(void 0)}}return _results};checkElements(document.getElementsByTagName("div"));checkElements(document.getElementsByTagName("form"))}_results=[];for(_i=0,_len=dropzones.length;_i<_len;_i++){dropzone=dropzones[_i];if(Dropzone.optionsForElement(dropzone)!==false){_results.push(new Dropzone(dropzone))}else{_results.push(void 0)}}return _results};Dropzone.blacklistedBrowsers=[/opera.*Macintosh.*version\/12/i];Dropzone.isBrowserSupported=function(){var capableBrowser,regex,_i,_len,_ref;capableBrowser=true;if(window.File&&window.FileReader&&window.FileList&&window.Blob&&window.FormData&&document.querySelector){if(!("classList"in document.createElement("a"))){capableBrowser=false}else{_ref=Dropzone.blacklistedBrowsers;for(_i=0,_len=_ref.length;_i<_len;_i++){regex=_ref[_i];if(regex.test(navigator.userAgent)){capableBrowser=false;continue}}}}else{capableBrowser=false}return capableBrowser};without=function(list,rejectedItem){var item,_i,_len,_results;_results=[];for(_i=0,_len=list.length;_i<_len;_i++){item=list[_i];if(item!==rejectedItem){_results.push(item)}}return _results};camelize=function(str){return str.replace(/[\-_](\w)/g,function(match){return match.charAt(1).toUpperCase()})};Dropzone.createElement=function(string){var div;div=document.createElement("div");div.innerHTML=string;return div.childNodes[0]};Dropzone.elementInside=function(element,container){if(element===container){return true}while(element=element.parentNode){if(element===container){return true}}return false};Dropzone.getElement=function(el,name){var element;if(typeof el==="string"){element=document.querySelector(el)}else if(el.nodeType!=null){element=el}if(element==null){throw new Error("Invalid `"+name+"` option provided. Please provide a CSS selector or a plain HTML element.")}return element};Dropzone.getElements=function(els,name){var e,el,elements,_i,_j,_len,_len1,_ref;if(els instanceof Array){elements=[];try{for(_i=0,_len=els.length;_i<_len;_i++){el=els[_i];elements.push(this.getElement(el,name))}}catch(_error){e=_error;elements=null}}else if(typeof els==="string"){elements=[];_ref=document.querySelectorAll(els);for(_j=0,_len1=_ref.length;_j<_len1;_j++){el=_ref[_j];elements.push(el)}}else if(els.nodeType!=null){elements=[els]}if(!(elements!=null&&elements.length)){throw new Error("Invalid `"+name+"` option provided. Please provide a CSS selector, a plain HTML element or a list of those.")}return elements};Dropzone.confirm=function(question,accepted,rejected){if(window.confirm(question)){return accepted()}else if(rejected!=null){return rejected()}};Dropzone.isValidFile=function(file,acceptedFiles){var baseMimeType,mimeType,validType,_i,_len;if(!acceptedFiles){return true}acceptedFiles=acceptedFiles.split(",");mimeType=file.type;baseMimeType=mimeType.replace(/\/.*$/,"");for(_i=0,_len=acceptedFiles.length;_i<_len;_i++){validType=acceptedFiles[_i];validType=validType.trim();if(validType.charAt(0)==="."){if(file.name.toLowerCase().indexOf(validType.toLowerCase(),file.name.length-validType.length)!==-1){return true}}else if(/\/\*$/.test(validType)){if(baseMimeType===validType.replace(/\/.*$/,"")){return true}}else{if(mimeType===validType){return true}}}return false};if(typeof jQuery!=="undefined"&&jQuery!==null){jQuery.fn.dropzone=function(options){return this.each(function(){return new Dropzone(this,options)})}}if(typeof module!=="undefined"&&module!==null){module.exports=Dropzone}else{window.Dropzone=Dropzone}Dropzone.ADDED="added";Dropzone.QUEUED="queued";Dropzone.ACCEPTED=Dropzone.QUEUED;Dropzone.UPLOADING="uploading";Dropzone.PROCESSING=Dropzone.UPLOADING;Dropzone.CANCELED="canceled";Dropzone.ERROR="error";Dropzone.SUCCESS="success";detectVerticalSquash=function(img){var alpha,canvas,ctx,data,ey,ih,iw,py,ratio,sy;iw=img.naturalWidth;ih=img.naturalHeight;canvas=document.createElement("canvas");canvas.width=1;canvas.height=ih;ctx=canvas.getContext("2d");ctx.drawImage(img,0,0);data=ctx.getImageData(0,0,1,ih).data;sy=0;ey=ih;py=ih;while(py>sy){alpha=data[(py-1)*4+3];if(alpha===0){ey=py}else{sy=py}py=ey+sy>>1}ratio=py/ih;if(ratio===0){return 1}else{return ratio}};drawImageIOSFix=function(ctx,img,sx,sy,sw,sh,dx,dy,dw,dh){var vertSquashRatio;vertSquashRatio=detectVerticalSquash(img);return ctx.drawImage(img,sx,sy,sw,sh,dx,dy,dw,dh/vertSquashRatio)};contentLoaded=function(win,fn){var add,doc,done,init,poll,pre,rem,root,top;done=false;top=true;doc=win.document;root=doc.documentElement;add=doc.addEventListener?"addEventListener":"attachEvent";rem=doc.addEventListener?"removeEventListener":"detachEvent";pre=doc.addEventListener?"":"on";init=function(e){if(e.type==="readystatechange"&&doc.readyState!=="complete"){return}(e.type==="load"?win:doc)[rem](pre+e.type,init,false);if(!done&&(done=true)){return fn.call(win,e.type||e)}};poll=function(){var e;try{root.doScroll("left")}catch(_error){e=_error;setTimeout(poll,50);return}return init("poll")};if(doc.readyState!=="complete"){if(doc.createEventObject&&root.doScroll){try{top=!win.frameElement}catch(_error){}if(top){poll()}}doc[add](pre+"DOMContentLoaded",init,false);doc[add](pre+"readystatechange",init,false);return win[add](pre+"load",init,false)}};Dropzone._autoDiscoverFunction=function(){if(Dropzone.autoDiscover){return Dropzone.discover()}};contentLoaded(window,Dropzone._autoDiscoverFunction)}).call(this);return module.exports});
define("lib/dropzone-amd-module", function(){});

define('tpl!modals/add_product_upload_image_from_web_modal', function() {return {"upload_image_from_web_modal":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="modal hide fade" id="web-url-upload-modal"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button> <h3> '+((__t=(i18n("通过网络 URL 上传图片")))==null?'':__t)+'</h3> </div> <div class=\'modal-body\'> <div class="control-group"> <label class="control-label" for="web_url"> '+((__t=(i18n("输入网络 URL： ")))==null?'':__t)+' </label> <div class="controls"> <input class="input-block-level" id="web-url" name="web-url" type="text" /> </div> </div> </div> <div class="modal-footer"> <a data-dismiss="modal" class="btn">'+((__t=(i18n("关闭")))==null?'':__t)+'</a> <a class="btn btn-primary" id="upload-button">'+((__t=(i18n("上传")))==null?'':__t)+'</a> </div> </div> ';}return __p;}};});

define('view/modal/AddProductUploadImageFromWebModal',["core/api","core/dom_utils","view/modal/BaseModal","tpl!modals/add_product_upload_image_from_web_modal"],function(api,dom_utils,BaseModalView,tpl){var AddProductUploadImageFromWebModalView=BaseModalView.extend({initialize:function(options){this.tpl=this.buildTpl(tpl.upload_image_from_web_modal);this.callback=options.callback;this.caller=options.caller;this.target=options.target},render:function(){this.modal_el=this.tpl({});this.launchModal(this.modal_el);$("body").on("hidden",function(){$("#web-url-upload-modal").remove()})},events:{"click #upload-button":"uploadWebURL"},uploadWebURL:function(evt){$("#web-url-upload-modal").modal("hide");this.callback(this.caller,$("#web-url").val(),this.target)}});return AddProductUploadImageFromWebModalView});
define('tpl!sizing_chart', function() {return {"sizing_chart":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="size-chart"> <h3>'+((__t=(chart_title))==null?'':_.escape(__t))+'</h3> <table class="table table-striped table-bordered table-hover"> <thead> <tr> <th rowspan=2></th> '; _.each(dim_order, function(dimension) { __p+=' <th class="th-dim" colspan=2> '+((__t=(dimension))==null?'':_.escape(__t))+' <i class="icon-question-sign"></i> </th> '; }); __p+=' </tr> <tr> '; _.each(dim_order, function(dimension) { __p+=' <th class="th-unit">'+((__t=(i18n("厘米")))==null?'':_.escape(__t))+'</th> <th class="th-unit">'+((__t=(i18n("英寸")))==null?'':_.escape(__t))+'</th> '; }); __p+=' </thead> <tbody> '; _.each(size_order, function(size_) { __p+=' '; var size_info = chart[size_]; __p+=' <tr> <td> '; if (show_checkbox) { __p+=' <label> <input type="checkbox" class="sizes-row-checkbox" name="'+((__t=(size_.replace(/[\W]/g, '')))==null?'':_.escape(__t))+'" display-name="'+((__t=(size_.replace(/[\W]/g, '')))==null?'':_.escape(__t))+'"> '+((__t=(size_))==null?'':_.escape(__t))+' </label> '; } else { __p+=' '+((__t=(size_))==null?'':_.escape(__t))+' '; } __p+=' </td> '; _.each(dim_order, function(dim) { __p+=' <td>'+((__t=(size_info[dim][1]))==null?'':_.escape(__t))+'</td> <td>'+((__t=(size_info[dim][0]))==null?'':_.escape(__t))+'</td> '; }); __p+=' </tr> '; }); __p+=' </tbody> </table> '; if (embed_the_diagram) { __p+=' <div class="embedded-size-chart-diagram"> '; if (chart_title == "Women's Apparel") { __p+=' <img src="'+((__t=("//static.china-merchant./img/womens_sizing_diagram_600px.png?v=18"))==null?'':_.escape(__t))+'" /> '; } else { __p+=' <img src="'+((__t=("//static.china-merchant./img/mens_sizing_diagram_600px.png?v=18"))==null?'':_.escape(__t))+'" /> '; } __p+=' </div> '; } __p+=' </div> ';}return __p;}};});

define('tpl!modals/size_chart_modal', function() {return {"modal":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="modal size-chart-diagram-modal hide fade"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button> <h3>'+((__t=(title))==null?'':_.escape(__t))+'</h3> </div> <div class="modal-body"> '; if (title == "Women's Apparel") { __p+=' <img src="'+((__t=("//static.china-merchant./img/womens_sizing_diagram_600px.png?v=18"))==null?'':_.escape(__t))+'" /> '; } else { __p+=' <img src="'+((__t=("//static.china-merchant./img/mens_sizing_diagram_600px.png?v=18"))==null?'':_.escape(__t))+'" /> '; } __p+=' </div> <div class="modal-footer"> <a href="#" data-dismiss="modal" class="btn ok-btn" id="alert-modal-btn">'+((__t=(i18n("确定")))==null?'':_.escape(__t))+'</a> </div> </div> ';}return __p;}};});

define('view/modal/SizeChartDiagramModal',["view/modal/BaseModal","tpl!modals/size_chart_modal"],function(BaseModalView,tpl){var SizeChartDiagramModal=BaseModalView.extend({initialize:function(configs){this.title=configs.title;this.tpl=this.buildTpl(tpl.modal)},render:function(){var modal_el=this.tpl({title:this.title});this.launchModal(modal_el);return this}});return SizeChartDiagramModal});
define('view/SizeChart',["underscore","core/bb","tpl!sizing_chart","view/modal/SizeChartDiagramModal"],function(_,bb,tpl,SizeChartModal){var SizeChartView=bb.BackboneView.extend({initialize:function(object,show_checkbox){this.chart=object.chart;this.dim_order=object.dim_order;this.size_order=object.size_order;this.chart_title=object.chart_title;this.show_checkbox=show_checkbox;if(typeof object.embed_the_diagram==="undefined"){object.embed_the_diagram=false}this.embed_the_diagram=object.embed_the_diagram;this.tpl=this.buildTpl(tpl.sizing_chart)},events:{"click .icon-question-sign":"showSizeHelp"},showSizeHelp:function(evt){new SizeChartModal({title:this.chart_title}).render()},render:function(){$(this.el).html(this.tpl({chart_title:this.chart_title,chart:this.chart,dim_order:this.dim_order,size_order:this.size_order,embed_the_diagram:this.embed_the_diagram,show_checkbox:this.show_checkbox}));return this}});return SizeChartView});
define('tpl!modals/sizing_chart_modal', function() {return {"sizing_chart_form":function(obj){var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};with(obj||{}){__p+=' <div class="modal" id="sizing-chart-modal" style="width:1000px;margin-left:-500px;"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button> <h3> '; if(mode=='create'){ __p+=' '+((__t=(i18n("创建尺寸表")))==null?'':_.escape(__t))+' '; } else if(mode=='view'){ __p+=' '+((__t=(i18n("查看尺寸表")))==null?'':_.escape(__t))+' '; } else if(mode=='edit'){ __p+=' '+((__t=(i18n("编辑尺寸表")))==null?'':_.escape(__t))+' '; } __p+=' </h3> </div> <form class="sizing-chart-form form-horizontal" style="margin-bottom:0px"> <div class=\'modal-body\' style="max-height:500px"> <div class="control-group" id="name-control"> <label class="control-label"> '+((__t=(i18n("姓名/名称： ")))==null?'':_.escape(__t))+' </label> <input class="controls" id="name" value="'+((__t=(name))==null?'':_.escape(__t))+'" type="text"/> </div> <div class="control-group" id="category-control"> <label class="control-label"> '+((__t=(i18n("类别： ")))==null?'':_.escape(__t))+' </label> <select id="category" class="controls"> '; if(category) { __p+=' <option value="'+((__t=(category))==null?'':_.escape(__t))+'"> '+((__t=(category_names[category]))==null?'':_.escape(__t))+' </option> '; } __p+=' <option></option> '; _.each(categories,function(cat){ __p+=' <option value="'+((__t=(cat))==null?'':_.escape(__t))+'"> '+((__t=(category_names[cat]))==null?'':_.escape(__t))+' </option> '; }); __p+=' </select> </div> <div class="control-group"> <label class="control-label"> '+((__t=(i18n("单位： ")))==null?'':_.escape(__t))+' </label> <div class="controls" style="display:inline-block;"> <label class="radio inline"> <input type="radio" value="2" name="units" class="units" '; if(units==2){ __p+=' checked '; } __p+=' > '+((__t=(i18n("厘米")))==null?'':_.escape(__t))+' </label> <label class="radio inline"> <input type="radio" value="1" name="units" class="units" '; if(units==1){ __p+=' checked '; } __p+=' > '+((__t=(i18n("英寸")))==null?'':_.escape(__t))+' </label> </div> </div> '; if(category||mode=='view'||mode=='edit'){ __p+=' <table class="table table-bordered table-striped" id="sizing-table" style="margin-top: 50px;"> <thead> <tr> <th>Size</th> '; _.each(dimensions,function(dim,index){ __p+=' <th colspan="2">'+((__t=(dimension_names[dim]))==null?'':_.escape(__t))+'</th> '; }); __p+=' <th>Action</th> </tr> <tr> <th></th> '; _.each(dimensions,function(dim,index){ __p+=' <th>Min</th> <th>Max</th> '; }); __p+=' <th></th> </tr> </thead> <tbody> '; _.each(sizes,function(size,index){ __p+=' <tr data-row="'+((__t=(index))==null?'':_.escape(__t))+'"> <td class="control-group"> <select style="max-width:100px" class="size"> <option value="'+((__t=(size.size))==null?'':_.escape(__t))+'"> '; if(size.size){ __p+=' '+((__t=(size.size.toUpperCase()))==null?'':_.escape(__t))+' '; } __p+=' </option> '; _.each(valid_sizes[category],function(tuple){ __p+=' <option value="'+((__t=(tuple[0]))==null?'':_.escape(__t))+'"> '+((__t=(tuple[1]))==null?'':_.escape(__t))+' </option> '; }); __p+=' </select> </td> '; _.each(dimensions,function(dim){ __p+=' <td data-dim="'+((__t=(dim))==null?'':_.escape(__t))+'" class="control-group"> <input type="text" class="minVal" style="max-width:50px" value="'+((__t=(size[dim + "-min"]))==null?'':_.escape(__t))+'"> </td> <td data-dim="'+((__t=(dim))==null?'':_.escape(__t))+'" class="control-group"> <input type="text" class="maxVal" style="max-width:50px" value="'+((__t=(size[dim + "-max"]))==null?'':_.escape(__t))+'"> </td> '; }); __p+=' <td> '; if (index>0){ __p+=' <span class="add-on btn remove-row"> <i class="icon-remove"></i> </span> '; } else { __p+=' <span class="btn add-row"> <i class="icon-plus"></i> </span> '; } __p+=' </td> </tr> '; }); __p+=' </tbody> </table> <a class="btn btn-primary add-row"> '+((__t=(i18n("添加行")))==null?'':_.escape(__t))+'</a> '; } __p+=' </div> <div class=\'modal-footer\'> <div class="pull-left"> <div id="error-text" class="text-error"> </div> </div> <div class="pull-right"> '; if(mode == 'create'){ __p+=' <button data-dismiss="modal" type="button" class="btn"> '+((__t=(i18n("取消")))==null?'':_.escape(__t))+'</button> <button type="button" class="btn-primary btn" id="create"> '+((__t=(i18n("创建")))==null?'':_.escape(__t))+'</button> '; }else if(mode=='view'){ __p+=' <button data-dismiss="modal" type="button" class="btn"> '+((__t=(i18n("关闭")))==null?'':_.escape(__t))+'</button> '; } else if(mode=='edit'){ __p+=' <button data-dismiss="modal" type="button" class="btn"> '+((__t=(i18n("关闭")))==null?'':_.escape(__t))+'</button> <button type="button" class="btn-primary btn" id="save"> '+((__t=(i18n("保存")))==null?'':_.escape(__t))+'</button> '; } __p+=' </div> </div> </form> </div> ';}return __p;}};});

define('view/modal/SizingChartModalView',["underscore","core/bb","core/api","core/url","view/modal/BaseModal","tpl!modals/sizing_chart_modal","core/i18n"],function(_,bb,api,url,BaseModalView,sizingChartTpl,i18nModule){var i18n=i18nModule.i18n;var SizingChartModalView=BaseModalView.extend({initialize:function(mode,params,callback){this.tpl=this.buildTpl(sizingChartTpl.sizing_chart_form);this.sizes=[{}];this.units=2;this.name="";this.mode=mode;if(mode=="view"||mode=="edit"){this.getChart(params["cid"]);this.cid=params["cid"]}this.callback=callback;api.call("sizing-charts/data",{},_.bind(function(res){for(key in res["data"]){window.pageParams[key]=res["data"][key]}this.render(true)},this))},events:{"click #create":"create","click .add-row":"addRow","change #category":"changeCategory","change .size":"changeSize","change .minVal":"changeMin","change .maxVal":"changeMax","click .remove-row":"removeRow","change .units":"changeUnits","change #name":"changeName","click #save":"save"},getChart:function(cid){api.call("sizing-charts/get",{query:cid},_.bind(this.getChartSuccess,this))},getChartSuccess:function(res){var chart=res["data"]["results"][0];this.name=chart.name;this.category=chart.category;this.units=chart.units;this.sizes=[];this.dimensions=[];var sizes=JSON.parse(chart.sizes);this.dimensions=[];for(var sizeName in sizes){var sizeInfo=sizes[sizeName];var sizeDict={size:sizeName};for(var dim in sizeInfo){sizeDict[dim+"-min"]=sizeInfo[dim][0];sizeDict[dim+"-max"]=sizeInfo[dim][1];if(this.dimensions.indexOf(dim)<0){this.dimensions.push(dim)}}this.sizes.push(sizeDict)}this.render()},getParams:function(){var valid_dim=this.dimensions;if(this.category){valid_dim=window.pageParams.dimensions[this.category]}var size_data={};for(var i in this.sizes){var size=this.sizes[i];var size_name=this.sizes[i]["size"];size_data[size_name]={};for(var j in valid_dim){var dim=valid_dim[j];size_data[size_name][dim]=[parseFloat(size[dim+"-min"]),parseFloat(size[dim+"-max"])]}}return params={units:parseInt(this.units),name:this.name,category:this.category,sizes:JSON.stringify(size_data)}},create:function(evt){var error_msg=this.validate();if(error_msg){$("#error-text").html(i18n("错误： ")+error_msg);return}var params=this.getParams();api.call("sizing-charts/create",params,_.bind(function(res){this.apiSuccess(i18n("尺寸表已创建！"));if(this.callback)this.callback(this.name,res["data"]["id"])},this))},save:function(){var error_msg=this.validate();if(error_msg){$("#error-text").html(i18n("错误： ")+error_msg);return}var params=this.getParams();params["cid"]=this.cid;api.call("sizing-charts/update",params,_.bind(function(){this.apiSuccess(i18n("尺寸表已更新！"));if(this.callback)this.callback(this.name,this.cid)},this))},addError:function(row,col){row=parseInt(row)+2;$("#sizing-table tr:eq("+row+") td:eq("+col+")").addClass("error")},removeError:function(row,col){row=parseInt(row)+2;$("#sizing-table tr:eq("+row+") td:eq("+col+")").removeClass("error")},validate:function(){var category=this.category;var error_msg=null;if(!this.name){$("#name-control").addClass("error")}else{$("#name-control").removeClass("error")}if(!category&&this.mode=="create"){$("#category-control").addClass("error");return i18n("请选择类别")}$("#category-control").removeClass("error");var valid_sizes=window.pageParams.valid_sizes[category];var valid_dim=window.pageParams.dimensions[category];for(var i in this.sizes){var size=this.sizes[i];this.removeError(i,0);if(_.find(this.sizes,function(iterSize,ind){return iterSize.size==size.size&&ind!=i})){error_msg=i18n("复制尺寸");this.addError(i,0)}if(this.mode=="create"){if(!_.find(valid_sizes,function(tuple){return tuple[0]==size.size})){error_msg=i18n("无效尺寸");this.addError(i,0)}}for(var j in valid_dim){var dim=valid_dim[j];var minVal=parseFloat(size[dim+"-min"]);var maxVal=parseFloat(size[dim+"-max"]);this.removeError(i,j*2+1);this.removeError(i,j*2+2);if(isNaN(minVal)||minVal<0){error_msg=i18n("无效数量！");this.addError(i,j*2+1)}if(isNaN(maxVal)||maxVal<0){error_msg=i18n("无效数量！");this.addError(i,j*2+2)}if(maxVal<minVal){error_msg=i18n("最大值不能小于最小值");this.addError(i,j*2+1);this.addError(i,j*2+2)}}if(this.sizes.length>1){var sizeOrder=[];for(var i in valid_sizes){var tuple=valid_sizes[i];for(var j in this.sizes){var size=this.sizes[j];if(size.size==tuple[0]){sizeOrder.push(j)}}}for(var d in valid_dim){var dim=valid_dim[d];for(var i=1;i<sizeOrder.length;i++){var prevSize=this.sizes[sizeOrder[i-1]];var curSize=this.sizes[sizeOrder[i]];if(parseFloat(prevSize[dim+"-min"])>parseFloat(curSize[dim+"-max"])){error_msg=i18n("大码必须比小码大");this.addError(i-1,d*2+2);this.addError(i,d*2+1)}}}}}return error_msg},addRow:function(evt){this.sizes.push({});this.render()},removeRow:function(evt){var el=$(evt.currentTarget);var idx=el.closest("tr").attr("data-row");this.sizes.splice(idx,1);this.render()},changeSize:function(evt){var el=$(evt.currentTarget);var idx=el.closest("tr").attr("data-row");this.sizes[idx]["size"]=el.val();this.validate()},changeUnits:function(evt){var el=$(evt.currentTarget);this.units=parseInt(el.val())},changeMin:function(evt){var el=$(evt.currentTarget);var idx=el.closest("tr").attr("data-row");var dim=el.closest("td").attr("data-dim");this.sizes[idx][dim+"-min"]=el.val();this.validate()},changeMax:function(evt){var el=$(evt.currentTarget);var idx=el.closest("tr").attr("data-row");var dim=el.closest("td").attr("data-dim");this.sizes[idx][dim+"-max"]=el.val();this.validate()},changeCategory:function(evt){this.category=$("#category").val();this.render()},changeName:function(evt){this.name=$("#name").val();this.validate()},get_tpl:function(){var dimensions=null;if(this.mode=="create"){dimensions=window.pageParams.dimensions[this.category]}else{dimensions=this.dimensions}return this.tpl({category:this.category,sizes:this.sizes,valid_sizes:window.pageParams.valid_sizes,categories:window.pageParams.categories,category_names:window.pageParams.category_names,dimensions:dimensions,dimension_names:window.pageParams.dimension_names,units:this.units,name:this.name,mode:this.mode})},render:function(created){if(created){this.launchModal(this.get_tpl(),{backdrop:"static"})}else{$("#sizing-chart-modal").html(this.get_tpl())}if(this.mode=="view"){$(".sizing-chart-form select").prop("disabled",true);$(".sizing-chart-form input").prop("disabled",true);$(".sizing-chart-form .remove-row").hide();$(".sizing-chart-form .add-row").hide()}return this}});return SizingChartModalView});
define('view/AddProductForm',["underscore","core/bb","core/api","core/url","core/i18n","core/dom_utils","core/string_utils","core/s3","base_page","tpl!add_products_page","tpl!help/add_products_page","view/HelpDropdownView","view/TagTokenizer","view/modal/ColumnInfoModalView","view/modal/AddProductSuccessModal","lib/jquery.form","lib/jquery.cookie","lib/dropzone-amd-module","view/modal/AddProductUploadImageFromWebModal","view/SizeChart","view/modal/SizingChartModalView"],function(_,bb,api,url,i18nModule,dom_utils,string_utils,s3,base_page,tpl,help_tpl,HelpDropdownView,TagTokenizerView,ColumnInfoModalView,AddProductSuccessModal,ajaxForm,Cookie,dropzone,AddProductUploadImageFromWebModalView,SizeChartView,SizingChartModalView){var i18n=i18nModule.i18n;var index_map={MAIN_IMAGE_URL_COLUMN:6,PRICE_COLUMN:2,NAME_COLUMN:3,QUANTITY_COLUMN:4,SHIPPING_COLUMN:5,TAGS_COLUMN:7,UNIQUE_ID_COLUMN:1,DESCRIPTION_COLUMN:8,COST_COLUMN:11,MSRP_COLUMN:12,BRAND_COLUMN:13,CLICK_OUT_URL_COLUMN:14,EXTRA_IMAGE_URL_COLUMN:15,UPC_COLUMN:16,SIZE_COLUMN:9,COLOR_COLUMN:10,SHIPPING_TIME_COLUMN:17,PARENT_UNIQUE_ID_COLUMN:0,EXTRA_IMAGE_URL_1_COLUMN:18,EXTRA_IMAGE_URL_2_COLUMN:19,EXTRA_IMAGE_URL_3_COLUMN:20,EXTRA_IMAGE_URL_4_COLUMN:21,EXTRA_IMAGE_URL_5_COLUMN:22,EXTRA_IMAGE_URL_6_COLUMN:23,EXTRA_IMAGE_URL_7_COLUMN:24,EXTRA_IMAGE_URL_8_COLUMN:25,EXTRA_IMAGE_URL_9_COLUMN:26,EXTRA_IMAGE_URL_10_COLUMN:27};var pref_map={WEB:1,COMPUTER:2};var AddProductFormView=bb.BackboneView.extend({initialize:function(options){this.onboarding=false;if(options!==undefined){this.callback=options.callback;if(options.onboarding!==undefined){this.onboarding=options.onboarding}}else{this.callback=undefined}window.pageParams.index_map=index_map;window.pageParams.pref_map=pref_map;window.pageParams.image_pref=parseInt($.cookie("PRODUCT_ADD_IMG_PREF"));var pref_values=_.values(window.pageParams.pref_map);if(!_.contains(pref_values,window.pageParams.image_pref)){window.pageParams.image_pref=null}window.pageParams.prefill_values={};var optional_col_index=[];_.each(window.pageParams.commerce_columns,function(info,index){if(!info.required){optional_col_index.push(parseInt(index))}});optional_col_index=_.difference(optional_col_index,[window.pageParams.index_map.COST_COLUMN,window.pageParams.index_map.SHIPPING_TIME_COLUMN,window.pageParams.index_map.PARENT_UNIQUE_ID_COLUMN]);window.pageParams.optional_col_index=optional_col_index;this.VALID_SIZE_NAMES=window.pageParams.valid_size_names;this.VALID_COLOR_NAMES=window.pageParams.valid_color_names;this.VALID_COLOR_VALUES=window.pageParams.valid_color_values;this.COMMON_COLORS=window.pageParams.common_colors;this.VALID_SIZES=window.pageParams.valid_sizes;this.COMMON_SHIPPING_TIME=window.pageParams.common_shipping_time;this.commerce_columns=window.pageParams.commerce_columns;this.index_map=window.pageParams.index_map;this.sizing_charts=window.pageParams.sizing_chart_by_name;this.size_category_dict=window.pageParams.size_category_dict;this.inputRowTpl=this.buildTpl(tpl.input_row);this.variationInputTpl=this.buildTpl(tpl.variation_input_row);this.inputImgTpl=this.buildTpl(tpl.image_row);this.colorRowTpl=this.buildTpl(tpl.color_row);this.sizeRowTpl=this.buildTpl(tpl.size_row);this.sizeTabHeadingTpl=this.buildTpl(tpl.size_tab_heading);this.sizeTabPaneTpl=this.buildTpl(tpl.size_tab_pane);this.sizeAddInput=this.buildTpl(tpl.size_add_input);this.fakeDropzonePreview=this.buildTpl(tpl.fake_dropzone_preview);this.sizingChartRowTpl=this.buildTpl(tpl.sizing_chart_row);this.category="";this.mainImageURL="";this.extraImage=[];this.webImageCount=0;this.previewTemplate=this.buildTpl(tpl.real_dropzone_preview);this.shippingTimeRowTpl=this.buildTpl(tpl.shipping_time_row);this.validateMessage={}},render:function(){this.$el.html(this.buildTpl(tpl.add_products_page)({inputRowTpl:this.inputRowTpl,inputImgTpl:this.inputImgTpl,colorRowTpl:this.colorRowTpl,sizeRowTpl:this.sizeRowTpl,sizeTabHeadingTpl:this.sizeTabHeadingTpl,sizeTabPaneTpl:this.sizeTabPaneTpl,shippingTimeRowTpl:this.shippingTimeRowTpl,sizingChartRowTpl:this.sizingChartRowTpl,common_shipping_time:this.COMMON_SHIPPING_TIME,common_colors:this.COMMON_COLORS,valid_sizes:this.VALID_SIZES,fakeDropzonePreview:this.fakeDropzonePreview,onboarding:this.onboarding}));setTimeout(_.bind(function(){this.postRender()},this),0);this.toggleParentUIDAndUID();this.toggleOptionalFields();this.addExtraImageInput();return this},postRender:function(){if(!window.pageParams.image_pref){var $image_row=this.$(".img-controls").parent();var msg=i18n("是否要从 URL 或您的计算机上传图片？");$image_row.popover({content:msg,trigger:"manual",placement:"right"});$image_row.popover("show")}var col_name=this.getColumnName("TAGS_COLUMN");new TagTokenizerView({ul_el:".typeahead-tokenizer",input_name:col_name,placeholder:window.pageParams.column_info[col_name].examples[0],input_class:"required",initial_tokens:[],max_tokens:10});$('#sizes-selection a[href="#size-category-tab-'+this.size_category_dict["WOMENS_APPAREL"]+'"]').tab("show");this.initColorTypeahead();var _this=this;_.each(this.sizing_charts,function(chart,category){var chart_view=new SizeChartView(chart,true);_this.$("#size-category-tab-"+category+" "+".size-category-checkbox-section").html("");_this.$("#size-category-tab-"+category+" "+".size-category-size-chart").append(chart_view.render().el)});this.addSizesInput("DIGITS","numerical-input","numerical-button",function(value){if($.isNumeric(value))return true;return false});this.addSizesInput("AREA","area-input","area-button",function(value){if(string_utils.validateArea(value))return true;return false},'Example: 1.4m x 1.4m, 10.5" * 10.5", 10cm by 10cm by 10cm');this.addSizesInput("SHOES","shoe-input","shoe-button",function(value){if($.isNumeric(value))return true;return false});this.addSizesInput("VOLUME","volume-input","volume-button",function(value){if(string_utils.validateVolume(value))return true;return false},"Example: 100mL, 200L, 40 fl. oz., 10.5pt");this.addSizesInput("WEIGHT","weight-input","weight-button",function(value){if(string_utils.validateWeight(value))return true;return false},"Example: 100kg, 11.5lb, 3.14g");this.addSizesInput("VOLTAGE","voltage-input","voltage-button",function(value){if(string_utils.validateVoltage(value))return true;return false},"Example: 100V, 50v");this.addSizesInput("LENGTH","length-input","length-button",function(value){if(string_utils.validateLength(value))return true;return false},'Example: 6\' 5", 10m, 5", 11.5cm, 6ft 5in');var self=this;var main_image_div=$("#main-image-div");var main_image_dropzone=main_image_div.dropzone({url:"/api/upload-tmp-image",paramName:"image-file-upload",maxFiles:1,clickable:"#fake-file-upload-main",init:function(){this.on("success",function(file,resp){self.mainImageURL=resp;self.resizePreview(file,resp)});this.on("error",function(file,resp,xhr){this.removeFile(this.files[0]);self.showAddImageError(file.name)});this.on("removedfile",function(file,resp){$("#main-image-no-image").show();self.mainImageURL=""});this.on("addedfile",function(){if(this.files[1]!=null){this.removeFile(this.files[0])}$("#main-image-no-image").hide();$("#main-image-div .fake-preview").remove();self.hideAddImageError()});this.on("dragover",function(){$("#main-image-div").css("background-color","#dff0d8")});this.on("dragleave",function(){$("#main-image-div").css("background-color","white")});this.on("drop",function(){$("#main-image-div").css("background-color","white")});this.uploadFiles=function(files){s3.dropzoneUploadFiles(files,this)};self.$(".dz-default.dz-message").remove()},fallback:function(){$("#fake-file-upload-main").on("click",function(evt){self.clickFakeUploadBtn("#main-image-div");self.hideAddImageError()});$(".main-fallback-hide").hide();$("#main-image-no-image").css("margin-top","88px")},previewTemplate:this.previewTemplate()});var extra_image_div=$("#extra-image-div");var extra_image_dropzone=extra_image_div.dropzone({url:"/api/upload-tmp-image",paramName:"image-file-upload",clickable:"#fake-file-upload-extra",thumbnail:function(file,dataUrl){},createThumbnail:function(){},init:function(){self.dropzoneExtra=this;this.on("success",function(file,resp){self.extraImage.push(resp);self.resizePreview(file,resp);file.image_url=resp});this.on("error",function(file,resp){for(var i=0;i<this.files.length;i++){if(this.files[i]==file){this.removeFile(this.files[i]);self.showAddImageError(file.name);break}}});this.on("removedfile",function(file,resp){if(file.image_url!=undefined){self.removeExtraImage(file.image_url)}if(this.files.length+self.webImageCount<10){$('button[name="extra-image-web-url"]').removeAttr("disabled");$("#fake-file-upload-extra").removeAttr("disabled")}self.setExtraDropzoneHeight(this.files.length+self.webImageCount)});this.on("addedfile",function(){self.hideAddImageError();if(this.files.length+self.webImageCount>=10){$('button[name="extra-image-web-url"]').attr("disabled","disabled");$("#fake-file-upload-extra").attr("disabled","disabled")}if(this.files.length+self.webImageCount>10){for(var i=10-self.webImageCount;i<this.files.length;i++){this.removeFile(this.files[i])}self.showAddImageError(null,"No more than 10 extra images.")}self.setExtraDropzoneHeight(this.files.length+self.webImageCount)});this.on("drop",function(){var msg=i18n("无照片");$(".no-photo-div").css("background-color","white").text(msg)});$(".no-photo-div").on("dragenter",function(evt){var div=$(evt.currentTarget);var msg=i18n("发布上传");div.css("background-color","#dff0d8").text(msg)});$(".no-photo-div").on("dragleave",function(evt){var div=$(evt.currentTarget);var msg=i18n("无照片");div.css("background-color","white").text(msg)});this.uploadFiles=function(files){s3.dropzoneUploadFiles(files,this)};self.$(".dz-default.dz-message").remove()},fallback:function(){$("#fake-file-upload-extra").on("click",function(evt){self.clickFakeUploadBtn("#extra-image-div");self.hideAddImageError()});$("#fake-file-upload-extra").addClass("btn-primary")},previewTemplate:this.previewTemplate()})},events:{"click .control-label":"showColHelp","click .popover-help":"showColHelp","click .image-btn":"imagePrefChoosen","click .fake-file-upload":"clickFakeUploadBtn","change .real-file-upload":"updateImageUploadDisplay",'change input[name][type!="file"]':"inputChanged","change textarea[name]":"inputChanged","click #add-extra-image":"addExtraImageInput","click #add-variation":"addVariationSection","click .remove-variation":"removeVariationSection","click #toggle-optional":"toggleOptionalFields",'click a[data-toggle="tab"]':"tabClicked","click #clear-button":"clear","click #submit-button":"submit",'click button[name="image-web-url"]':"showImageWebURLModal","click .fake-dropzone-remove":"removeFakeDropzonePreview",'click button[name="extra-image-web-url"]':"showExtraImageWebURLModal","click .pick-sizing-chart":"pickSizingChart","click #add-other-color":"colourAdded"},setExtraDropzoneHeight:function(size){var extra_image_div=$("#extra-image-div");var new_height=this.getRequiredHeight(size);extra_image_div.css({height:new_height+"px","min-height":new_height+"px"});if(size>=5){$("#extra-images-row2").show()}else{$("#extra-images-row2").hide()}},resizePreview:function(file,resp){var img=$(file.previewElement).find(".image-preview-thumbnail");img.attr("src",resp)},getRequiredHeight:function(files){if(files<=4){return 200}else{return 370}},removeExtraImage:function(src){for(i in this.extraImage){if(this.extraImage[i]==src){this.extraImage.splice(i,1);break}}},removeFakeDropzonePreview:function(evt){var button=$(evt.currentTarget);var preview=button.closest(".image-preview-div");if(preview.attr("parent-dropzone")=="#main-image-div"){this.mainImageURL="";$("#main-image-no-image").show()}else{var thumbnail=preview.find(".image-preview-thumbnail");this.removeExtraImage(thumbnail.attr("src"));this.webImageCount--;var extra_image_div=$("#extra-image-div");var size=this.webImageCount;if(this.dropzoneExtra!=undefined){size+=this.dropzoneExtra.files.length}this.setExtraDropzoneHeight(size);if(size<10){$('button[name="extra-image-web-url"]').removeAttr("disabled");$("#fake-file-upload-extra").removeAttr("disabled")}}preview.remove()},updateImage:function(target,url,width,height){if(url!=""){var $target=$(target);$target.append(this.fakeDropzonePreview({parentDropzone:target,src:url}));if(target=="#main-image-div"){$("#main-image-no-image").hide();this.mainImageURL=url}else{this.extraImage.push(url);this.webImageCount++;var extra_image_div=$("#extra-image-div");var size=this.webImageCount;if(this.dropzoneExtra!=undefined){size+=this.dropzoneExtra.files.length}this.setExtraDropzoneHeight(size);if(size>=10){$('button[name="extra-image-web-url"]').attr("disabled","disabled");$("#fake-file-upload-extra").attr("disabled","disabled")}}}},showAddImageError:function(filename,message){var error_div=$("#add-image-error");var txt=filename+" "+i18n("为无效图片。");if(filename==undefined){txt=message}error_div.text(txt);error_div.show()},hideAddImageError:function(){$("#add-image-error").hide()},checkImage:function(target,value){api.call("merch-url/image",{url:value},_.bind(function(resp){this.updateImage(target,resp.data.url,resp.data.width,resp.data.height)},this),_.bind(function(){this.showAddImageError(value)},this))},showImageWebURLModal:function(evt){new AddProductUploadImageFromWebModalView({callback:this.imageWebURLUpload,caller:this,target:"#main-image-div"}).render();this.hideAddImageError()},showExtraImageWebURLModal:function(evt){new AddProductUploadImageFromWebModalView({callback:this.imageWebURLUpload,caller:this,target:"#extra-image-div"}).render();this.hideAddImageError()},imageWebURLUpload:function(self,url,target){url=$.trim(url);if(url!=""){self.checkImage(target,url)}},isSizeUnique:function(value,section){var sizes=section.find("input.sizes-row-checkbox");for(var i=0;i<sizes.length;i++){if($(sizes[i]).attr("display-name")==value){return false}}return true},addSizesInput:function(tab_id,input_id,button_id,check_input,help_text){var tab=$("#size-category-tab-"+this.size_category_dict[tab_id]);var checkbox_section=tab.find(".size-category-checkbox-section");var add_section=tab.find(".size-category-add-section");if(help_text==undefined)help_text="";add_section.append("<strong>"+help_text+"</strong><br>");add_section.append(this.buildTpl(tpl.sizes_add_input)({inputId:input_id,buttonId:button_id}));var self=this;var input=$("#"+input_id);var button=$("#"+button_id);input.keyup(function(evt){var input=$(evt.currentTarget);var button=input.closest(".tab-pane").find("button");if(check_input(input.val())&&self.isSizeUnique(input.val(),checkbox_section)){button.removeAttr("disabled");if(evt.which==13){evt.preventDefault();button.trigger("click")}}else{button.attr("disabled","disabled")}});button.click(function(evt){var button=$(evt.currentTarget);var tab=button.closest(".tab-pane");var checkbox_section=tab.find(".size-category-checkbox-section");var input=tab.find(".sizes_user_input");var size=input.val();checkbox_section.append(self.buildTpl(tpl.size_row)({sizeName:size,checked:true}));input.val("");var selector="#"+tab.attr("id")+' input.sizes-row-checkbox[type="checkbox"][display-name="'+size.replace(/"/g,'\\"')+'"]:checked';self.updateGeneratedVariations($(selector))})},initColorTypeahead:function(){var color_input=$("#other-color-typeahead");var self=this;color_input.typeahead({source:this.VALID_COLOR_VALUES,onselect:function(){self.colourAdded()}}).on("keyup",function(evt){self.toggleAddColorButton(evt)})},colourAdded:function(){var input=$("#other-color-typeahead");var color=$.trim(input.val());if(color!=""){this.$("#colors-selection").append(this.buildTpl(tpl.color_row)({colorName:color,colorHex:"",checked:true}));input.val("");this.updateGeneratedVariations($('input.colours-row-checkbox[type="checkbox"][display-name="'+color+'"]:checked'))}},toggleAddColorButton:function(evt){var input=$("#other-color-typeahead");var color=$.trim(input.val());if(color!=""){$("#add-other-color").prop("disabled",false);if(evt.keyCode===13){this.colourAdded()}}else{$("#add-other-color").prop("disabled",true)}},tabClicked:function(evt){var tab=$(evt.currentTarget);var id=tab.attr("href").substring(1);if(this.category!=id){$("#"+id+'.tab-pane input[type="checkbox"]:checked').prop("checked",false)}},removeAllVariations:function(){$(".variation-row").each(function(index){this.remove()})},removeGeneratedVariations:function(size,colour){$('.variation-row[name="'+size+colour+'"]').remove()},addGeneratedVariations:function(name,size,colour,hexcode){window.pageParams.prefill_values=this.getPrefillValues();if(window.pageParams.rev_share){var value=window.pageParams.prefill_values[window.pageParams.index_map.PRICE_COLUMN]}else{var value=window.pageParams.prefill_values[window.pageParams.index_map.COST_COLUMN]}var earnings=this.getEarnings(value);this.$("#variations-section").append(this.buildTpl(tpl.variation_row)({variationName:name,variationSize:size,variationColor:colour,variationLabel:size+" & "+colour,variationInputTpl:this.variationInputTpl,colorHex:hexcode,earnings:earnings}))},getEarnings:function(value){if(value.indexOf("$")==0){value=value.substring(1)}value=parseFloat(value);if(isNaN(value)){return""}var shipping=$("input[name='"+window.pageParams.commerce_columns[window.pageParams.index_map.SHIPPING_COLUMN].name+"']").val();if(shipping.indexOf("$")==0){shipping=shipping.substring(1)}shipping=parseFloat(shipping);if(isNaN(shipping)){return""}value=value+shipping;if(window.pageParams.rev_share){value=value*(1-window.pageParams.rev_share/100)}return string_utils.formatCurrency(value)},updateGeneratedVariations:function(checkbox){var colours=$('input.colours-row-checkbox[type="checkbox"]:checked');var sizes=$("#"+this.category+'.tab-pane input.sizes-row-checkbox[type="checkbox"]:checked');if(checkbox.is(":checked")){var variation_rows=this.$(".variation-row");if(checkbox.attr("class")=="sizes-row-checkbox"){var cat=checkbox.closest(".tab-pane").attr("id");if(this.category==""){this.category=cat}else if(cat!=this.category){this.removeAllVariations();this.category=cat;sizes=$("#"+this.category+'.tab-pane input.sizes-row-checkbox[type="checkbox"]:checked');variation_rows=this.$(".variation-row")}if(sizes.length==1&&colours.length>0&&variation_rows.length>0){for(var i=0;i<variation_rows.length;i++){var variation=$(variation_rows[i]);var name=variation.attr("name");variation.attr("name",checkbox.attr("name")+name);variation.find("input[name='Size']").val(checkbox.attr("display-name"));variation.find("span[name='size-label']").text(checkbox.attr("display-name"))}}else{if(colours.length==0){this.addGeneratedVariations(checkbox.attr("name"),checkbox.attr("display-name"),"","")}for(var i=0;i<colours.length;i++){this.addGeneratedVariations(checkbox.attr("name")+colours[i].name,checkbox.attr("display-name"),$(colours[i]).attr("display-name"),$(colours[i]).attr("color-hex"))}}}else if(checkbox.attr("class")=="colours-row-checkbox"){if(colours.length==1&&sizes.length>0&&variation_rows.length>0){for(var i=0;i<variation_rows.length;i++){var variation=$(variation_rows[i]);var name=variation.attr("name");variation.attr("name",name+checkbox.attr("name"));variation.find("input[name='Color']").val(checkbox.attr("display-name"));var span=variation.find("span[name='color-label']");if(checkbox.attr("display-name")=="Multicolor"){span.append('<div class="color-box color-box-image"                               style="background-image: url(\''+window.pageParams.multicolor_image+"'); margin-right: 5px;\"></div>"+checkbox.attr("display-name"))}else{span.append('<div class="color-box" style="background-color:'+checkbox.attr("color-hex")+'; margin-right: 5px;"></div>'+checkbox.attr("display-name"))}}}else{if(sizes.length==0){this.addGeneratedVariations(checkbox.attr("name"),"",checkbox.attr("display-name"),checkbox.attr("color-hex"))}for(var i=0;i<sizes.length;i++){this.addGeneratedVariations(sizes[i].name+checkbox.attr("name"),$(sizes[i]).attr("display-name"),checkbox.attr("display-name"),checkbox.attr("color-hex"))}}}if(sizes.length>0||colours.length>0){$("#variations-heading").show()}}else{if(checkbox.attr("class")=="sizes-row-checkbox"){for(var i=0;i<colours.length;i++){this.removeGeneratedVariations(checkbox.attr("name"),colours[i].name)}this.removeGeneratedVariations(checkbox.attr("name"),"");if(sizes.length==0){for(var i=0;i<colours.length;i++){this.addGeneratedVariations(colours[i].name,"",$(colours[i]).attr("display-name"),$(colours[i]).attr("color-hex"))}}}else if(checkbox.attr("class")=="colours-row-checkbox"){for(var i=0;i<sizes.length;i++){this.removeGeneratedVariations(sizes[i].name,checkbox.attr("name"))}this.removeGeneratedVariations("",checkbox.attr("name"));if(colours.length==0){for(var i=0;i<sizes.length;i++){this.addGeneratedVariations(sizes[i].name,$(sizes[i]).attr("display-name"),"","")}}}if(sizes.length<=0&&colours.length<=0){$("#variations-heading").hide()}}var variation_count=0;if(sizes.length<=0&&colours.length<=0){variation_count=0}else if(sizes.length<=0){variation_count=colours.length}else if(colours.length<=0){variation_count=sizes.length}else{variation_count=sizes.length*colours.length}this.$("#variations-count").html(variation_count)},showColHelp:function(evt){var col_index=$(evt.currentTarget).data("col-index");var name=this.commerce_columns[col_index].name;new ColumnInfoModalView(name).render()},clickFakeUploadBtn:function(div){$(div).find(".real-file-upload").click()},updateImageUploadDisplay:function(evt){var file_path=dom_utils.val(evt.currentTarget);var file_parts=file_path.split("\\");var file_name=file_parts[file_parts.length-1];this.uploadImage($(evt.currentTarget),file_name)},uploadImage:function($target,file_name){var failure=_.bind(function(resp,xhr){this.showAddImageError(file_name)},this);var success=_.bind(function(resp,xhr){var original_resp=resp;if(typeof resp==="string"){resp=$.parseJSON(resp)}if(resp.code!=0){failure(resp,xhr);s3.logErrorsToServer(original_resp,"","","uploadImage");return}var id="#"+$target.closest(".dropzone").attr("id");this.updateImage(id,resp.data.image_url)},this);if(!file_name){var txt=i18n("请选择图片。");var resp={msg:txt};failure(resp,undefined);return}var $form=$target.closest("form");s3.uploadToS3($form,success,failure)},imagePrefChoosen:function(evt){$(evt.currentTarget).closest(".control-group").popover("destroy");var $btn=$(evt.currentTarget);var new_pref=$btn.hasClass("computer-image-btn")?window.pageParams.pref_map.COMPUTER:window.pageParams.pref_map.WEB;$.cookie("PRODUCT_ADD_IMG_PREF",new_pref);window.pageParams.image_pref=new_pref;var $top_lvl=$btn.closest(".controls");$top_lvl.find(".img-input input").val("");$top_lvl.find(".img-input").addClass("hide");$top_lvl.find(".image-method-chooser").addClass("hide");if(new_pref==window.pageParams.pref_map.COMPUTER){$top_lvl.find(".img-input.computer").removeClass("hide")}else{$top_lvl.find(".img-input.web").removeClass("hide")}},addErrorToRow:function($rowEl,message){var col_index=$rowEl.find(".control-label").data("col-index");if(col_index==undefined){col_index=$rowEl.data("col-index")}var txt=i18n("参阅帮助");var content=message+', <a class="popover-help" data-col-index="'+col_index+'">'+txt+"</a>.";if(message==""){content=""}$rowEl.addClass("error").find(".add-on").html("×").popover("destroy").popover({html:true,content:content,placement:"right",trigger:"manual"}).popover("show")},removeErrorFromRow:function($rowEl){$rowEl.removeClass("error").find(".add-on").html("✔").popover("destroy")},inputChanged:function(evt){var $input=$(evt.currentTarget);var col_name=$input.attr("name");if($input.attr("type")=="checkbox"){if($input.attr("name")=="ship-time-checkbox"){if($input.is(":checked")){$("input[name='ship-time-checkbox']").prop("checked",false);$input.prop("checked",true)}else{$input.prop("checked",false)}}else{this.updateGeneratedVariations($input)}}else{if($input.attr("name")==window.pageParams.commerce_columns[window.pageParams.index_map.SHIPPING_TIME_COLUMN].name){$("input[name='ship-time-checkbox']").prop("checked",false);$("#ship-time-other").prop("checked",true)}var validated=this.validateInput($input);var input_value=dom_utils.val($input);if(validated){var earnings=input_value;var section=$input.closest(".earnings-section");var earnings_intput=section.find("#earnings");if($input.attr("name")==window.pageParams.commerce_columns[window.pageParams.index_map.COST_COLUMN].name||$input.attr("name")==window.pageParams.commerce_columns[window.pageParams.index_map.PRICE_COLUMN].name){earnings_intput.val(this.getEarnings(input_value))}else if($input.attr("name")==window.pageParams.commerce_columns[window.pageParams.index_map.SHIPPING_COLUMN].name){var earnings=$("input#earnings");for(var i=0;i<earnings.length;i++){var current=$(earnings[i]);var section=current.closest(".earnings-section");var money;if(window.pageParams.rev_share){money=section.find("input[name='"+window.pageParams.commerce_columns[window.pageParams.index_map.PRICE_COLUMN].name+"']").val()}else{money=section.find("input[name='"+window.pageParams.commerce_columns[window.pageParams.index_map.COST_COLUMN].name+"']").val()}var value=this.getEarnings(money);current.val(value)}}}var $basic_info_section=this.$("#basic-info");if($.contains($basic_info_section.get(0),$input.get(0))){if(col_name==this.getColumnName("UNIQUE_ID_COLUMN")||col_name==this.getColumnName("PARENT_UNIQUE_ID_COLUMN")){var $synced_inputs=[this.getInput($basic_info_section,"UNIQUE_ID_COLUMN").val(input_value),this.getInput($basic_info_section,"PARENT_UNIQUE_ID_COLUMN").val(input_value)];_.each($synced_inputs,_.bind(function($synced_input){if($synced_input.get(0)!=$input.get(0)){this.validateInput($synced_input)}},this))}}if(col_name==this.getColumnName("NAME_COLUMN")){if(input_value!=""){this.$("#product-name").html('"'+input_value+'"');this.toggleSummary(true)}else{this.$("#product-name").html("a product");this.toggleSummary(false)}}}},appendValidateMessage:function(input,message){this.validateMessage[input.attr("name")]=message},validateInput:function($input){var $input_row=$input.closest(".control-group");var input_value=dom_utils.val($input);this.removeErrorFromRow($input_row);if(input_value==""){if($input.hasClass("required")){var msg=i18n("此属性为必填项");this.addErrorToRow($input_row,msg);msg=i18n("%1$s 为必填属性。",$input.attr("name"));this.appendValidateMessage($input,msg);return false}else{return true}}var col_name=$input.attr("name");if(col_name==window.pageParams.commerce_columns[window.pageParams.index_map.SHIPPING_TIME_COLUMN].name&&$input.attr("id")!="shipping-time-submit"){var result=i18n("配送时长无效");if(!$.isNumeric(input_value)||parseInt(input_value)<=1){this.addErrorToRow($input_row,result);this.appendValidateMessage($input,result);return false}var value=parseInt(input_value);if($input.attr("id")=="min-ship-time"){var max=parseInt($("#max-ship-time").val());if(!isNaN(max)&&value>=max){this.addErrorToRow($input_row,"");return false}}else if($input.attr("id")=="max-ship-time"){var min=parseInt($("#min-ship-time").val());if(!isNaN(min)&&value<=min){result=i18n("最大预估数必须大于最小预估数。");this.addErrorToRow($input_row,result);return false}}}else if(col_name!="sizing_chart"){var col_info=window.pageParams.column_info[col_name];var col_type=col_info.type;var result=this.validateType(col_name,input_value,col_type);if(result){this.addErrorToRow($input_row,result);var msg=i18n("%1$s 属性错误：%2$s",$input.attr("name"),result);this.appendValidateMessage($input,msg);return false}}if(col_name==this.getColumnName("PRICE_COLUMN")||col_name==this.getColumnName("COST_COLUMN")){result=this.validatePriceOrCost(input_value);if(result){this.addErrorToRow($input_row,result);var msg=i18n("%1$s 属性错误：%2$s",$input.attr("name"),result);this.appendValidateMessage($input,msg);return false}}var variation_row=$input_row.closest(".variation-row");if(col_name==this.getColumnName("UNIQUE_ID_COLUMN")&&variation_row.length>0){if(!this.checkVariationId(input_value,$input_row)){var msg=i18n("唯一 ID 必须是唯一的");this.addErrorToRow($input_row,msg);msg=i18n("%1$s 属性错误：%2$s",$input.attr("name"),msg);this.appendValidateMessage($input,msg)}}return true},validateType:function(name,value,type){switch(type){case"URL":if(string_utils.validateURL(value)){return false}else{return i18n("无效 URL")}case"Price":var regex=/^\$?[0-9]+(\.[0-9]{1,2})?$/;if(regex.test(value)){return false}else{return i18n("无效的货币格式")}case"Integer":var regex=/^[0-9]+$/;if(regex.test(value)){return false}else{return i18n("无效数量")}case"String":if(name==this.getColumnName("COLOR_COLUMN")){return false}else if(name==this.getColumnName("SIZE_COLUMN")){return string_utils.validateSize(value,this.VALID_SIZE_NAMES)}else if(name==this.getColumnName("SHIPPING_TIME_COLUMN")){return string_utils.validateShippingTime(value)}return false}},validatePriceOrCost:function(value){value=parseFloat(value);if(value!=NaN&&value===0){return i18n("此属性不能为零")}return false},getColumnName:function(column){var column_index=this.index_map[column];return this.commerce_columns[column_index].name},getInput:function($parent,column){var column_name=this.getColumnName(column);return $parent.find('input[name="'+column_name+'"]')},getRow:function($parent,column){var $column_input=this.getInput($parent,column);return $column_input.closest(".control-group")},addExtraImageInput:function(){var col_name_prefix=this.getColumnName("EXTRA_IMAGE_URL_COLUMN");var curr_num=this.$('input[name^="'+col_name_prefix+'"]').length+1;if(curr_num>10){var msg=i18n("不超过 10 个额外的图片 URL。");api.launchErrorModal(msg);return}var col_name="EXTRA_IMAGE_URL_"+curr_num+"_COLUMN";this.$("#extra-images-section").append(this.buildTpl(tpl.image_row)({index:window.pageParams.index_map[col_name]}))},initSizeTypeAhead:function($variation_section){var $size_input=this.getInput($variation_section,"SIZE_COLUMN");$size_input.typeahead({source:this.VALID_SIZE_NAMES,onselect:function(){$size_input.trigger("change")}})},validateNewVariationSection:function($variation_section){var $variation_inputs=$variation_section.find("input[name]");_.each($variation_inputs,_.bind(function(input){var $input=$(input);if(dom_utils.val($input)!=""){this.validateInput($input)}},this))},getPrefillValues:function(){var $source_input_rows=this.$("#inventory-shipping .control-group");var prefill_values={};_.each($source_input_rows,function(row){var $row=$(row);var col_index=$row.find(".control-label").data("col-index");var $input=$row.find("input");prefill_values[col_index]=dom_utils.val($input)});return prefill_values},toggleParentUIDAndUID:function(){var $basic_info_section=this.$("#basic-info");var $uid_row=this.getRow($basic_info_section,"UNIQUE_ID_COLUMN");var $parent_uid_row=this.getRow($basic_info_section,"PARENT_UNIQUE_ID_COLUMN");if(this.$(".variation-section").length==0){$uid_row.show();$parent_uid_row.hide()}else{$uid_row.hide();$parent_uid_row.show()}},addVariationSection:function(){window.pageParams.prefill_values=this.getPrefillValues();this.$("#variations-section").append(this.buildTpl(tpl.variation_section)({inputRowTpl:this.inputRowTpl}));var $new_variation_section=this.$(".variation-section:last");this.initSizeTypeAhead($new_variation_section);this.validateNewVariationSection($new_variation_section);this.toggleParentUIDAndUID();this.$("#variations-count").html(this.$(".variation-section").length)},removeVariationSection:function(evt){$(evt.currentTarget).closest(".variation-section").remove();this.toggleParentUIDAndUID();this.$("#variations-count").html(this.$(".variation-section").length)},validateVariationSection:function($variation_section){var $size_input=this.getInput($variation_section,"SIZE_COLUMN");var $color_input=this.getInput($variation_section,"COLOR_COLUMN");var size_value=dom_utils.val($size_input);var color_value=dom_utils.val($color_input);if(size_value==""&&color_value==""){var $size_row=$size_input.closest(".control-group");var $color_row=$color_input.closest(".control-group");var error_message=i18n("必须指定尺码或颜色");this.addErrorToRow($size_row,error_message);this.addErrorToRow($color_row,error_message);return false}else{
return true}},toggleOptionalFields:function(evt){this.$("#toggle-optional i").toggleClass("icon-plus icon-minus");this.$("#optional-fields").toggleClass("hide")},toggleSummary:function(no_errors){if(no_errors){this.$("#summary-error").hide();this.$("#summary-info").show()}else{this.$("#summary-error").show();this.$("#summary-info").hide()}},pickSizingChart:function(){var modal=new SizingChartModalView("create",{},_.bind(function(name,id){this.$("#custom-sizing-chart").attr("data-id",id);this.$("#custom-sizing-chart").val(name)},this))},checkVariationId:function(id,input_row){var variations=$(".variation-row");if(input_row==undefined||input_row.length<=0){return true}for(var i=0;i<variations.length;i++){var variation=variations[i];var control_group=$(variation).find(".control-group")[0];if(control_group==input_row[0]){continue}var input=$(variation).find('input[name="Unique Id"]');var other_id=input.val().trim();if(other_id==id){return false}}return true},checkVariationIdUnique:function(){var ids=new Object;var variations=$(".variation-row");for(var i=0;i<variations.length;i++){var variation=variations[i];var input=$(variation).find('input[name="Unique Id"]');var id=input.val().trim();if(id!=""&&ids[id]!=null){this.addErrorToRow(input.closest(".control-group"),"Unique Id must be unique.");return false}else{ids[id]="1"}}return true},validateShipTime:function(){var shiptime;var box=$("input[name='ship-time-checkbox']:checked");if(box.length==0){var msg=i18n("%1$s 为必填字段。",$("#min-ship-time").attr("name"));this.appendValidateMessage($("#min-ship-time"),msg);return false}if(box.attr("id")=="ship-time-other"){var min_input=$("#min-ship-time");var max_input=$("#max-ship-time");var max=parseInt(max_input.val());var min=parseInt(min_input.val());var max_input_group=max_input.closest(".control-group");var min_input_group=min_input.closest(".control-group");var result=i18n("配送时长无效");if(isNaN(min)||min<=1){this.addErrorToRow(min_input_group,result);var msg=i18n("%1$s 属性错误：%2$s",min_input.attr("name"),result);this.appendValidateMessage(min_input,msg);return false}if(isNaN(max)||max<=1){this.addErrorToRow(max_input_group,result);var msg=i18n("%1$s 属性错误：%2$s",max_input.attr("name"),result);this.appendValidateMessage(max_input,msg);return false}result=i18n("最大预估数必须大于最小预估数。");if(min>=max){this.addErrorToRow(max_input_group,result);var msg=i18n("%1$s 属性错误：%2$s",max_input.attr("name"),result);this.appendValidateMessage(max_input,msg);return false}value=min+" - "+max}else{value=box.attr("value")}$("#shipping-time-submit").val(value);return true},submit:function(evt){var validate_result=true;this.validateMessage={};var product_row={};validate_result&=this.validateShipTime();var $non_variation_inputs=this.$('#add-product-form input[name][type!="file"], textarea[name]').not("#variations-section input").not("#colors-info input").not("#sizes-info input").not("#shipping-time input");_.each($non_variation_inputs,_.bind(function(input){var $input=$(input);var col_name=$input.attr("name");validate_result&=this.validateInput($input);product_row[col_name]=dom_utils.val($input)},this));if(this.mainImageURL.trim()==""){var msg=i18n("请添加商品的主图片。");api.launchErrorModal(msg);return}if(this.extraImage.length>10){var msg=i18n("额外图片不得超过 10 张。");api.launchErrorModal(msg);return}var mainImageInputName=window.pageParams.commerce_columns[window.pageParams.index_map.MAIN_IMAGE_URL_COLUMN].name;product_row[mainImageInputName]=this.mainImageURL;var extraImageInputName=window.pageParams.commerce_columns[window.pageParams.index_map.EXTRA_IMAGE_URL_COLUMN].name;for(var i=0;i<this.extraImage.length;i++){product_row[extraImageInputName+" "+(i+1)]=this.extraImage[i]}if($("#custom-sizing-chart").attr("data-id")){product_row["sizing_chart"]=$("#custom-sizing-chart").attr("data-id")}var product_data=[];var $variation_sections=this.$(".variation-row");if($variation_sections.length==0){product_data.push(product_row)}else{product_data=_.map($variation_sections,_.bind(function(section){var $variation_section=$(section);var $variation_inputs=$variation_section.find("input[name]");var new_product_row=$.extend({},product_row);_.each($variation_inputs,_.bind(function(input){var $input=$(input);var col_name=$input.attr("name");validate_result&=this.validateInput($input);new_product_row[col_name]=dom_utils.val($input)},this));validate_result&=this.validateVariationSection($variation_section);return new_product_row},this))}if(!validate_result){var errors=i18n("请填写所有必填属性并更正所有错误：");for(key in this.validateMessage){errors+="\n"+this.validateMessage[key]}api.launchErrorModal(errors);return}if(!this.checkVariationIdUnique()){api.launchErrorModal(i18n("每个产品变量的唯一id都是必填且需保持唯一的。"))}else{this.$("#buttons-section *").hide();this.$("#loading-spinner").show();api.call("add-products",{product_data:JSON.stringify(product_data)},_.bind(function(resp){this.$("#buttons-section *").show();this.$("#loading-spinner").hide();if(window.pageParams.merchant_user.is_new_merchant_lead){$(document).trigger("refreshOnboardingChecklist")}else{var txt1=i18n("您已成功添加产品。");var txt2=i18n("立即查看");if(this.onboarding){txt1=i18n("该产品已成功添加到Wish.")+"\n\n"+i18n("产品出售前，请提出产品审核请求。");txt2=i18n("现在查看你的产品")}var message="<p>"+txt1+" "+'<a href="'+url.wishURL("/c/"+resp.data.product_id)+'" target="_blank">'+txt2+"</a>.</p>";var msg=i18n("产品已成功添加！");new AddProductSuccessModal({header:msg,body:message}).render()}if(this.callback){this.callback()}},this),_.bind(function(resp){this.$("#buttons-section *").show();this.$("#loading-spinner").hide();var msg=resp&&resp.msg?resp.msg+".":i18n("未知错误");api.launchErrorModal(msg)},this))}},clear:function(){window.location.reload()}});return AddProductFormView});
require(["base_page","tpl!help/add_products_page","view/HelpDropdownView","view/AddProductForm"],function(base_page,help_tpl,HelpDropdownView,AddProductFormView){var init_page=function(){new HelpDropdownView({tpl:help_tpl.help}).render();$("#add-products-page").html((new AddProductFormView).render().el)};base_page.onDomReady(init_page)});
define("page/add_products_page", function(){});
